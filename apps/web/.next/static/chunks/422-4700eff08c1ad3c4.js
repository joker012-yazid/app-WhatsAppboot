"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[422],{3638:function(e,t,n){n.d(t,{V:function(){return i},p:function(){return u}});var r=n(7573),a=n(7653),o=n(3458);function l(e){let{message:t,variant:n="info",onClose:o,duration:l=2500}=e;return(0,a.useEffect)(()=>{if(!l)return;let e=setTimeout(()=>o&&o(),l);return()=>clearTimeout(e)},[l,o]),(0,r.jsx)("div",{className:"pointer-events-auto fixed bottom-4 right-4 z-50 max-w-sm rounded-lg border bg-slate-950/90 px-4 py-3 shadow-lg shadow-black/40 backdrop-blur ".concat("success"===n?"border-emerald-500/60 text-emerald-50":"error"===n?"border-red-500/60 text-red-50":"warning"===n?"border-amber-500/60 text-amber-50":"border-slate-700 text-slate-50"),role:"status","aria-live":"polite",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"text-sm",children:t}),o?(0,r.jsx)("button",{className:"ml-auto text-xs text-slate-300 opacity-80 transition hover:opacity-100",onClick:o,"aria-label":"Close",children:"x"}):null]})})}let s=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[n,i]=(0,a.useState)([]),[u,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{c(!0)},[]);let d=(0,a.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e))},[]),h=(0,a.useCallback)((e,t)=>{var n,r;let a={id:Math.floor(Date.now()+1e3*Math.random()),message:e,variant:null!==(n=null==t?void 0:t.variant)&&void 0!==n?n:"info",duration:null!==(r=null==t?void 0:t.duration)&&void 0!==r?r:2500};i(e=>[...e,a])},[]),f=(0,a.useMemo)(()=>({show:h,success:(e,t)=>h(e,{variant:"success",duration:t}),error:(e,t)=>h(e,{variant:"error",duration:t}),info:(e,t)=>h(e,{variant:"info",duration:t}),warning:(e,t)=>h(e,{variant:"warning",duration:t})}),[h]);(0,a.useEffect)(()=>(globalThis.__toast=f,()=>{globalThis.__toast===f&&delete globalThis.__toast}),[f]);let v=u&&n.length>0?(0,r.jsx)(r.Fragment,{children:n.map(e=>(0,r.jsx)(l,{message:e.message,variant:e.variant,duration:e.duration,onClose:()=>d(e.id)},e.id))}):null;return(0,r.jsxs)(s.Provider,{value:f,children:[t,u&&"undefined"!=typeof document&&v?(0,o.createPortal)(v,document.body):null]})}function u(){let e=(0,a.useContext)(s);if(!e)throw Error("useToast must be used within ToastProvider");return e}},466:function(e,t,n){n.d(t,{z:function(){return u}});var r=n(7573),a=n(7653),o=n(5814),l=n(2708),s=n(9147);let i=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=a.forwardRef((e,t)=>{let{className:n,variant:a,size:l,asChild:u=!1,...c}=e,d=u?o.g7:"button";return(0,r.jsx)(d,{className:(0,s.cn)(i({variant:a,size:l,className:n})),ref:t,...c})});u.displayName="Button"},5118:function(e,t,n){n.d(t,{QW:function(){return v},R1:function(){return h},SC:function(){return c},pE:function(){return f},sg:function(){return d},zi:function(){return g}});var r=n(4859);let a=r.env.NEXT_PUBLIC_API_BASE_URL||r.env.NEXT_PUBLIC_API_URL||"http://localhost:4000",o=()=>window.sessionStorage,l="accessToken",s="refreshToken",i=e=>e.startsWith("/api/auth/login")||e.startsWith("/api/auth/register")||e.startsWith("/api/auth/refresh"),u=!1;async function c(e){var t,n,r,d,h,f,v,g,m;let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{method:p="GET",body:y,headers:w,_retry:T}=b,x="".concat(a).concat(e),k=o(),E=(null==k?void 0:k.getItem(l))||null,C=(null==k?void 0:k.getItem(s))||null;try{let o=await fetch(x,{method:p,headers:{"Content-Type":"application/json",...w||{},...E&&!i?{Authorization:"Bearer ".concat(E)}:{}},body:y?JSON.stringify(y):void 0,credentials:"include"}),u=await o.text(),h={};if(u)try{h=JSON.parse(u)}catch(e){h={message:u}}if(!o.ok){let u=(null==h?void 0:h.message)||"HTTP ".concat(o.status,": ").concat(o.statusText);if(console.error("[API] Request failed: ".concat(p," ").concat(x," - ").concat(u)),401===o.status&&(console.warn("[API] Unauthorized â€“ will let auth layer handle redirect / logout"),!i(e)&&!T&&C)){try{let t=await fetch("".concat(a,"/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:C}),credentials:"include"});if(t.ok){let n=await t.json(),r=null==n?void 0:n.accessToken,a=null==n?void 0:n.refreshToken;return r&&(null==k||k.setItem(l,r)),a&&(null==k||k.setItem(s,a)),c(e,{...b,_retry:!0})}}catch(e){console.error("[API] Refresh token request failed",e)}null==k||k.removeItem(l),null==k||k.removeItem(s)}if(502===o.status||503===o.status||504===o.status){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};try{null===(n=globalThis.__toast)||void 0===n||null===(t=n.error)||void 0===t||t.call(n,e.message)}catch(e){}let r=Error(e.message);throw r.code=e.code,r}try{null===(d=globalThis.__toast)||void 0===d||null===(r=d.error)||void 0===r||r.call(d,u)}catch(e){}throw Error(u)}return h}catch(t){if((null==t?void 0:null===(h=t.message)||void 0===h?void 0:h.includes("Failed to fetch"))||(null==t?void 0:null===(f=t.message)||void 0===f?void 0:f.includes("NetworkError"))||(null==t?void 0:null===(v=t.message)||void 0===v?void 0:v.includes("ECONNREFUSED"))||(null==t?void 0:t.name)==="TypeError"){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};u||(console.error("[API] Connection error: ".concat(p," ").concat(x),t),u=!0);try{null===(m=globalThis.__toast)||void 0===m||null===(g=m.error)||void 0===g||g.call(m,e.message)}catch(e){}let n=Error(e.message);throw n.code=e.code,n}if(t instanceof Error&&t.message)throw t;let e=(null==t?void 0:t.message)||"Failed to fetch: ".concat(p," ").concat(x);throw console.error("[API] Request error: ".concat(p," ").concat(x),t),Error(e)}}let d=(e,t)=>c(e,{method:"POST",body:t}),h=e=>c(e,{method:"GET"}),f=(e,t)=>c(e,{method:"PUT",body:t}),v=e=>c(e,{method:"DELETE"});async function g(e,t){let n=await fetch("".concat(a).concat(e),{method:"POST",body:t,credentials:"include"}),r=await n.text(),o=r?JSON.parse(r):{};if(!n.ok)throw Error((null==o?void 0:o.message)||"HTTP ".concat(n.status));return o}},1799:function(e,t,n){n.d(t,{H:function(){return c},a:function(){return d}});var r=n(7573),a=n(7653),o=n(5118);let l=(0,a.createContext)(void 0),s=()=>window.sessionStorage,i="accessToken",u="refreshToken",c=e=>{let{children:t}=e,[n,c]=(0,a.useState)(null),[d,h]=(0,a.useState)("authenticating"),[f,v]=(0,a.useState)(null),[g,m]=(0,a.useState)(null),b="authenticating"===d,p=(0,a.useCallback)(()=>{let e=s();null==e||e.removeItem(i),null==e||e.removeItem(u),m(null)},[]),y=(0,a.useCallback)(()=>{let e=s();return e?{access:e.getItem(i),refresh:e.getItem(u)}:{access:null,refresh:null}},[]),w=(0,a.useCallback)((e,t)=>{let n=s();n&&(e&&n.setItem(i,e),t&&n.setItem(u,t))},[]),T=(0,a.useCallback)(async()=>{let e=await (0,o.R1)("/api/auth/me");return c(e),h("authenticated"),v(null),e},[]),x=(0,a.useCallback)(async()=>{let{refresh:e}=y();try{let r=await (0,o.sg)("/api/auth/refresh",e?{refreshToken:e}:{});if(null==r?void 0:r.accessToken){var t,n;return w(r.accessToken,null!==(n=null!==(t=r.refreshToken)&&void 0!==t?t:e)&&void 0!==n?n:null),m(r.accessToken),!0}return!1}catch(e){return p(),!1}},[p,y,w]),k=(0,a.useCallback)(async(e,t)=>{v(null),h("authenticating");try{let r=await (0,o.sg)("/api/auth/login",{email:e,password:t});if(null==r?void 0:r.accessToken){var n;w(r.accessToken,null!==(n=r.refreshToken)&&void 0!==n?n:null),m(r.accessToken)}let a=(null==r?void 0:r.user)?r.user:await T();c(a),h("authenticated")}catch(e){throw v((null==e?void 0:e.message)||"Login failed"),h("unauthenticated"),p(),e}},[T,w,p]),E=(0,a.useCallback)(async()=>{try{let{refresh:e}=y();await (0,o.sg)("/api/auth/logout",e?{refreshToken:e}:{})}finally{p(),c(null),h("unauthenticated")}},[p,y]);(0,a.useEffect)(()=>{let e=!1;return(async()=>{h("authenticating");try{let{access:t}=y(),n=!!t;n?m(t||null):n=await x(),n?(await T(),e||h("authenticated")):e||(h("unauthenticated"),c(null))}catch(t){e||(v((null==t?void 0:t.message)||"Session expired. Please login again."),h("unauthenticated"),c(null),p())}})(),()=>{e=!0}},[x,T,p,y]);let C=(0,a.useMemo)(()=>({user:n,loading:b,status:d,error:f,login:k,logout:E,accessToken:g}),[n,b,d,f,k,E,g]);return(0,r.jsx)(l.Provider,{value:C,children:t})},d=()=>{let e=(0,a.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9147:function(e,t,n){n.d(t,{cn:function(){return r}});let r=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}}}]);