{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["/turbopack/[project]/apps/web/src/app/dashboard/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport AuthGuard from '@/components/auth-guard';\r\nimport { useAuth } from '@/lib/auth';\r\nimport { apiGet } from '@/lib/api';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useToast } from '@/components/toast-provider';\r\n\r\ntype Stats = {\r\n  customers: number;\r\n  devices: number;\r\n  jobs: number;\r\n  jobsByStatus: {\r\n    PENDING: number;\r\n    QUOTED: number;\r\n    APPROVED: number;\r\n    IN_PROGRESS: number;\r\n    COMPLETED: number;\r\n    REJECTED: number;\r\n  };\r\n};\r\n\r\ntype DashboardCards = {\r\n  todaysRevenue: number;\r\n  pendingJobs: number;\r\n  activeJobs: number;\r\n  newCustomers: number;\r\n  // Count of urgent/prioritized jobs, not an inventory metric\r\n  urgentJobs: number;\r\n  campaignsRunning: number;\r\n};\r\n\r\ntype DashboardResponse = {\r\n  cards: DashboardCards;\r\n};\r\n\r\nexport default function DashboardPage() {\r\n  const { user } = useAuth();\r\n  const toast = useToast();\r\n  const [stats, setStats] = useState<Stats | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [cards, setCards] = useState<DashboardCards | null>(null);\r\n  const [cardsLoading, setCardsLoading] = useState(true);\r\n\r\n  const formatCurrency = (value: number) =>\r\n    new Intl.NumberFormat('en-MY', { style: 'currency', currency: 'MYR', maximumFractionDigits: 0 }).format(value || 0);\r\n\r\n  useEffect(() => {\r\n    const fetchStats = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const data = await apiGet<Stats>('/api/health/stats');\r\n        setStats(data);\r\n      } catch (error: any) {\r\n        console.error('[Dashboard] Failed to load stats:', error);\r\n        const errorMessage = error?.message || 'Failed to load dashboard statistics';\r\n        toast.error(errorMessage);\r\n        setStats(null);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchStats();\r\n  }, [toast]);\r\n\r\n  useEffect(() => {\r\n    const fetchCards = async () => {\r\n      try {\r\n        setCardsLoading(true);\r\n        const data = await apiGet<DashboardResponse>('/api/dashboard');\r\n        setCards(data.cards || null);\r\n      } catch (error: any) {\r\n        console.error('[Dashboard] Failed to load cards:', error);\r\n        const errorMessage = error?.message || 'Failed to load dashboard metrics';\r\n        toast.error(errorMessage);\r\n        setCards(null);\r\n      } finally {\r\n        setCardsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchCards();\r\n  }, [toast]);\r\n\r\n  return (\r\n    <AuthGuard>\r\n      <div className=\"space-y-6\">\r\n        <section className=\"rounded-xl border bg-card px-6 py-8 shadow-sm\">\r\n          <div className=\"mb-6\">\r\n            <h1 className=\"text-3xl font-bold\">Dashboard</h1>\r\n            <p className=\"text-muted-foreground mt-2\">\r\n              Welcome back, <span className=\"font-medium\">{user?.name || user?.email}</span>\r\n            </p>\r\n            <p className=\"text-sm text-muted-foreground mt-1\">Role: {user?.role}</p>\r\n          </div>\r\n\r\n          {cardsLoading ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">Loading dashboard metrics...</div>\r\n          ) : cards ? (\r\n            <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n              <div className=\"rounded-lg border p-6 bg-card\">\r\n                <p className=\"text-sm text-muted-foreground mb-2\">Today's Revenue</p>\r\n                <p className=\"text-3xl font-bold\">{formatCurrency(cards.todaysRevenue)}</p>\r\n              </div>\r\n\r\n              <div className=\"rounded-lg border p-6 bg-card\">\r\n                <p className=\"text-sm text-muted-foreground mb-2\">Pending Jobs</p>\r\n                <p className=\"text-3xl font-bold\">{cards.pendingJobs}</p>\r\n              </div>\r\n\r\n              <div className=\"rounded-lg border p-6 bg-card\">\r\n                <p className=\"text-sm text-muted-foreground mb-2\">Active Jobs</p>\r\n                <p className=\"text-3xl font-bold\">{cards.activeJobs}</p>\r\n              </div>\r\n\r\n              <div className=\"rounded-lg border p-6 bg-card\">\r\n                <p className=\"text-sm text-muted-foreground mb-2\">New Customers Today</p>\r\n                <p className=\"text-3xl font-bold\">{cards.newCustomers}</p>\r\n              </div>\r\n\r\n              <div className=\"rounded-lg border p-6 bg-card\">\r\n                <p className=\"text-sm text-muted-foreground mb-2\">Urgent Jobs</p>\r\n                <p className=\"text-3xl font-bold\">{cards.urgentJobs}</p>\r\n              </div>\r\n\r\n              <div className=\"rounded-lg border p-6 bg-card\">\r\n                <p className=\"text-sm text-muted-foreground mb-2\">Campaigns Running</p>\r\n                <p className=\"text-3xl font-bold\">{cards.campaignsRunning}</p>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-8 text-muted-foreground\">Failed to load dashboard metrics</div>\r\n          )}\r\n        </section>\r\n\r\n        <section className=\"rounded-xl border bg-card px-6 py-8 shadow-sm\">\r\n          {loading ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">Loading statistics...</div>\r\n          ) : stats ? (\r\n            <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n              {/* Overview Cards */}\r\n              <div className=\"rounded-lg border p-6 bg-card\">\r\n                <p className=\"text-sm text-muted-foreground mb-2\">Total Customers</p>\r\n                <p className=\"text-3xl font-bold\">{stats.customers}</p>\r\n                <Button variant=\"ghost\" size=\"sm\" className=\"mt-4\" asChild>\r\n                  <Link href=\"/customers\">View All →</Link>\r\n                </Button>\r\n              </div>\r\n\r\n              <div className=\"rounded-lg border p-6 bg-card\">\r\n                <p className=\"text-sm text-muted-foreground mb-2\">Total Devices</p>\r\n                <p className=\"text-3xl font-bold\">{stats.devices}</p>\r\n                <Button variant=\"ghost\" size=\"sm\" className=\"mt-4\" asChild>\r\n                  <Link href=\"/devices\">View All →</Link>\r\n                </Button>\r\n              </div>\r\n\r\n              <div className=\"rounded-lg border p-6 bg-card\">\r\n                <p className=\"text-sm text-muted-foreground mb-2\">Total Jobs</p>\r\n                <p className=\"text-3xl font-bold\">{stats.jobs}</p>\r\n                <Button variant=\"ghost\" size=\"sm\" className=\"mt-4\" asChild>\r\n                  <Link href=\"/jobs\">View All →</Link>\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-center py-8 text-muted-foreground\">Failed to load statistics</div>\r\n          )}\r\n        </section>\r\n\r\n        {stats && (\r\n          <section className=\"rounded-xl border bg-card px-6 py-8 shadow-sm\">\r\n            <h2 className=\"text-xl font-semibold mb-4\">Jobs by Status</h2>\r\n            <div className=\"grid grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-6\">\r\n              <div className=\"rounded-lg border p-4 bg-yellow-50 dark:bg-yellow-950/20\">\r\n                <p className=\"text-xs text-muted-foreground mb-1\">Pending</p>\r\n                <p className=\"text-2xl font-bold\">{stats.jobsByStatus.PENDING}</p>\r\n              </div>\r\n              <div className=\"rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/20\">\r\n                <p className=\"text-xs text-muted-foreground mb-1\">Quoted</p>\r\n                <p className=\"text-2xl font-bold\">{stats.jobsByStatus.QUOTED}</p>\r\n              </div>\r\n              <div className=\"rounded-lg border p-4 bg-purple-50 dark:bg-purple-950/20\">\r\n                <p className=\"text-xs text-muted-foreground mb-1\">Approved</p>\r\n                <p className=\"text-2xl font-bold\">{stats.jobsByStatus.APPROVED}</p>\r\n              </div>\r\n              <div className=\"rounded-lg border p-4 bg-orange-50 dark:bg-orange-950/20\">\r\n                <p className=\"text-xs text-muted-foreground mb-1\">In Progress</p>\r\n                <p className=\"text-2xl font-bold\">{stats.jobsByStatus.IN_PROGRESS}</p>\r\n              </div>\r\n              <div className=\"rounded-lg border p-4 bg-green-50 dark:bg-green-950/20\">\r\n                <p className=\"text-xs text-muted-foreground mb-1\">Completed</p>\r\n                <p className=\"text-2xl font-bold\">{stats.jobsByStatus.COMPLETED}</p>\r\n              </div>\r\n              <div className=\"rounded-lg border p-4 bg-red-50 dark:bg-red-950/20\">\r\n                <p className=\"text-xs text-muted-foreground mb-1\">Rejected</p>\r\n                <p className=\"text-2xl font-bold\">{stats.jobsByStatus.REJECTED}</p>\r\n              </div>\r\n            </div>\r\n          </section>\r\n        )}\r\n\r\n        <section className=\"rounded-xl border bg-card px-6 py-8 shadow-sm\">\r\n          <h2 className=\"text-xl font-semibold mb-4\">Quick Actions</h2>\r\n          <div className=\"flex flex-wrap gap-3\">\r\n            <Button asChild>\r\n              <Link href=\"/customers\">Add Customer</Link>\r\n            </Button>\r\n            <Button asChild variant=\"outline\">\r\n              <Link href=\"/jobs\">Create Job</Link>\r\n            </Button>\r\n            <Button asChild variant=\"outline\">\r\n              <Link href=\"/devices\">Add Device</Link>\r\n            </Button>\r\n          </div>\r\n        </section>\r\n      </div>\r\n    </AuthGuard>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 739, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}