"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3171],{22628:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(27573),a=n(81695),o=n(7653),s=n(41799);function l(e){let{children:t,redirectOnFail:n=!0}=e,{user:l,loading:i,error:c,status:u}=(0,s.a)(),d=(0,a.useRouter)();return((0,o.useEffect)(()=>{if(n&&!i&&(!l||c||"unauthenticated"===u)){let e=c?"?reason=".concat(encodeURIComponent(c)):"";d.replace("/login".concat(e))}},[l,i,c,d,n,u]),i)?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading session..."}):!l&&n?null:(0,r.jsx)(r.Fragment,{children:t})}},43735:function(e,t,n){n.d(t,{SectionHeader:function(){return o}});var r=n(27573),a=n(29147);function o(e){let{icon:t,overline:n,title:o,description:s,actions:l,className:i}=e;return(0,r.jsxs)("div",{className:(0,a.cn)("flex flex-wrap items-center justify-between gap-4",i),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[t?(0,r.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-full border border-sky-500/30 bg-sky-500/10 text-sky-400 shadow-sm",children:t}):null,(0,r.jsxs)("div",{children:[n?(0,r.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:n}):null,(0,r.jsx)("h1",{className:"text-xl font-semibold text-slate-50 md:text-2xl",children:o}),s?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:s}):null]})]}),l?(0,r.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:l}):null]})}},73638:function(e,t,n){n.d(t,{V:function(){return i},p:function(){return c}});var r=n(27573),a=n(7653),o=n(3458);function s(e){let{message:t,variant:n="info",onClose:o,duration:s=2500}=e;return(0,a.useEffect)(()=>{if(!s)return;let e=setTimeout(()=>o&&o(),s);return()=>clearTimeout(e)},[s,o]),(0,r.jsx)("div",{className:"pointer-events-auto fixed bottom-4 right-4 z-50 max-w-sm rounded-lg border bg-slate-950/90 px-4 py-3 shadow-lg shadow-black/40 backdrop-blur ".concat("success"===n?"border-emerald-500/60 text-emerald-50":"error"===n?"border-red-500/60 text-red-50":"warning"===n?"border-amber-500/60 text-amber-50":"border-slate-700 text-slate-50"),role:"status","aria-live":"polite",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"text-sm",children:t}),o?(0,r.jsx)("button",{className:"ml-auto text-xs text-slate-300 opacity-80 transition hover:opacity-100",onClick:o,"aria-label":"Close",children:"x"}):null]})})}let l=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[n,i]=(0,a.useState)([]),[c,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{u(!0)},[]);let d=(0,a.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e))},[]),h=(0,a.useCallback)((e,t)=>{var n,r;let a={id:Math.floor(Date.now()+1e3*Math.random()),message:e,variant:null!==(n=null==t?void 0:t.variant)&&void 0!==n?n:"info",duration:null!==(r=null==t?void 0:t.duration)&&void 0!==r?r:2500};i(e=>[...e,a])},[]),f=(0,a.useMemo)(()=>({show:h,success:(e,t)=>h(e,{variant:"success",duration:t}),error:(e,t)=>h(e,{variant:"error",duration:t}),info:(e,t)=>h(e,{variant:"info",duration:t}),warning:(e,t)=>h(e,{variant:"warning",duration:t})}),[h]);(0,a.useEffect)(()=>(globalThis.__toast=f,()=>{globalThis.__toast===f&&delete globalThis.__toast}),[f]);let m=c&&n.length>0?(0,r.jsx)(r.Fragment,{children:n.map(e=>(0,r.jsx)(s,{message:e.message,variant:e.variant,duration:e.duration,onClose:()=>d(e.id)},e.id))}):null;return(0,r.jsxs)(l.Provider,{value:f,children:[t,c&&"undefined"!=typeof document&&m?(0,o.createPortal)(m,document.body):null]})}function c(){let e=(0,a.useContext)(l);if(!e)throw Error("useToast must be used within ToastProvider");return e}},50466:function(e,t,n){n.d(t,{z:function(){return c}});var r=n(27573),a=n(7653),o=n(8828),s=n(49289),l=n(29147);let i=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:n,variant:a,size:s,asChild:c=!1,...u}=e,d=c?o.g7:"button";return(0,r.jsx)(d,{className:(0,l.cn)(i({variant:a,size:s,className:n})),ref:t,...u})});c.displayName="Button"},45118:function(e,t,n){n.d(t,{QW:function(){return f},R1:function(){return d},SC:function(){return c},pE:function(){return h},sg:function(){return u},zi:function(){return m}});let r="http://localhost:4000",a=()=>window.sessionStorage,o="accessToken",s="refreshToken",l=e=>e.startsWith("/api/auth/login")||e.startsWith("/api/auth/register")||e.startsWith("/api/auth/refresh"),i=!1;async function c(e){var t,n,u,d,h,f,m,v,g;let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{method:p="GET",body:b,headers:y,_retry:w}=x,k="".concat(r).concat(e),T=a(),E=(null==T?void 0:T.getItem(o))||null,N=(null==T?void 0:T.getItem(s))||null;try{let a=await fetch(k,{method:p,headers:{"Content-Type":"application/json",...y||{},...E&&!l?{Authorization:"Bearer ".concat(E)}:{}},body:b?JSON.stringify(b):void 0,credentials:"include"}),i=await a.text(),h={};if(i)try{h=JSON.parse(i)}catch(e){h={message:i}}if(!a.ok){let i=(null==h?void 0:h.message)||"HTTP ".concat(a.status,": ").concat(a.statusText);if(console.error("[API] Request failed: ".concat(p," ").concat(k," - ").concat(i)),401===a.status&&(console.warn("[API] Unauthorized â€“ will let auth layer handle redirect / logout"),!l(e)&&!w&&N)){try{let t=await fetch("".concat(r,"/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:N}),credentials:"include"});if(t.ok){let n=await t.json(),r=null==n?void 0:n.accessToken,a=null==n?void 0:n.refreshToken;return r&&(null==T||T.setItem(o,r)),a&&(null==T||T.setItem(s,a)),c(e,{...x,_retry:!0})}}catch(e){console.error("[API] Refresh token request failed",e)}null==T||T.removeItem(o),null==T||T.removeItem(s)}if(502===a.status||503===a.status||504===a.status){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};try{null===(n=globalThis.__toast)||void 0===n||null===(t=n.error)||void 0===t||t.call(n,e.message)}catch(e){}let r=Error(e.message);throw r.code=e.code,r}try{null===(d=globalThis.__toast)||void 0===d||null===(u=d.error)||void 0===u||u.call(d,i)}catch(e){}throw Error(i)}return h}catch(t){if((null==t?void 0:null===(h=t.message)||void 0===h?void 0:h.includes("Failed to fetch"))||(null==t?void 0:null===(f=t.message)||void 0===f?void 0:f.includes("NetworkError"))||(null==t?void 0:null===(m=t.message)||void 0===m?void 0:m.includes("ECONNREFUSED"))||(null==t?void 0:t.name)==="TypeError"){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};i||(console.error("[API] Connection error: ".concat(p," ").concat(k),t),i=!0);try{null===(g=globalThis.__toast)||void 0===g||null===(v=g.error)||void 0===v||v.call(g,e.message)}catch(e){}let n=Error(e.message);throw n.code=e.code,n}if(t instanceof Error&&t.message)throw t;let e=(null==t?void 0:t.message)||"Failed to fetch: ".concat(p," ").concat(k);throw console.error("[API] Request error: ".concat(p," ").concat(k),t),Error(e)}}let u=(e,t)=>c(e,{method:"POST",body:t}),d=e=>c(e,{method:"GET"}),h=(e,t)=>c(e,{method:"PUT",body:t}),f=e=>c(e,{method:"DELETE"});async function m(e,t){let n=await fetch("".concat(r).concat(e),{method:"POST",body:t,credentials:"include"}),a=await n.text(),o=a?JSON.parse(a):{};if(!n.ok)throw Error((null==o?void 0:o.message)||"HTTP ".concat(n.status));return o}},41799:function(e,t,n){n.d(t,{H:function(){return u},a:function(){return d}});var r=n(27573),a=n(7653),o=n(45118);let s=(0,a.createContext)(void 0),l=()=>window.sessionStorage,i="accessToken",c="refreshToken",u=e=>{let{children:t}=e,[n,u]=(0,a.useState)(null),[d,h]=(0,a.useState)("authenticating"),[f,m]=(0,a.useState)(null),[v,g]=(0,a.useState)(null),x="authenticating"===d,p=(0,a.useCallback)(()=>{let e=l();null==e||e.removeItem(i),null==e||e.removeItem(c),g(null)},[]),b=(0,a.useCallback)(()=>{let e=l();return e?{access:e.getItem(i),refresh:e.getItem(c)}:{access:null,refresh:null}},[]),y=(0,a.useCallback)((e,t)=>{let n=l();n&&(e&&n.setItem(i,e),t&&n.setItem(c,t))},[]),w=(0,a.useCallback)(async()=>{let e=await (0,o.R1)("/api/auth/me");return u(e),h("authenticated"),m(null),e},[]),k=(0,a.useCallback)(async()=>{let{refresh:e}=b();if(!e)return!1;try{let n=await (0,o.sg)("/api/auth/refresh",{refreshToken:e});if(null==n?void 0:n.accessToken){var t;return y(n.accessToken,null!==(t=n.refreshToken)&&void 0!==t?t:e),g(n.accessToken),!0}return!1}catch(e){return p(),!1}},[p,b,y]),T=(0,a.useCallback)(async(e,t)=>{m(null),h("authenticating");try{let r=await (0,o.sg)("/api/auth/login",{email:e,password:t});if(null==r?void 0:r.accessToken){var n;y(r.accessToken,null!==(n=r.refreshToken)&&void 0!==n?n:null),g(r.accessToken)}let a=(null==r?void 0:r.user)?r.user:await w();u(a),h("authenticated")}catch(e){throw m((null==e?void 0:e.message)||"Login failed"),h("unauthenticated"),p(),e}},[w,y,p]),E=(0,a.useCallback)(async()=>{try{let{refresh:e}=b();e&&await (0,o.sg)("/api/auth/logout",{refreshToken:e})}catch(e){}finally{p(),u(null),h("unauthenticated")}},[p,b]);(0,a.useEffect)(()=>{let e=!1;return(async()=>{h("authenticating");try{let{access:t,refresh:n}=b(),r=!!t;!r&&n?r=await k():t&&g(t),r?(await w(),e||h("authenticated")):e||(h("unauthenticated"),u(null))}catch(t){if(!e){let e=(null==t?void 0:t.message)||"";(e.includes("Backend API")||e.includes("BACKEND_UNAVAILABLE"))&&m(e),h("unauthenticated"),u(null),p()}}})(),()=>{e=!0}},[k,w,p,b]);let N=(0,a.useMemo)(()=>({user:n,loading:x,status:d,error:f,login:T,logout:E,accessToken:v}),[n,x,d,f,T,E,v]);return(0,r.jsx)(s.Provider,{value:N,children:t})},d=()=>{let e=(0,a.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},29147:function(e,t,n){n.d(t,{cn:function(){return r}});let r=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}}}]);