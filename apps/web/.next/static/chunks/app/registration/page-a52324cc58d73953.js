(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3204],{50094:function(e,t,a){Promise.resolve().then(a.bind(a,68641))},68641:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var n=a(27573),r=a(7653),s=a(83185),i=a(38842),l=a(22628),o=a(50466),c=a(73638),d=a(84355),u=a(88623),m=a(51733),h=a(51856),f=a(15092),x=a(26302);function g(){let e=(0,c.p)(),[t,a]=(0,r.useState)(""),[g,p]=(0,r.useState)(""),[v,b]=(0,r.useState)(!1);(0,r.useEffect)(()=>{w()},[]);let w=async()=>{b(!0);try{let e="".concat(window.location.protocol,"//").concat(window.location.hostname,":4000"),t="".concat(e,"/public/register/index.html");p(t);let n=await i.toDataURL(t,{width:350,margin:2,color:{dark:"#0f172a",light:"#ffffff"},errorCorrectionLevel:"H"});a(n)}catch(t){e.error("Failed to generate QR code")}finally{b(!1)}};return(0,n.jsx)(l.Z,{children:(0,n.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[calc(100vh-12rem)]",children:(0,n.jsxs)(s.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-lg",children:[(0,n.jsxs)("div",{className:"text-center mb-8",children:[(0,n.jsx)(s.E.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15},className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-600 to-blue-600 shadow-lg shadow-purple-500/30 mb-4",children:(0,n.jsx)(d.Z,{className:"h-8 w-8 text-white"})}),(0,n.jsx)("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Customer Registration"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Scan QR code untuk daftar customer baru"})]}),(0,n.jsxs)(s.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.1},className:"rounded-2xl border border-border bg-card/80 backdrop-blur-lg shadow-2xl overflow-hidden",children:[(0,n.jsx)("div",{className:"p-8 bg-gradient-to-br from-purple-900/10 to-blue-900/10",children:(0,n.jsx)("div",{className:"flex justify-center",children:v?(0,n.jsx)("div",{className:"w-[350px] h-[350px] flex items-center justify-center bg-muted/50 rounded-2xl",children:(0,n.jsx)(u.Z,{className:"h-12 w-12 text-muted-foreground animate-spin"})}):t?(0,n.jsx)(s.E.div,{initial:{rotateY:90,opacity:0},animate:{rotateY:0,opacity:1},transition:{delay:.2,duration:.5},className:"bg-white p-4 rounded-2xl shadow-inner",children:(0,n.jsx)("img",{src:t,alt:"Registration QR Code",className:"w-[320px] h-[320px]"})}):(0,n.jsx)("div",{className:"w-[350px] h-[350px] flex items-center justify-center bg-muted/50 rounded-2xl",children:(0,n.jsx)("p",{className:"text-muted-foreground",children:"QR Code tidak tersedia"})})})}),(0,n.jsxs)("div",{className:"px-8 py-6 border-t border-border/50",children:[(0,n.jsx)("h3",{className:"font-semibold text-foreground mb-4 text-center",children:"Cara Penggunaan"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)(s.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"flex items-center gap-3 text-sm",children:[(0,n.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-purple-500/10 text-purple-400 font-semibold",children:"1"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Customer scan QR code menggunakan telefon"})]}),(0,n.jsxs)(s.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"flex items-center gap-3 text-sm",children:[(0,n.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-blue-500/10 text-blue-400 font-semibold",children:"2"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Isi maklumat dalam form pendaftaran"})]}),(0,n.jsxs)(s.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.5},className:"flex items-center gap-3 text-sm",children:[(0,n.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-green-500/10 text-green-400 font-semibold",children:"3"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"Submit dan pendaftaran selesai!"})]})]})]}),(0,n.jsxs)("div",{className:"px-8 pb-8 pt-2",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)(o.z,{onClick:()=>{if(!t)return;let a=document.createElement("a");a.download="customer-registration-qr.png",a.href=t,a.click(),e.success("QR Code downloaded!")},className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 shadow-lg shadow-purple-500/20",disabled:!t,children:[(0,n.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"Download QR"]}),(0,n.jsxs)(o.z,{variant:"outline",onClick:()=>{g&&(navigator.clipboard.writeText(g),e.success("Link copied! Share via WhatsApp."))},disabled:!g,children:[(0,n.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Copy Link"]})]}),(0,n.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[(0,n.jsxs)(o.z,{variant:"outline",onClick:()=>{if(!g)return;let e=encodeURIComponent("Sila scan QR atau klik link ini untuk daftar device anda: ".concat(g));window.open("https://wa.me/?text=".concat(e),"_blank")},className:"border-green-500/30 text-green-400 hover:bg-green-500/10 hover:border-green-500/50",disabled:!g,children:[(0,n.jsx)(f.Z,{className:"mr-2 h-4 w-4"}),"Share WhatsApp"]}),(0,n.jsxs)(o.z,{variant:"outline",onClick:w,disabled:v,children:[(0,n.jsx)(u.Z,{className:"mr-2 h-4 w-4 ".concat(v?"animate-spin":"")}),"Refresh QR"]})]})]})]}),(0,n.jsx)(s.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"mt-6 rounded-xl border border-blue-500/20 bg-blue-500/5 p-4",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)(x.Z,{className:"h-5 w-5 text-blue-400 mt-0.5"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-medium text-blue-300",children:"Tips"}),(0,n.jsx)("p",{className:"text-xs text-blue-300/70 mt-1",children:"Cetak QR code ini dan letak di kaunter untuk customer walk-in scan. Atau share link melalui WhatsApp untuk customer yang tidak di kedai."})]})]})})]})})})}},22628:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var n=a(27573),r=a(81695),s=a(7653),i=a(41799);function l(e){let{children:t,redirectOnFail:a=!0}=e,{user:l,loading:o,error:c,status:d}=(0,i.a)(),u=(0,r.useRouter)();return((0,s.useEffect)(()=>{if(a&&!o&&(!l||c||"unauthenticated"===d)){let e=c?"?reason=".concat(encodeURIComponent(c)):"";u.replace("/login".concat(e))}},[l,o,c,u,a,d]),o)?(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading session..."}):!l&&a?null:(0,n.jsx)(n.Fragment,{children:t})}},73638:function(e,t,a){"use strict";a.d(t,{V:function(){return o},p:function(){return c}});var n=a(27573),r=a(7653),s=a(3458);function i(e){let{message:t,variant:a="info",onClose:s,duration:i=2500}=e;return(0,r.useEffect)(()=>{if(!i)return;let e=setTimeout(()=>s&&s(),i);return()=>clearTimeout(e)},[i,s]),(0,n.jsx)("div",{className:"pointer-events-auto fixed bottom-4 right-4 z-50 max-w-sm rounded-lg border bg-slate-950/90 px-4 py-3 shadow-lg shadow-black/40 backdrop-blur ".concat("success"===a?"border-emerald-500/60 text-emerald-50":"error"===a?"border-red-500/60 text-red-50":"warning"===a?"border-amber-500/60 text-amber-50":"border-slate-700 text-slate-50"),role:"status","aria-live":"polite",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)("div",{className:"text-sm",children:t}),s?(0,n.jsx)("button",{className:"ml-auto text-xs text-slate-300 opacity-80 transition hover:opacity-100",onClick:s,"aria-label":"Close",children:"x"}):null]})})}let l=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[a,o]=(0,r.useState)([]),[c,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{d(!0)},[]);let u=(0,r.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),m=(0,r.useCallback)((e,t)=>{var a,n;let r={id:Math.floor(Date.now()+1e3*Math.random()),message:e,variant:null!==(a=null==t?void 0:t.variant)&&void 0!==a?a:"info",duration:null!==(n=null==t?void 0:t.duration)&&void 0!==n?n:2500};o(e=>[...e,r])},[]),h=(0,r.useMemo)(()=>({show:m,success:(e,t)=>m(e,{variant:"success",duration:t}),error:(e,t)=>m(e,{variant:"error",duration:t}),info:(e,t)=>m(e,{variant:"info",duration:t}),warning:(e,t)=>m(e,{variant:"warning",duration:t})}),[m]);(0,r.useEffect)(()=>(globalThis.__toast=h,()=>{globalThis.__toast===h&&delete globalThis.__toast}),[h]);let f=c&&a.length>0?(0,n.jsx)(n.Fragment,{children:a.map(e=>(0,n.jsx)(i,{message:e.message,variant:e.variant,duration:e.duration,onClose:()=>u(e.id)},e.id))}):null;return(0,n.jsxs)(l.Provider,{value:h,children:[t,c&&"undefined"!=typeof document&&f?(0,s.createPortal)(f,document.body):null]})}function c(){let e=(0,r.useContext)(l);if(!e)throw Error("useToast must be used within ToastProvider");return e}},50466:function(e,t,a){"use strict";a.d(t,{z:function(){return c}});var n=a(27573),r=a(7653),s=a(8828),i=a(49289),l=a(29147);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:a,variant:r,size:i,asChild:c=!1,...d}=e,u=c?s.g7:"button";return(0,n.jsx)(u,{className:(0,l.cn)(o({variant:r,size:i,className:a})),ref:t,...d})});c.displayName="Button"},45118:function(e,t,a){"use strict";a.d(t,{QW:function(){return h},R1:function(){return u},SC:function(){return c},pE:function(){return m},sg:function(){return d},zi:function(){return f}});let n="http://localhost:4000",r=()=>window.sessionStorage,s="accessToken",i="refreshToken",l=e=>e.startsWith("/api/auth/login")||e.startsWith("/api/auth/register")||e.startsWith("/api/auth/refresh"),o=!1;async function c(e){var t,a,d,u,m,h,f,x,g;let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{method:v="GET",body:b,headers:w,_retry:y}=p,j="".concat(n).concat(e),k=r(),N=(null==k?void 0:k.getItem(s))||null,E=(null==k?void 0:k.getItem(i))||null;try{let r=await fetch(j,{method:v,headers:{"Content-Type":"application/json",...w||{},...N&&!l?{Authorization:"Bearer ".concat(N)}:{}},body:b?JSON.stringify(b):void 0,credentials:"include"}),o=await r.text(),m={};if(o)try{m=JSON.parse(o)}catch(e){m={message:o}}if(!r.ok){let o=(null==m?void 0:m.message)||"HTTP ".concat(r.status,": ").concat(r.statusText);if(console.error("[API] Request failed: ".concat(v," ").concat(j," - ").concat(o)),401===r.status&&(console.warn("[API] Unauthorized â€“ will let auth layer handle redirect / logout"),!l(e)&&!y&&E)){try{let t=await fetch("".concat(n,"/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:E}),credentials:"include"});if(t.ok){let a=await t.json(),n=null==a?void 0:a.accessToken,r=null==a?void 0:a.refreshToken;return n&&(null==k||k.setItem(s,n)),r&&(null==k||k.setItem(i,r)),c(e,{...p,_retry:!0})}}catch(e){console.error("[API] Refresh token request failed",e)}null==k||k.removeItem(s),null==k||k.removeItem(i)}if(502===r.status||503===r.status||504===r.status){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};try{null===(a=globalThis.__toast)||void 0===a||null===(t=a.error)||void 0===t||t.call(a,e.message)}catch(e){}let n=Error(e.message);throw n.code=e.code,n}try{null===(u=globalThis.__toast)||void 0===u||null===(d=u.error)||void 0===d||d.call(u,o)}catch(e){}throw Error(o)}return m}catch(t){if((null==t?void 0:null===(m=t.message)||void 0===m?void 0:m.includes("Failed to fetch"))||(null==t?void 0:null===(h=t.message)||void 0===h?void 0:h.includes("NetworkError"))||(null==t?void 0:null===(f=t.message)||void 0===f?void 0:f.includes("ECONNREFUSED"))||(null==t?void 0:t.name)==="TypeError"){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};o||(console.error("[API] Connection error: ".concat(v," ").concat(j),t),o=!0);try{null===(g=globalThis.__toast)||void 0===g||null===(x=g.error)||void 0===x||x.call(g,e.message)}catch(e){}let a=Error(e.message);throw a.code=e.code,a}if(t instanceof Error&&t.message)throw t;let e=(null==t?void 0:t.message)||"Failed to fetch: ".concat(v," ").concat(j);throw console.error("[API] Request error: ".concat(v," ").concat(j),t),Error(e)}}let d=(e,t)=>c(e,{method:"POST",body:t}),u=e=>c(e,{method:"GET"}),m=(e,t)=>c(e,{method:"PUT",body:t}),h=e=>c(e,{method:"DELETE"});async function f(e,t){let a=await fetch("".concat(n).concat(e),{method:"POST",body:t,credentials:"include"}),r=await a.text(),s=r?JSON.parse(r):{};if(!a.ok)throw Error((null==s?void 0:s.message)||"HTTP ".concat(a.status));return s}},41799:function(e,t,a){"use strict";a.d(t,{H:function(){return d},a:function(){return u}});var n=a(27573),r=a(7653),s=a(45118);let i=(0,r.createContext)(void 0),l=()=>window.sessionStorage,o="accessToken",c="refreshToken",d=e=>{let{children:t}=e,[a,d]=(0,r.useState)(null),[u,m]=(0,r.useState)("authenticating"),[h,f]=(0,r.useState)(null),[x,g]=(0,r.useState)(null),p="authenticating"===u,v=(0,r.useCallback)(()=>{let e=l();null==e||e.removeItem(o),null==e||e.removeItem(c),g(null)},[]),b=(0,r.useCallback)(()=>{let e=l();return e?{access:e.getItem(o),refresh:e.getItem(c)}:{access:null,refresh:null}},[]),w=(0,r.useCallback)((e,t)=>{let a=l();a&&(e&&a.setItem(o,e),t&&a.setItem(c,t))},[]),y=(0,r.useCallback)(async()=>{let e=await (0,s.R1)("/api/auth/me");return d(e),m("authenticated"),f(null),e},[]),j=(0,r.useCallback)(async()=>{let{refresh:e}=b();if(!e)return!1;try{let a=await (0,s.sg)("/api/auth/refresh",{refreshToken:e});if(null==a?void 0:a.accessToken){var t;return w(a.accessToken,null!==(t=a.refreshToken)&&void 0!==t?t:e),g(a.accessToken),!0}return!1}catch(e){return v(),!1}},[v,b,w]),k=(0,r.useCallback)(async(e,t)=>{f(null),m("authenticating");try{let n=await (0,s.sg)("/api/auth/login",{email:e,password:t});if(null==n?void 0:n.accessToken){var a;w(n.accessToken,null!==(a=n.refreshToken)&&void 0!==a?a:null),g(n.accessToken)}let r=(null==n?void 0:n.user)?n.user:await y();d(r),m("authenticated")}catch(e){throw f((null==e?void 0:e.message)||"Login failed"),m("unauthenticated"),v(),e}},[y,w,v]),N=(0,r.useCallback)(async()=>{try{let{refresh:e}=b();e&&await (0,s.sg)("/api/auth/logout",{refreshToken:e})}catch(e){}finally{v(),d(null),m("unauthenticated")}},[v,b]);(0,r.useEffect)(()=>{let e=!1;return(async()=>{m("authenticating");try{let{access:t,refresh:a}=b(),n=!!t;!n&&a?n=await j():t&&g(t),n?(await y(),e||m("authenticated")):e||(m("unauthenticated"),d(null))}catch(t){if(!e){let e=(null==t?void 0:t.message)||"";(e.includes("Backend API")||e.includes("BACKEND_UNAVAILABLE"))&&f(e),m("unauthenticated"),d(null),v()}}})(),()=>{e=!0}},[j,y,v,b]);let E=(0,r.useMemo)(()=>({user:a,loading:p,status:u,error:h,login:k,logout:N,accessToken:x}),[a,p,u,h,k,N,x]);return(0,n.jsx)(i.Provider,{value:E,children:t})},u=()=>{let e=(0,r.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},29147:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});let n=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter(Boolean).join(" ")}}},function(e){e.O(0,[1294,6764,1293,1528,1744],function(){return e(e.s=50094)}),_N_E=e.O()}]);