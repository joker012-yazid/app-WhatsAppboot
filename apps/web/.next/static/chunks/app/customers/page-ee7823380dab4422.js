(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[374],{9010:function(e,t,s){Promise.resolve().then(s.bind(s,7610))},7610:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var r=s(7573),n=s(7930),l=s(1988),i=s(5969),a=s(7653),o=s(2628),c=s(5118),d=s(3638),u=s(957),m=s(1799),x=s(327),f=s(466),h=s(3735),v=s(3989),b=s(4115),p=s(8146);function g(){var e,t,s;let{user:g}=(0,m.a)(),y=(0,n.NL)(),[N,j]=(0,a.useState)(""),[w,k]=(0,a.useState)(""),[C,A]=(0,a.useState)(""),[E,D]=(0,a.useState)(""),[S,M]=(0,a.useState)(""),[R,T]=(0,a.useState)(null),_=(0,d.p)(),z=(0,u.N)(),F=(0,l.a)({queryKey:["customers",N],queryFn:async()=>(0,c.R1)("/api/customers".concat(N?"?search=".concat(encodeURIComponent(N)):""))}),L=(0,i.D)({mutationFn:async()=>(0,c.sg)("/api/customers",{name:w,phone:C,email:E||void 0,notes:S||void 0}),onSuccess:()=>{k(""),A(""),D(""),M(""),y.invalidateQueries({queryKey:["customers"]}),_.success("Customer created")},onError:e=>{let t=(null==e?void 0:e.message)||"Failed to create customer";T(t),_.error(t)}}),P=(0,i.D)({mutationFn:async e=>(0,c.QW)("/api/customers/".concat(e)),onSuccess:()=>{y.invalidateQueries({queryKey:["customers"]}),_.success("Customer deleted")},onError:e=>{let t=(null==e?void 0:e.message)||"Failed to delete customer";T(t),_.error(t)}});return(0,r.jsx)(o.Z,{children:(0,r.jsxs)("section",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"rounded-xl border bg-card/80 px-6 py-5 shadow-sm backdrop-blur",children:(0,r.jsx)(h.SectionHeader,{icon:(0,r.jsx)(v.Z,{className:"h-4 w-4"}),overline:"Customers",title:"Customer Directory",description:"Search, view and create customers.",actions:(0,r.jsx)("input",{value:N,onChange:e=>j(e.target.value),placeholder:"Search name or phone",className:"w-64 rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})})}),(0,x.A)(null==g?void 0:g.role,["ADMIN","MANAGER"])?null:(0,r.jsx)("div",{className:"rounded-md border border-amber-400/60 bg-amber-500/10 px-3 py-2 text-sm text-amber-100",children:"You have read-only access to customers. Contact an administrator for edit permissions."}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,r.jsx)("div",{className:"md:col-span-2 rounded-xl border bg-card/80 shadow-sm backdrop-blur",children:F.isLoading?(0,r.jsx)("div",{className:"p-6 text-sm text-muted-foreground",children:"Loading..."}):F.isError?(0,r.jsx)("div",{className:"p-6 text-sm text-red-500",children:"Error loading customers"}):(null!==(s=null===(e=F.data)||void 0===e?void 0:e.length)&&void 0!==s?s:0)===0?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 py-10 text-center text-muted-foreground",children:[(0,r.jsx)("div",{className:"mb-2 flex h-16 w-16 items-center justify-center rounded-full border border-dashed border-slate-800 bg-slate-950/60",children:(0,r.jsx)(b.Z,{className:"h-7 w-7 text-slate-500"})}),(0,r.jsx)("p",{className:"text-sm font-medium text-slate-100",children:"No customers yet"}),(0,r.jsx)("p",{className:"text-xs text-slate-400",children:"When you add customers, they will appear here."}),(0,x.A)(null==g?void 0:g.role,["ADMIN","MANAGER"])?(0,r.jsx)(f.z,{size:"sm",className:"mt-2",asChild:!0,children:(0,r.jsx)(p.default,{href:"/customers",children:"Add your first customer"})}):null]}):(0,r.jsx)("div",{className:"overflow-hidden rounded-xl",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-slate-950/60 text-xs uppercase tracking-wide text-slate-400",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Name"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Phone"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Email"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Created"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:null===(t=F.data)||void 0===t?void 0:t.map((e,t)=>(0,r.jsxs)("tr",{className:"border-b border-slate-800/70 text-sm transition hover:bg-slate-900/70 ".concat(t%2==0?"bg-slate-950/40":""),children:[(0,r.jsx)("td",{className:"px-4 py-2",children:e.name}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.phone}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.email||"-"}),(0,r.jsx)("td",{className:"px-4 py-2",children:new Date(e.createdAt).toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-2",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)(f.z,{asChild:!0,size:"sm",variant:"outline",children:(0,r.jsx)("a",{href:"/customers/".concat(e.id),children:"View"})}),(0,x.A)(null==g?void 0:g.role,["ADMIN","MANAGER"])?(0,r.jsx)(f.z,{size:"sm",variant:"destructive",disabled:!!e._count&&(e._count.devices>0||e._count.jobs>0)||P.isPending,onClick:async()=>{await z({title:"Delete customer",description:"Are you sure you want to delete this customer? This action cannot be undone.",variant:"destructive",confirmText:"Delete"})&&P.mutate(e.id)},children:e._count&&(e._count.devices>0||e._count.jobs>0)?"Has records":"Delete"}):null]})})]},e.id))})]})})}),(0,x.A)(null==g?void 0:g.role,["ADMIN","MANAGER"])?(0,r.jsxs)("div",{className:"rounded-xl border bg-card/80 p-5 shadow-sm backdrop-blur",children:[(0,r.jsx)("h2",{className:"mb-3 text-lg font-semibold text-slate-50",children:"New customer"}),(0,r.jsxs)("form",{className:"space-y-3",onSubmit:e=>{e.preventDefault(),T(null),L.mutate()},children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"name",children:"Name"}),(0,r.jsx)("input",{id:"name",value:w,onChange:e=>k(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"phone",children:"Phone"}),(0,r.jsx)("input",{id:"phone",value:C,onChange:e=>A(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"email",children:"Email (optional)"}),(0,r.jsx)("input",{id:"email",type:"email",value:E,onChange:e=>D(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"notes",children:"Notes (optional)"}),(0,r.jsx)("textarea",{id:"notes",value:S,onChange:e=>M(e.target.value),className:"h-20 w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]}),R?(0,r.jsx)("p",{className:"text-sm text-red-500",children:R}):null,(0,r.jsx)(f.z,{type:"submit",className:"w-full",disabled:L.isPending,children:L.isPending?"Creating...":"Create customer"})]})]}):null]})]})})}},2628:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var r=s(7573),n=s(1695),l=s(7653),i=s(1799);function a(e){let{children:t,redirectOnFail:s=!0}=e,{user:a,loading:o,error:c,status:d}=(0,i.a)(),u=(0,n.useRouter)();return((0,l.useEffect)(()=>{if(s&&!o&&(!a||c||"unauthenticated"===d)){let e=c?"?reason=".concat(encodeURIComponent(c)):"";u.replace("/login".concat(e))}},[a,o,c,u,s,d]),o)?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading session..."}):!a&&s?null:(0,r.jsx)(r.Fragment,{children:t})}},957:function(e,t,s){"use strict";s.d(t,{N:function(){return o},W:function(){return a}});var r=s(7573),n=s(7653),l=s(3458);let i=(0,n.createContext)(void 0);function a(e){let{children:t}=e,[s,a]=(0,n.useState)(null),[o,c]=(0,n.useState)(!1),d=(0,n.useRef)(null),u=(0,n.useRef)(null),m=(0,n.useRef)(null);(0,n.useEffect)(()=>{c(!0)},[]);let x=(0,n.useCallback)(e=>new Promise(t=>{var s,r,n,l,i;a({id:Date.now(),resolve:t,title:null!==(s=e.title)&&void 0!==s?s:"Confirm action",description:null!==(r=e.description)&&void 0!==r?r:"Are you sure you want to proceed? This action cannot be undone.",confirmText:null!==(n=e.confirmText)&&void 0!==n?n:"Confirm",cancelText:null!==(l=e.cancelText)&&void 0!==l?l:"Cancel",variant:null!==(i=e.variant)&&void 0!==i?i:"default"})}),[]),f=(0,n.useMemo)(()=>({confirm:x}),[x]),h=(0,n.useCallback)(e=>{a(t=>(t&&t.resolve(e),null))},[]);(0,n.useEffect)(()=>{if(!s)return;d.current=document.activeElement||null;let e=setTimeout(()=>{var e;null===(e=u.current||m.current)||void 0===e||e.focus()},0),t=e=>{if(s){if("Escape"===e.key){e.preventDefault(),h(!1);return}if("Enter"===e.key){e.preventDefault(),h(!0);return}if("Tab"===e.key){let t=[m.current,u.current].filter(Boolean);if(0===t.length)return;let s=t.indexOf(document.activeElement);if(e.shiftKey){let r=s<=0?t[t.length-1]:t[s-1];e.preventDefault(),r.focus()}else{let r=-1===s||s>=t.length-1?t[0]:t[s+1];e.preventDefault(),r.focus()}}}};return document.addEventListener("keydown",t),()=>{clearTimeout(e),document.removeEventListener("keydown",t);try{var s;null===(s=d.current)||void 0===s||s.focus()}catch(e){}}},[s,h]);let v=o&&s?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"presentation",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>h(!1)}),(0,r.jsxs)("div",{className:"relative z-10 w-full max-w-sm rounded-xl border border-slate-800 bg-slate-950/90 p-5 shadow-2xl shadow-black/40 outline-none backdrop-blur",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-desc",tabIndex:-1,children:[(0,r.jsx)("h3",{id:"confirm-title",className:"mb-1 text-lg font-semibold text-slate-50",children:s.title}),(0,r.jsx)("p",{id:"confirm-desc",className:"mb-4 text-sm text-slate-300",children:s.description}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{ref:m,className:"rounded-md border border-slate-700 px-3 py-1.5 text-sm text-slate-200 transition hover:border-slate-500 hover:bg-slate-900",onClick:()=>h(!1),children:s.cancelText}),(0,r.jsx)("button",{ref:u,className:"rounded-md px-3 py-1.5 text-sm text-white transition ".concat("destructive"===s.variant?"bg-red-600 hover:bg-red-700":"bg-sky-600 hover:bg-sky-500"),onClick:()=>h(!0),children:s.confirmText})]})]})]}):null;return(0,r.jsxs)(i.Provider,{value:f,children:[t,o&&"undefined"!=typeof document&&v?(0,l.createPortal)(v,document.body):null]})}function o(){let e=(0,n.useContext)(i);if(!e)throw Error("useConfirm must be used within ConfirmProvider");return e.confirm}},3735:function(e,t,s){"use strict";s.d(t,{SectionHeader:function(){return l}});var r=s(7573),n=s(9147);function l(e){let{icon:t,overline:s,title:l,description:i,actions:a,className:o}=e;return(0,r.jsxs)("div",{className:(0,n.cn)("flex flex-wrap items-center justify-between gap-4",o),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[t?(0,r.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-full border border-sky-500/30 bg-sky-500/10 text-sky-400 shadow-sm",children:t}):null,(0,r.jsxs)("div",{children:[s?(0,r.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:s}):null,(0,r.jsx)("h1",{className:"text-xl font-semibold text-slate-50 md:text-2xl",children:l}),i?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:i}):null]})]}),a?(0,r.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:a}):null]})}},327:function(e,t,s){"use strict";s.d(t,{A:function(){return r}});let r=(e,t)=>!!e&&t.includes(e)},2389:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var r=s(7653);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&s.indexOf(e)===t).join(" ")};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,r.forwardRef)((e,t)=>{let{color:s="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:t,...i,width:n,height:n,stroke:s,strokeWidth:o?24*Number(a)/Number(n):a,className:l("lucide",c),...m},[...u.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(d)?d:[d]])}),o=(e,t)=>{let s=(0,r.forwardRef)((s,i)=>{let{className:o,...c}=s;return(0,r.createElement)(a,{ref:i,iconNode:t,className:l("lucide-".concat(n(e)),o),...c})});return s.displayName="".concat(e),s}},4115:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(2389).Z)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]])},3989:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(2389).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},8146:function(e,t,s){"use strict";s.d(t,{default:function(){return n.a}});var r=s(6340),n=s.n(r)}},function(e){e.O(0,[340,362,485,422,293,914,744],function(){return e(e.s=9010)}),_N_E=e.O()}]);