(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[374],{95204:function(e,t,r){Promise.resolve().then(r.bind(r,17610))},17610:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return y}});var n=r(27573),s=r(77930),l=r(31988),i=r(15969),o=r(7653),a=r(22628),c=r(45118),u=r(73638),d=r(10957),m=r(41799),f=r(327),p=r(50466),x=r(43735),h=r(83989),v=r(84115),b=r(88146);function y(){var e,t,r;let{user:y}=(0,m.a)(),g=(0,s.NL)(),[N,j]=(0,o.useState)(""),[w,k]=(0,o.useState)(""),[C,A]=(0,o.useState)(""),[E,S]=(0,o.useState)(""),[_,D]=(0,o.useState)(""),[R,M]=(0,o.useState)(null),z=(0,u.p)(),F=(0,d.N)(),P=(0,l.a)({queryKey:["customers",N],queryFn:async()=>(0,c.R1)("/api/customers".concat(N?"?search=".concat(encodeURIComponent(N)):""))}),T=(0,i.D)({mutationFn:async()=>(0,c.sg)("/api/customers",{name:w,phone:C,email:E||void 0,notes:_||void 0}),onSuccess:()=>{k(""),A(""),S(""),D(""),g.invalidateQueries({queryKey:["customers"]}),z.success("Customer created")},onError:e=>{let t=(null==e?void 0:e.message)||"Failed to create customer";M(t),z.error(t)}}),O=(0,i.D)({mutationFn:async e=>(0,c.QW)("/api/customers/".concat(e)),onSuccess:()=>{g.invalidateQueries({queryKey:["customers"]}),z.success("Customer deleted")},onError:e=>{let t=(null==e?void 0:e.message)||"Failed to delete customer";M(t),z.error(t)}});return(0,n.jsx)(a.Z,{children:(0,n.jsxs)("section",{className:"space-y-6",children:[(0,n.jsx)("div",{className:"rounded-xl border bg-card/80 px-6 py-5 shadow-sm backdrop-blur",children:(0,n.jsx)(x.SectionHeader,{icon:(0,n.jsx)(h.Z,{className:"h-4 w-4"}),overline:"Customers",title:"Customer Directory",description:"Search, view and create customers.",actions:(0,n.jsx)("input",{value:N,onChange:e=>j(e.target.value),placeholder:"Search name or phone",className:"w-64 rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})})}),(0,f.A)(null==y?void 0:y.role,["ADMIN","MANAGER"])?null:(0,n.jsx)("div",{className:"rounded-md border border-amber-400/60 bg-amber-500/10 px-3 py-2 text-sm text-amber-100",children:"You have read-only access to customers. Contact an administrator for edit permissions."}),(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,n.jsx)("div",{className:"md:col-span-2 rounded-xl border bg-card/80 shadow-sm backdrop-blur",children:P.isLoading?(0,n.jsx)("div",{className:"p-6 text-sm text-muted-foreground",children:"Loading..."}):P.isError?(0,n.jsx)("div",{className:"p-6 text-sm text-red-500",children:"Error loading customers"}):(null!==(r=null===(e=P.data)||void 0===e?void 0:e.length)&&void 0!==r?r:0)===0?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 py-10 text-center text-muted-foreground",children:[(0,n.jsx)("div",{className:"mb-2 flex h-16 w-16 items-center justify-center rounded-full border border-dashed border-slate-800 bg-slate-950/60",children:(0,n.jsx)(v.Z,{className:"h-7 w-7 text-slate-500"})}),(0,n.jsx)("p",{className:"text-sm font-medium text-slate-100",children:"No customers yet"}),(0,n.jsx)("p",{className:"text-xs text-slate-400",children:"When you add customers, they will appear here."}),(0,f.A)(null==y?void 0:y.role,["ADMIN","MANAGER"])?(0,n.jsx)(p.z,{size:"sm",className:"mt-2",asChild:!0,children:(0,n.jsx)(b.default,{href:"/customers",children:"Add your first customer"})}):null]}):(0,n.jsx)("div",{className:"overflow-hidden rounded-xl",children:(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{className:"bg-slate-950/60 text-xs uppercase tracking-wide text-slate-400",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-3 text-left",children:"Name"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left",children:"Phone"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left",children:"Email"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left",children:"Created"}),(0,n.jsx)("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),(0,n.jsx)("tbody",{children:null===(t=P.data)||void 0===t?void 0:t.map((e,t)=>(0,n.jsxs)("tr",{className:"border-b border-slate-800/70 text-sm transition hover:bg-slate-900/70 ".concat(t%2==0?"bg-slate-950/40":""),children:[(0,n.jsx)("td",{className:"px-4 py-2",children:e.name}),(0,n.jsx)("td",{className:"px-4 py-2",children:e.phone}),(0,n.jsx)("td",{className:"px-4 py-2",children:e.email||"-"}),(0,n.jsx)("td",{className:"px-4 py-2",children:new Date(e.createdAt).toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2",children:(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)(p.z,{asChild:!0,size:"sm",variant:"outline",children:(0,n.jsx)("a",{href:"/customers/".concat(e.id),children:"View"})}),(0,f.A)(null==y?void 0:y.role,["ADMIN","MANAGER"])?(0,n.jsx)(p.z,{size:"sm",variant:"destructive",disabled:!!e._count&&(e._count.devices>0||e._count.jobs>0)||O.isPending,onClick:async()=>{await F({title:"Delete customer",description:"Are you sure you want to delete this customer? This action cannot be undone.",variant:"destructive",confirmText:"Delete"})&&O.mutate(e.id)},children:e._count&&(e._count.devices>0||e._count.jobs>0)?"Has records":"Delete"}):null]})})]},e.id))})]})})}),(0,f.A)(null==y?void 0:y.role,["ADMIN","MANAGER"])?(0,n.jsxs)("div",{className:"rounded-xl border bg-card/80 p-5 shadow-sm backdrop-blur",children:[(0,n.jsx)("h2",{className:"mb-3 text-lg font-semibold text-slate-50",children:"New customer"}),(0,n.jsxs)("form",{className:"space-y-3",onSubmit:e=>{e.preventDefault(),M(null),T.mutate()},children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"text-sm font-medium",htmlFor:"name",children:"Name"}),(0,n.jsx)("input",{id:"name",value:w,onChange:e=>k(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",required:!0})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"text-sm font-medium",htmlFor:"phone",children:"Phone"}),(0,n.jsx)("input",{id:"phone",value:C,onChange:e=>A(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",required:!0})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"text-sm font-medium",htmlFor:"email",children:"Email (optional)"}),(0,n.jsx)("input",{id:"email",type:"email",value:E,onChange:e=>S(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"text-sm font-medium",htmlFor:"notes",children:"Notes (optional)"}),(0,n.jsx)("textarea",{id:"notes",value:_,onChange:e=>D(e.target.value),className:"h-20 w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]}),R?(0,n.jsx)("p",{className:"text-sm text-red-500",children:R}):null,(0,n.jsx)(p.z,{type:"submit",className:"w-full",disabled:T.isPending,children:T.isPending?"Creating...":"Create customer"})]})]}):null]})]})})}},10957:function(e,t,r){"use strict";r.d(t,{N:function(){return a},W:function(){return o}});var n=r(27573),s=r(7653),l=r(3458);let i=(0,s.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,s.useState)(null),[a,c]=(0,s.useState)(!1),u=(0,s.useRef)(null),d=(0,s.useRef)(null),m=(0,s.useRef)(null);(0,s.useEffect)(()=>{c(!0)},[]);let f=(0,s.useCallback)(e=>new Promise(t=>{var r,n,s,l,i;o({id:Date.now(),resolve:t,title:null!==(r=e.title)&&void 0!==r?r:"Confirm action",description:null!==(n=e.description)&&void 0!==n?n:"Are you sure you want to proceed? This action cannot be undone.",confirmText:null!==(s=e.confirmText)&&void 0!==s?s:"Confirm",cancelText:null!==(l=e.cancelText)&&void 0!==l?l:"Cancel",variant:null!==(i=e.variant)&&void 0!==i?i:"default"})}),[]),p=(0,s.useMemo)(()=>({confirm:f}),[f]),x=(0,s.useCallback)(e=>{o(t=>(t&&t.resolve(e),null))},[]);(0,s.useEffect)(()=>{if(!r)return;u.current=document.activeElement||null;let e=setTimeout(()=>{var e;null===(e=d.current||m.current)||void 0===e||e.focus()},0),t=e=>{if(r){if("Escape"===e.key){e.preventDefault(),x(!1);return}if("Enter"===e.key){e.preventDefault(),x(!0);return}if("Tab"===e.key){let t=[m.current,d.current].filter(Boolean);if(0===t.length)return;let r=t.indexOf(document.activeElement);if(e.shiftKey){let n=r<=0?t[t.length-1]:t[r-1];e.preventDefault(),n.focus()}else{let n=-1===r||r>=t.length-1?t[0]:t[r+1];e.preventDefault(),n.focus()}}}};return document.addEventListener("keydown",t),()=>{clearTimeout(e),document.removeEventListener("keydown",t);try{var r;null===(r=u.current)||void 0===r||r.focus()}catch(e){}}},[r,x]);let h=a&&r?(0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"presentation",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>x(!1)}),(0,n.jsxs)("div",{className:"relative z-10 w-full max-w-sm rounded-xl border border-slate-800 bg-slate-950/90 p-5 shadow-2xl shadow-black/40 outline-none backdrop-blur",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-desc",tabIndex:-1,children:[(0,n.jsx)("h3",{id:"confirm-title",className:"mb-1 text-lg font-semibold text-slate-50",children:r.title}),(0,n.jsx)("p",{id:"confirm-desc",className:"mb-4 text-sm text-slate-300",children:r.description}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{ref:m,className:"rounded-md border border-slate-700 px-3 py-1.5 text-sm text-slate-200 transition hover:border-slate-500 hover:bg-slate-900",onClick:()=>x(!1),children:r.cancelText}),(0,n.jsx)("button",{ref:d,className:"rounded-md px-3 py-1.5 text-sm text-white transition ".concat("destructive"===r.variant?"bg-red-600 hover:bg-red-700":"bg-sky-600 hover:bg-sky-500"),onClick:()=>x(!0),children:r.confirmText})]})]})]}):null;return(0,n.jsxs)(i.Provider,{value:p,children:[t,a&&"undefined"!=typeof document&&h?(0,l.createPortal)(h,document.body):null]})}function a(){let e=(0,s.useContext)(i);if(!e)throw Error("useConfirm must be used within ConfirmProvider");return e.confirm}},327:function(e,t,r){"use strict";r.d(t,{A:function(){return n}});let n=(e,t)=>!!e&&t.includes(e)},2389:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(7653);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&r.indexOf(e)===t).join(" ")};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:a,className:c="",children:u,iconNode:d,...m}=e;return(0,n.createElement)("svg",{ref:t,...i,width:s,height:s,stroke:r,strokeWidth:a?24*Number(o)/Number(s):o,className:l("lucide",c),...m},[...d.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),a=(e,t)=>{let r=(0,n.forwardRef)((r,i)=>{let{className:a,...c}=r;return(0,n.createElement)(o,{ref:i,iconNode:t,className:l("lucide-".concat(s(e)),a),...c})});return r.displayName="".concat(e),r}},84115:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(2389).Z)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]])},83989:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(2389).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},88146:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var n=r(16340),s=r.n(n)},94492:function(e,t,r){"use strict";r.d(t,{F:function(){return l},e:function(){return i}});var n=r(7653);function s(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function l(...e){return t=>{let r=!1,n=e.map(e=>{let n=s(e,t);return r||"function"!=typeof n||(r=!0),n});if(r)return()=>{for(let t=0;t<n.length;t++){let r=n[t];"function"==typeof r?r():s(e[t],null)}}}}function i(...e){return n.useCallback(l(...e),e)}},8828:function(e,t,r){"use strict";r.d(t,{g7:function(){return u}});var n,s=r(7653),l=r(94492),i=r(27573),o=Symbol.for("react.lazy"),a=(n||(n=r.t(s,2)))[" use ".trim().toString()];function c(e){var t;return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===o&&"_payload"in e&&"object"==typeof(t=e._payload)&&null!==t&&"then"in t}var u=function(e){let t=function(e){let t=s.forwardRef((e,t)=>{let{children:r,...n}=e;if(c(r)&&"function"==typeof a&&(r=a(r._payload)),s.isValidElement(r)){var i;let e,o;let a=(i=r,(e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?i.props.ref:i.props.ref||i.ref),c=function(e,t){let r={...t};for(let n in t){let s=e[n],l=t[n];/^on[A-Z]/.test(n)?s&&l?r[n]=(...e)=>{let t=l(...e);return s(...e),t}:s&&(r[n]=s):"style"===n?r[n]={...s,...l}:"className"===n&&(r[n]=[s,l].filter(Boolean).join(" "))}return{...e,...r}}(n,r.props);return r.type!==s.Fragment&&(c.ref=t?(0,l.F)(t,a):a),s.cloneElement(r,c)}return s.Children.count(r)>1?s.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=s.forwardRef((e,r)=>{let{children:n,...l}=e;c(n)&&"function"==typeof a&&(n=a(n._payload));let o=s.Children.toArray(n),u=o.find(m);if(u){let e=u.props.children,n=o.map(t=>t!==u?t:s.Children.count(e)>1?s.Children.only(null):s.isValidElement(e)?e.props.children:null);return(0,i.jsx)(t,{...l,ref:r,children:s.isValidElement(e)?s.cloneElement(e,void 0,n):null})}return(0,i.jsx)(t,{...l,ref:r,children:n})});return r.displayName=`${e}.Slot`,r}("Slot"),d=Symbol("radix.slottable");function m(e){return s.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===d}},49289:function(e,t,r){"use strict";r.d(t,{j:function(){return i}});var n=r(10607);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,l=n.W,i=(e,t)=>r=>{var n;if((null==t?void 0:t.variants)==null)return l(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:i,defaultVariants:o}=t,a=Object.keys(i).map(e=>{let t=null==r?void 0:r[e],n=null==o?void 0:o[e];if(null===t)return null;let l=s(t)||s(n);return i[e][l]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,n]=t;return void 0===n||(e[r]=n),e},{});return l(e,a,null==t?void 0:null===(n=t.compoundVariants)||void 0===n?void 0:n.reduce((e,t)=>{let{class:r,className:n,...s}=t;return Object.entries(s).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...o,...c}[t]):({...o,...c})[t]===r})?[...e,r,n]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}},10607:function(e,t,r){"use strict";function n(){for(var e,t,r=0,n="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=function e(t){var r,n,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t){if(Array.isArray(t)){var l=t.length;for(r=0;r<l;r++)t[r]&&(n=e(t[r]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n)}return s}(e))&&(n&&(n+=" "),n+=t);return n}r.d(t,{W:function(){return n}})}},function(e){e.O(0,[6340,3953,4701,3171,1293,1528,1744],function(){return e(e.s=95204)}),_N_E=e.O()}]);