(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[348],{3385:function(e,s,t){Promise.resolve().then(t.bind(t,7912))},7912:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var r=t(7573),n=t(7930),i=t(1988),l=t(5969),a=t(7653),o=t(2628),d=t(8146),c=t(5118),u=t(3638),m=t(957),x=t(1799),f=t(327),v=t(466),b=t(3735),h=t(7999),p=t(4115);function g(){var e,s;let{user:t}=(0,x.a)(),g=(0,n.NL)(),[N,y]=(0,a.useState)(""),[j,w]=(0,a.useState)(""),[k,C]=(0,a.useState)(""),[A,E]=(0,a.useState)(""),[D,T]=(0,a.useState)(""),[S,M]=(0,a.useState)(""),[F,I]=(0,a.useState)(null),R=(0,u.p)(),z=(0,m.N)(),L=(0,i.a)({queryKey:["customers","forDeviceForm"],queryFn:async()=>(0,c.R1)("/api/customers")}),P=(0,i.a)({queryKey:["devices",N||"all"],queryFn:async()=>(0,c.R1)("/api/devices".concat(N?"?customerId=".concat(encodeURIComponent(N)):""))}),Z=(0,l.D)({mutationFn:async()=>(0,c.sg)("/api/devices",{customerId:N,deviceType:j,brand:k||void 0,model:A||void 0,serialNumber:D||void 0,notes:S||void 0}),onSuccess:()=>{w(""),C(""),E(""),T(""),M(""),g.invalidateQueries({queryKey:["devices"]}),R.success("Device created")},onError:e=>{let s=(null==e?void 0:e.message)||"Failed to create device";I(s),R.error(s)}}),_=L.data||[],q=(0,a.useMemo)(()=>_.find(e=>e.id===N),[_,N]),H=(0,l.D)({mutationFn:async e=>(0,c.QW)("/api/devices/".concat(e)),onSuccess:()=>{g.invalidateQueries({queryKey:["devices"]}),R.success("Device deleted")},onError:e=>{let s=(null==e?void 0:e.message)||"Failed to delete device";I(s),R.error(s)}});return(0,r.jsx)(o.Z,{children:(0,r.jsxs)("section",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"rounded-xl border bg-card/80 px-6 py-5 shadow-sm backdrop-blur",children:(0,r.jsx)(b.SectionHeader,{icon:(0,r.jsx)(h.Z,{className:"h-4 w-4"}),overline:"Devices",title:"Registered Devices",description:"Filter by customer and add new devices.",actions:(0,r.jsxs)("select",{value:N,onChange:e=>y(e.target.value),className:"min-w-52 rounded-md border border-input bg-background/80 px-3 py-2 text-sm text-foreground shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",children:[(0,r.jsx)("option",{value:"",className:"bg-background text-foreground",children:"All customers"}),_.map(e=>(0,r.jsx)("option",{value:e.id,className:"bg-background text-foreground",children:e.name},e.id))]})})}),(0,f.A)(null==t?void 0:t.role,["ADMIN","MANAGER","TECHNICIAN"])?null:(0,r.jsx)("div",{className:"rounded-md border border-amber-400/60 bg-amber-500/10 px-3 py-2 text-sm text-amber-100",children:"You have read-only access to devices. Contact an administrator for edit permissions."}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,r.jsx)("div",{className:"md:col-span-2 rounded-xl border bg-card/80 shadow-sm backdrop-blur",children:P.isLoading?(0,r.jsx)("div",{className:"p-6 text-sm text-muted-foreground",children:"Loading..."}):P.isError?(0,r.jsx)("div",{className:"p-6 text-sm text-red-500",children:"Error loading devices"}):(null!==(s=null===(e=P.data)||void 0===e?void 0:e.length)&&void 0!==s?s:0)===0?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 py-10 text-center text-muted-foreground",children:[(0,r.jsx)("div",{className:"mb-2 flex h-16 w-16 items-center justify-center rounded-full border border-dashed border-slate-800 bg-slate-950/60",children:(0,r.jsx)(p.Z,{className:"h-7 w-7 text-slate-500"})}),(0,r.jsx)("p",{className:"text-sm font-medium text-slate-100",children:"No devices yet"}),(0,r.jsx)("p",{className:"text-xs text-slate-400",children:"Add devices to start tracking repairs and links to customers."}),(0,f.A)(null==t?void 0:t.role,["ADMIN","MANAGER","TECHNICIAN"])?(0,r.jsx)(v.z,{size:"sm",className:"mt-2",asChild:!0,children:(0,r.jsx)(d.default,{href:"/devices",children:"Add your first device"})}):null]}):(0,r.jsx)("div",{className:"overflow-hidden rounded-xl",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-slate-950/60 text-xs uppercase tracking-wide text-slate-400",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Customer"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Type"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Brand"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Model"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Serial"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Created"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:(P.data||[]).map((e,s)=>{var n;return(0,r.jsxs)("tr",{className:"border-b border-slate-800/70 text-sm transition hover:bg-slate-900/70 ".concat(s%2==0?"bg-slate-950/40":""),children:[(0,r.jsx)("td",{className:"px-4 py-2",children:null===(n=e.customer)||void 0===n?void 0:n.name}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.deviceType}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.brand||"-"}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.model||"-"}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.serialNumber||"-"}),(0,r.jsx)("td",{className:"px-4 py-2",children:new Date(e.createdAt).toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-2",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)(v.z,{asChild:!0,size:"sm",variant:"outline",children:(0,r.jsx)(d.default,{href:"/devices/".concat(e.id),children:"View"})}),(0,f.A)(null==t?void 0:t.role,["ADMIN","MANAGER"])?(0,r.jsx)(v.z,{size:"sm",variant:"destructive",disabled:!!e._count&&e._count.jobs>0||H.isPending,onClick:async()=>{await z({title:"Delete device",description:"Are you sure you want to delete this device? This action cannot be undone.",variant:"destructive",confirmText:"Delete"})&&H.mutate(e.id)},children:e._count&&e._count.jobs>0?"Has jobs":"Delete"}):null]})})]},e.id)})})]})})}),(0,f.A)(null==t?void 0:t.role,["ADMIN","MANAGER","TECHNICIAN"])?(0,r.jsxs)("div",{className:"rounded-xl border bg-card/80 p-5 shadow-sm backdrop-blur",children:[(0,r.jsx)("h2",{className:"mb-3 text-lg font-semibold text-slate-50",children:"New device"}),(0,r.jsxs)("form",{className:"space-y-3",onSubmit:e=>{e.preventDefault(),I(null),Z.mutate()},children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"customer",children:"Customer"}),(0,r.jsxs)("select",{id:"customer",value:N,onChange:e=>y(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm text-foreground shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",required:!0,children:[(0,r.jsx)("option",{value:"",disabled:!0,className:"bg-background text-foreground",children:"Select customer"}),_.map(e=>(0,r.jsx)("option",{value:e.id,className:"bg-background text-foreground",children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"deviceType",children:"Device type"}),(0,r.jsx)("input",{id:"deviceType",value:j,onChange:e=>w(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",placeholder:"Phone / Tablet / PC",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"brand",children:"Brand"}),(0,r.jsx)("input",{id:"brand",value:k,onChange:e=>C(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"model",children:"Model"}),(0,r.jsx)("input",{id:"model",value:A,onChange:e=>E(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"serial",children:"Serial"}),(0,r.jsx)("input",{id:"serial",value:D,onChange:e=>T(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"notes",children:"Notes"}),(0,r.jsx)("input",{id:"notes",value:S,onChange:e=>M(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]})]}),F?(0,r.jsx)("p",{className:"text-sm text-red-500",children:F}):null,(0,r.jsx)(v.z,{className:"w-full",type:"submit",disabled:Z.isPending||!N,children:Z.isPending?"Creating...":"Add device".concat(q?" for ".concat(q.name):"")})]})]}):null]})]})})}},2628:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});var r=t(7573),n=t(1695),i=t(7653),l=t(1799);function a(e){let{children:s,redirectOnFail:t=!0}=e,{user:a,loading:o,error:d,status:c}=(0,l.a)(),u=(0,n.useRouter)();return((0,i.useEffect)(()=>{if(t&&!o&&(!a||d||"unauthenticated"===c)){let e=d?"?reason=".concat(encodeURIComponent(d)):"";u.replace("/login".concat(e))}},[a,o,d,u,t,c]),o)?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading session..."}):!a&&t?null:(0,r.jsx)(r.Fragment,{children:s})}},957:function(e,s,t){"use strict";t.d(s,{N:function(){return o},W:function(){return a}});var r=t(7573),n=t(7653),i=t(3458);let l=(0,n.createContext)(void 0);function a(e){let{children:s}=e,[t,a]=(0,n.useState)(null),[o,d]=(0,n.useState)(!1),c=(0,n.useRef)(null),u=(0,n.useRef)(null),m=(0,n.useRef)(null);(0,n.useEffect)(()=>{d(!0)},[]);let x=(0,n.useCallback)(e=>new Promise(s=>{var t,r,n,i,l;a({id:Date.now(),resolve:s,title:null!==(t=e.title)&&void 0!==t?t:"Confirm action",description:null!==(r=e.description)&&void 0!==r?r:"Are you sure you want to proceed? This action cannot be undone.",confirmText:null!==(n=e.confirmText)&&void 0!==n?n:"Confirm",cancelText:null!==(i=e.cancelText)&&void 0!==i?i:"Cancel",variant:null!==(l=e.variant)&&void 0!==l?l:"default"})}),[]),f=(0,n.useMemo)(()=>({confirm:x}),[x]),v=(0,n.useCallback)(e=>{a(s=>(s&&s.resolve(e),null))},[]);(0,n.useEffect)(()=>{if(!t)return;c.current=document.activeElement||null;let e=setTimeout(()=>{var e;null===(e=u.current||m.current)||void 0===e||e.focus()},0),s=e=>{if(t){if("Escape"===e.key){e.preventDefault(),v(!1);return}if("Enter"===e.key){e.preventDefault(),v(!0);return}if("Tab"===e.key){let s=[m.current,u.current].filter(Boolean);if(0===s.length)return;let t=s.indexOf(document.activeElement);if(e.shiftKey){let r=t<=0?s[s.length-1]:s[t-1];e.preventDefault(),r.focus()}else{let r=-1===t||t>=s.length-1?s[0]:s[t+1];e.preventDefault(),r.focus()}}}};return document.addEventListener("keydown",s),()=>{clearTimeout(e),document.removeEventListener("keydown",s);try{var t;null===(t=c.current)||void 0===t||t.focus()}catch(e){}}},[t,v]);let b=o&&t?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"presentation",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>v(!1)}),(0,r.jsxs)("div",{className:"relative z-10 w-full max-w-sm rounded-xl border border-slate-800 bg-slate-950/90 p-5 shadow-2xl shadow-black/40 outline-none backdrop-blur",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-desc",tabIndex:-1,children:[(0,r.jsx)("h3",{id:"confirm-title",className:"mb-1 text-lg font-semibold text-slate-50",children:t.title}),(0,r.jsx)("p",{id:"confirm-desc",className:"mb-4 text-sm text-slate-300",children:t.description}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{ref:m,className:"rounded-md border border-slate-700 px-3 py-1.5 text-sm text-slate-200 transition hover:border-slate-500 hover:bg-slate-900",onClick:()=>v(!1),children:t.cancelText}),(0,r.jsx)("button",{ref:u,className:"rounded-md px-3 py-1.5 text-sm text-white transition ".concat("destructive"===t.variant?"bg-red-600 hover:bg-red-700":"bg-sky-600 hover:bg-sky-500"),onClick:()=>v(!0),children:t.confirmText})]})]})]}):null;return(0,r.jsxs)(l.Provider,{value:f,children:[s,o&&"undefined"!=typeof document&&b?(0,i.createPortal)(b,document.body):null]})}function o(){let e=(0,n.useContext)(l);if(!e)throw Error("useConfirm must be used within ConfirmProvider");return e.confirm}},3735:function(e,s,t){"use strict";t.d(s,{SectionHeader:function(){return i}});var r=t(7573),n=t(9147);function i(e){let{icon:s,overline:t,title:i,description:l,actions:a,className:o}=e;return(0,r.jsxs)("div",{className:(0,n.cn)("flex flex-wrap items-center justify-between gap-4",o),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[s?(0,r.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-full border border-sky-500/30 bg-sky-500/10 text-sky-400 shadow-sm",children:s}):null,(0,r.jsxs)("div",{children:[t?(0,r.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:t}):null,(0,r.jsx)("h1",{className:"text-xl font-semibold text-slate-50 md:text-2xl",children:i}),l?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:l}):null]})]}),a?(0,r.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:a}):null]})}},327:function(e,s,t){"use strict";t.d(s,{A:function(){return r}});let r=(e,s)=>!!e&&s.includes(e)},2389:function(e,s,t){"use strict";t.d(s,{Z:function(){return o}});var r=t(7653);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e,s,t)=>!!e&&t.indexOf(e)===s).join(" ")};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,r.forwardRef)((e,s)=>{let{color:t="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:d="",children:c,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:s,...l,width:n,height:n,stroke:t,strokeWidth:o?24*Number(a)/Number(n):a,className:i("lucide",d),...m},[...u.map(e=>{let[s,t]=e;return(0,r.createElement)(s,t)}),...Array.isArray(c)?c:[c]])}),o=(e,s)=>{let t=(0,r.forwardRef)((t,l)=>{let{className:o,...d}=t;return(0,r.createElement)(a,{ref:l,iconNode:s,className:i("lucide-".concat(n(e)),o),...d})});return t.displayName="".concat(e),t}},4115:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(2389).Z)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]])},7999:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(2389).Z)("MonitorSmartphone",[["path",{d:"M18 8V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h8",key:"10dyio"}],["path",{d:"M10 19v-3.96 3.15",key:"1irgej"}],["path",{d:"M7 19h5",key:"qswx4l"}],["rect",{width:"6",height:"10",x:"16",y:"12",rx:"2",key:"1egngj"}]])},8146:function(e,s,t){"use strict";t.d(s,{default:function(){return n.a}});var r=t(6340),n=t.n(r)}},function(e){e.O(0,[340,362,485,422,293,914,744],function(){return e(e.s=3385)}),_N_E=e.O()}]);