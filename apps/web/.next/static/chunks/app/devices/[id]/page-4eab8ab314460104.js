(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[684],{514:function(e,t,s){Promise.resolve().then(s.bind(s,3840))},3840:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var n=s(7573),l=s(8146),a=s(1695),r=s(7930),i=s(1988),d=s(5969),c=s(7653),o=s(2628),u=s(5118),m=s(466),x=s(3638),v=s(957),f=s(1799),b=s(327);function h(){let{id:e}=(0,a.useParams)(),t=(0,a.useRouter)(),{user:s}=(0,f.a)(),h=(0,r.NL)(),p=(0,i.a)({queryKey:["device",e],queryFn:async()=>(0,u.R1)("/api/devices/".concat(e))}).data,[N,j]=(0,c.useState)(""),[g,y]=(0,c.useState)(""),[A,C]=(0,c.useState)(""),[E,D]=(0,c.useState)(""),[w,I]=(0,c.useState)(""),[k,T]=(0,c.useState)(null),M=(0,x.p)(),R=(0,v.N)();(0,c.useEffect)(()=>{p&&(j(p.deviceType||""),y(p.brand||""),C(p.model||""),D(p.serialNumber||""),I(p.notes||""))},[null==p?void 0:p.id]);let S=(0,d.D)({mutationFn:async()=>(0,u.pE)("/api/devices/".concat(e),{deviceType:N,brand:g,model:A,serialNumber:E,notes:w}),onSuccess:async()=>{await h.invalidateQueries({queryKey:["device",e]}),await h.invalidateQueries({queryKey:["devices"]}),M.success("Device updated")},onError:e=>{let t=(null==e?void 0:e.message)||"Failed to save";T(t),M.error(t)}}),F=(0,d.D)({mutationFn:async()=>(0,u.QW)("/api/devices/".concat(e)),onSuccess:async()=>{await h.invalidateQueries({queryKey:["devices"]}),M.success("Device deleted"),t.replace("/devices")},onError:e=>{let t=(null==e?void 0:e.message)||"Failed to delete";T(t),M.error(t)}});return(0,n.jsx)(o.Z,{children:(0,n.jsxs)("section",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs uppercase tracking-[0.35em] text-muted-foreground",children:"Device Detail"}),(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:p?"".concat(p.deviceType," ").concat(p.brand||""," ").concat(p.model||""):"Loading…"}),p?(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:p.customer.name}):null]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(m.z,{variant:"outline",asChild:!0,children:(0,n.jsx)(l.default,{href:"/devices",children:"Back"})}),(0,b.A)(null==s?void 0:s.role,["ADMIN","MANAGER"])?(0,n.jsx)(m.z,{variant:"destructive",disabled:!!(null==p?void 0:p.jobs)&&p.jobs.length>0||F.isPending,onClick:async()=>{await R({title:"Delete device",description:"Are you sure you want to delete this device? This action cannot be undone.",variant:"destructive",confirmText:"Delete"})&&F.mutate()},children:(null==p?void 0:p.jobs)&&p.jobs.length>0?"Has jobs":"Delete"}):null]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,n.jsxs)("div",{className:"md:col-span-2 rounded-xl border bg-card p-4",children:[(0,n.jsx)("h2",{className:"mb-3 text-lg font-semibold",children:"Edit Device"}),(0,b.A)(null==s?void 0:s.role,["ADMIN","MANAGER","TECHNICIAN"])?null:(0,n.jsx)("p",{className:"mb-3 text-sm text-amber-700",children:"You have read-only access. Editing is restricted to Admin/Manager/Technician."}),(null==p?void 0:p.jobs)&&p.jobs.length>0?(0,n.jsxs)("p",{className:"mb-3 text-sm text-amber-600",children:["This device has ",p.jobs.length," job(s). Deletion is disabled."]}):null,(0,n.jsxs)("form",{className:"space-y-3",onSubmit:e=>{e.preventDefault(),T(null),S.mutate()},children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"text-sm font-medium",htmlFor:"type",children:"Device type"}),(0,n.jsx)("input",{id:"type",value:N,onChange:e=>j(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",required:!0,disabled:!(0,b.A)(null==s?void 0:s.role,["ADMIN","MANAGER","TECHNICIAN"])})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"text-sm font-medium",htmlFor:"brand",children:"Brand"}),(0,n.jsx)("input",{id:"brand",value:g,onChange:e=>y(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",disabled:!(0,b.A)(null==s?void 0:s.role,["ADMIN","MANAGER","TECHNICIAN"])})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"text-sm font-medium",htmlFor:"model",children:"Model"}),(0,n.jsx)("input",{id:"model",value:A,onChange:e=>C(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",disabled:!(0,b.A)(null==s?void 0:s.role,["ADMIN","MANAGER","TECHNICIAN"])})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"text-sm font-medium",htmlFor:"serial",children:"Serial"}),(0,n.jsx)("input",{id:"serial",value:E,onChange:e=>D(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",disabled:!(0,b.A)(null==s?void 0:s.role,["ADMIN","MANAGER","TECHNICIAN"])})]})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("label",{className:"text-sm font-medium",htmlFor:"notes",children:"Notes"}),(0,n.jsx)("input",{id:"notes",value:w,onChange:e=>I(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",disabled:!(0,b.A)(null==s?void 0:s.role,["ADMIN","MANAGER","TECHNICIAN"])})]}),k?(0,n.jsx)("p",{className:"text-sm text-red-500",children:k}):null,(0,b.A)(null==s?void 0:s.role,["ADMIN","MANAGER","TECHNICIAN"])?(0,n.jsx)(m.z,{type:"submit",disabled:S.isPending,children:S.isPending?"Saving…":"Save changes"}):null]})]}),(0,n.jsxs)("aside",{className:"rounded-xl border bg-card p-4",children:[(0,n.jsx)("h3",{className:"mb-2 text-sm font-semibold text-muted-foreground",children:"Related Jobs"}),p?p.jobs&&0!==p.jobs.length?(0,n.jsx)("ul",{className:"space-y-2 text-sm",children:p.jobs.map(e=>(0,n.jsx)("li",{children:(0,n.jsx)(l.default,{href:"/jobs/".concat(e.id),className:"underline hover:no-underline",children:e.title})},e.id))}):(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"No jobs."}):(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading…"})]})]})]})})}},2628:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var n=s(7573),l=s(1695),a=s(7653),r=s(1799);function i(e){let{children:t,redirectOnFail:s=!0}=e,{user:i,loading:d,error:c,status:o}=(0,r.a)(),u=(0,l.useRouter)();return((0,a.useEffect)(()=>{if(s&&!d&&(!i||c||"unauthenticated"===o)){let e=c?"?reason=".concat(encodeURIComponent(c)):"";u.replace("/login".concat(e))}},[i,d,c,u,s,o]),d)?(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading session..."}):!i&&s?null:(0,n.jsx)(n.Fragment,{children:t})}},957:function(e,t,s){"use strict";s.d(t,{N:function(){return d},W:function(){return i}});var n=s(7573),l=s(7653),a=s(3458);let r=(0,l.createContext)(void 0);function i(e){let{children:t}=e,[s,i]=(0,l.useState)(null),[d,c]=(0,l.useState)(!1),o=(0,l.useRef)(null),u=(0,l.useRef)(null),m=(0,l.useRef)(null);(0,l.useEffect)(()=>{c(!0)},[]);let x=(0,l.useCallback)(e=>new Promise(t=>{var s,n,l,a,r;i({id:Date.now(),resolve:t,title:null!==(s=e.title)&&void 0!==s?s:"Confirm action",description:null!==(n=e.description)&&void 0!==n?n:"Are you sure you want to proceed? This action cannot be undone.",confirmText:null!==(l=e.confirmText)&&void 0!==l?l:"Confirm",cancelText:null!==(a=e.cancelText)&&void 0!==a?a:"Cancel",variant:null!==(r=e.variant)&&void 0!==r?r:"default"})}),[]),v=(0,l.useMemo)(()=>({confirm:x}),[x]),f=(0,l.useCallback)(e=>{i(t=>(t&&t.resolve(e),null))},[]);(0,l.useEffect)(()=>{if(!s)return;o.current=document.activeElement||null;let e=setTimeout(()=>{var e;null===(e=u.current||m.current)||void 0===e||e.focus()},0),t=e=>{if(s){if("Escape"===e.key){e.preventDefault(),f(!1);return}if("Enter"===e.key){e.preventDefault(),f(!0);return}if("Tab"===e.key){let t=[m.current,u.current].filter(Boolean);if(0===t.length)return;let s=t.indexOf(document.activeElement);if(e.shiftKey){let n=s<=0?t[t.length-1]:t[s-1];e.preventDefault(),n.focus()}else{let n=-1===s||s>=t.length-1?t[0]:t[s+1];e.preventDefault(),n.focus()}}}};return document.addEventListener("keydown",t),()=>{clearTimeout(e),document.removeEventListener("keydown",t);try{var s;null===(s=o.current)||void 0===s||s.focus()}catch(e){}}},[s,f]);let b=d&&s?(0,n.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"presentation",children:[(0,n.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>f(!1)}),(0,n.jsxs)("div",{className:"relative z-10 w-full max-w-sm rounded-xl border border-slate-800 bg-slate-950/90 p-5 shadow-2xl shadow-black/40 outline-none backdrop-blur",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-desc",tabIndex:-1,children:[(0,n.jsx)("h3",{id:"confirm-title",className:"mb-1 text-lg font-semibold text-slate-50",children:s.title}),(0,n.jsx)("p",{id:"confirm-desc",className:"mb-4 text-sm text-slate-300",children:s.description}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{ref:m,className:"rounded-md border border-slate-700 px-3 py-1.5 text-sm text-slate-200 transition hover:border-slate-500 hover:bg-slate-900",onClick:()=>f(!1),children:s.cancelText}),(0,n.jsx)("button",{ref:u,className:"rounded-md px-3 py-1.5 text-sm text-white transition ".concat("destructive"===s.variant?"bg-red-600 hover:bg-red-700":"bg-sky-600 hover:bg-sky-500"),onClick:()=>f(!0),children:s.confirmText})]})]})]}):null;return(0,n.jsxs)(r.Provider,{value:v,children:[t,d&&"undefined"!=typeof document&&b?(0,a.createPortal)(b,document.body):null]})}function d(){let e=(0,l.useContext)(r);if(!e)throw Error("useConfirm must be used within ConfirmProvider");return e.confirm}},327:function(e,t,s){"use strict";s.d(t,{A:function(){return n}});let n=(e,t)=>!!e&&t.includes(e)},8146:function(e,t,s){"use strict";s.d(t,{default:function(){return l.a}});var n=s(6340),l=s.n(n)}},function(e){e.O(0,[340,362,485,422,293,914,744],function(){return e(e.s=514)}),_N_E=e.O()}]);