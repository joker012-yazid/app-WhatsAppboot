(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8348],{30143:function(e,t,s){Promise.resolve().then(s.bind(s,37912))},37912:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var r=s(27573),n=s(77930),l=s(31988),i=s(15969),a=s(7653),o=s(22628),c=s(88146),d=s(45118),u=s(73638),f=s(10957),m=s(41799),v=s(327),x=s(50466),p=s(43735),b=s(47999),h=s(84115);function g(){var e,t;let{user:s}=(0,m.a)(),g=(0,n.NL)(),[y,N]=(0,a.useState)(""),[j,w]=(0,a.useState)(""),[k,C]=(0,a.useState)(""),[A,E]=(0,a.useState)(""),[D,S]=(0,a.useState)(""),[T,R]=(0,a.useState)(""),[_,F]=(0,a.useState)(null),M=(0,u.p)(),I=(0,f.N)(),z=(0,l.a)({queryKey:["customers","forDeviceForm"],queryFn:async()=>(0,d.R1)("/api/customers")}),P=(0,l.a)({queryKey:["devices",y||"all"],queryFn:async()=>(0,d.R1)("/api/devices".concat(y?"?customerId=".concat(encodeURIComponent(y)):""))}),O=(0,i.D)({mutationFn:async()=>(0,d.sg)("/api/devices",{customerId:y,deviceType:j,brand:k||void 0,model:A||void 0,serialNumber:D||void 0,notes:T||void 0}),onSuccess:()=>{w(""),C(""),E(""),S(""),R(""),g.invalidateQueries({queryKey:["devices"]}),M.success("Device created")},onError:e=>{let t=(null==e?void 0:e.message)||"Failed to create device";F(t),M.error(t)}}),W=z.data||[],Z=(0,a.useMemo)(()=>W.find(e=>e.id===y),[W,y]),q=(0,i.D)({mutationFn:async e=>(0,d.QW)("/api/devices/".concat(e)),onSuccess:()=>{g.invalidateQueries({queryKey:["devices"]}),M.success("Device deleted")},onError:e=>{let t=(null==e?void 0:e.message)||"Failed to delete device";F(t),M.error(t)}});return(0,r.jsx)(o.Z,{children:(0,r.jsxs)("section",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"rounded-xl border bg-card/80 px-6 py-5 shadow-sm backdrop-blur",children:(0,r.jsx)(p.SectionHeader,{icon:(0,r.jsx)(b.Z,{className:"h-4 w-4"}),overline:"Devices",title:"Registered Devices",description:"Filter by customer and add new devices.",actions:(0,r.jsxs)("select",{value:y,onChange:e=>N(e.target.value),className:"min-w-52 rounded-md border border-input bg-background/80 px-3 py-2 text-sm text-foreground shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",children:[(0,r.jsx)("option",{value:"",className:"bg-background text-foreground",children:"All customers"}),W.map(e=>(0,r.jsx)("option",{value:e.id,className:"bg-background text-foreground",children:e.name},e.id))]})})}),(0,v.A)(null==s?void 0:s.role,["ADMIN","MANAGER","TECHNICIAN"])?null:(0,r.jsx)("div",{className:"rounded-md border border-amber-400/60 bg-amber-500/10 px-3 py-2 text-sm text-amber-100",children:"You have read-only access to devices. Contact an administrator for edit permissions."}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,r.jsx)("div",{className:"md:col-span-2 rounded-xl border bg-card/80 shadow-sm backdrop-blur",children:P.isLoading?(0,r.jsx)("div",{className:"p-6 text-sm text-muted-foreground",children:"Loading..."}):P.isError?(0,r.jsx)("div",{className:"p-6 text-sm text-red-500",children:"Error loading devices"}):(null!==(t=null===(e=P.data)||void 0===e?void 0:e.length)&&void 0!==t?t:0)===0?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 py-10 text-center text-muted-foreground",children:[(0,r.jsx)("div",{className:"mb-2 flex h-16 w-16 items-center justify-center rounded-full border border-dashed border-slate-800 bg-slate-950/60",children:(0,r.jsx)(h.Z,{className:"h-7 w-7 text-slate-500"})}),(0,r.jsx)("p",{className:"text-sm font-medium text-slate-100",children:"No devices yet"}),(0,r.jsx)("p",{className:"text-xs text-slate-400",children:"Add devices to start tracking repairs and links to customers."}),(0,v.A)(null==s?void 0:s.role,["ADMIN","MANAGER","TECHNICIAN"])?(0,r.jsx)(x.z,{size:"sm",className:"mt-2",asChild:!0,children:(0,r.jsx)(c.default,{href:"/devices",children:"Add your first device"})}):null]}):(0,r.jsx)("div",{className:"overflow-hidden rounded-xl",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-slate-950/60 text-xs uppercase tracking-wide text-slate-400",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Customer"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Type"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Brand"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Model"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Serial"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Created"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:(P.data||[]).map((e,t)=>{var n;return(0,r.jsxs)("tr",{className:"border-b border-slate-800/70 text-sm transition hover:bg-slate-900/70 ".concat(t%2==0?"bg-slate-950/40":""),children:[(0,r.jsx)("td",{className:"px-4 py-2",children:null===(n=e.customer)||void 0===n?void 0:n.name}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.deviceType}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.brand||"-"}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.model||"-"}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.serialNumber||"-"}),(0,r.jsx)("td",{className:"px-4 py-2",children:new Date(e.createdAt).toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-2",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)(x.z,{asChild:!0,size:"sm",variant:"outline",children:(0,r.jsx)(c.default,{href:"/devices/".concat(e.id),children:"View"})}),(0,v.A)(null==s?void 0:s.role,["ADMIN","MANAGER"])?(0,r.jsx)(x.z,{size:"sm",variant:"destructive",disabled:!!e._count&&e._count.jobs>0||q.isPending,onClick:async()=>{await I({title:"Delete device",description:"Are you sure you want to delete this device? This action cannot be undone.",variant:"destructive",confirmText:"Delete"})&&q.mutate(e.id)},children:e._count&&e._count.jobs>0?"Has jobs":"Delete"}):null]})})]},e.id)})})]})})}),(0,v.A)(null==s?void 0:s.role,["ADMIN","MANAGER","TECHNICIAN"])?(0,r.jsxs)("div",{className:"rounded-xl border bg-card/80 p-5 shadow-sm backdrop-blur",children:[(0,r.jsx)("h2",{className:"mb-3 text-lg font-semibold text-slate-50",children:"New device"}),(0,r.jsxs)("form",{className:"space-y-3",onSubmit:e=>{e.preventDefault(),F(null),O.mutate()},children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"customer",children:"Customer"}),(0,r.jsxs)("select",{id:"customer",value:y,onChange:e=>N(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm text-foreground shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",required:!0,children:[(0,r.jsx)("option",{value:"",disabled:!0,className:"bg-background text-foreground",children:"Select customer"}),W.map(e=>(0,r.jsx)("option",{value:e.id,className:"bg-background text-foreground",children:e.name},e.id))]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"deviceType",children:"Device type"}),(0,r.jsx)("input",{id:"deviceType",value:j,onChange:e=>w(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",placeholder:"Phone / Tablet / PC",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"brand",children:"Brand"}),(0,r.jsx)("input",{id:"brand",value:k,onChange:e=>C(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"model",children:"Model"}),(0,r.jsx)("input",{id:"model",value:A,onChange:e=>E(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"serial",children:"Serial"}),(0,r.jsx)("input",{id:"serial",value:D,onChange:e=>S(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium",htmlFor:"notes",children:"Notes"}),(0,r.jsx)("input",{id:"notes",value:T,onChange:e=>R(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]})]}),_?(0,r.jsx)("p",{className:"text-sm text-red-500",children:_}):null,(0,r.jsx)(x.z,{className:"w-full",type:"submit",disabled:O.isPending||!y,children:O.isPending?"Creating...":"Add device".concat(Z?" for ".concat(Z.name):"")})]})]}):null]})]})})}},10957:function(e,t,s){"use strict";s.d(t,{N:function(){return o},W:function(){return a}});var r=s(27573),n=s(7653),l=s(3458);let i=(0,n.createContext)(void 0);function a(e){let{children:t}=e,[s,a]=(0,n.useState)(null),[o,c]=(0,n.useState)(!1),d=(0,n.useRef)(null),u=(0,n.useRef)(null),f=(0,n.useRef)(null);(0,n.useEffect)(()=>{c(!0)},[]);let m=(0,n.useCallback)(e=>new Promise(t=>{var s,r,n,l,i;a({id:Date.now(),resolve:t,title:null!==(s=e.title)&&void 0!==s?s:"Confirm action",description:null!==(r=e.description)&&void 0!==r?r:"Are you sure you want to proceed? This action cannot be undone.",confirmText:null!==(n=e.confirmText)&&void 0!==n?n:"Confirm",cancelText:null!==(l=e.cancelText)&&void 0!==l?l:"Cancel",variant:null!==(i=e.variant)&&void 0!==i?i:"default"})}),[]),v=(0,n.useMemo)(()=>({confirm:m}),[m]),x=(0,n.useCallback)(e=>{a(t=>(t&&t.resolve(e),null))},[]);(0,n.useEffect)(()=>{if(!s)return;d.current=document.activeElement||null;let e=setTimeout(()=>{var e;null===(e=u.current||f.current)||void 0===e||e.focus()},0),t=e=>{if(s){if("Escape"===e.key){e.preventDefault(),x(!1);return}if("Enter"===e.key){e.preventDefault(),x(!0);return}if("Tab"===e.key){let t=[f.current,u.current].filter(Boolean);if(0===t.length)return;let s=t.indexOf(document.activeElement);if(e.shiftKey){let r=s<=0?t[t.length-1]:t[s-1];e.preventDefault(),r.focus()}else{let r=-1===s||s>=t.length-1?t[0]:t[s+1];e.preventDefault(),r.focus()}}}};return document.addEventListener("keydown",t),()=>{clearTimeout(e),document.removeEventListener("keydown",t);try{var s;null===(s=d.current)||void 0===s||s.focus()}catch(e){}}},[s,x]);let p=o&&s?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"presentation",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>x(!1)}),(0,r.jsxs)("div",{className:"relative z-10 w-full max-w-sm rounded-xl border border-slate-800 bg-slate-950/90 p-5 shadow-2xl shadow-black/40 outline-none backdrop-blur",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-desc",tabIndex:-1,children:[(0,r.jsx)("h3",{id:"confirm-title",className:"mb-1 text-lg font-semibold text-slate-50",children:s.title}),(0,r.jsx)("p",{id:"confirm-desc",className:"mb-4 text-sm text-slate-300",children:s.description}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{ref:f,className:"rounded-md border border-slate-700 px-3 py-1.5 text-sm text-slate-200 transition hover:border-slate-500 hover:bg-slate-900",onClick:()=>x(!1),children:s.cancelText}),(0,r.jsx)("button",{ref:u,className:"rounded-md px-3 py-1.5 text-sm text-white transition ".concat("destructive"===s.variant?"bg-red-600 hover:bg-red-700":"bg-sky-600 hover:bg-sky-500"),onClick:()=>x(!0),children:s.confirmText})]})]})]}):null;return(0,r.jsxs)(i.Provider,{value:v,children:[t,o&&"undefined"!=typeof document&&p?(0,l.createPortal)(p,document.body):null]})}function o(){let e=(0,n.useContext)(i);if(!e)throw Error("useConfirm must be used within ConfirmProvider");return e.confirm}},327:function(e,t,s){"use strict";s.d(t,{A:function(){return r}});let r=(e,t)=>!!e&&t.includes(e)},2389:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var r=s(7653);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&s.indexOf(e)===t).join(" ")};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,r.forwardRef)((e,t)=>{let{color:s="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...f}=e;return(0,r.createElement)("svg",{ref:t,...i,width:n,height:n,stroke:s,strokeWidth:o?24*Number(a)/Number(n):a,className:l("lucide",c),...f},[...u.map(e=>{let[t,s]=e;return(0,r.createElement)(t,s)}),...Array.isArray(d)?d:[d]])}),o=(e,t)=>{let s=(0,r.forwardRef)((s,i)=>{let{className:o,...c}=s;return(0,r.createElement)(a,{ref:i,iconNode:t,className:l("lucide-".concat(n(e)),o),...c})});return s.displayName="".concat(e),s}},84115:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(2389).Z)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]])},47999:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(2389).Z)("MonitorSmartphone",[["path",{d:"M18 8V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h8",key:"10dyio"}],["path",{d:"M10 19v-3.96 3.15",key:"1irgej"}],["path",{d:"M7 19h5",key:"qswx4l"}],["rect",{width:"6",height:"10",x:"16",y:"12",rx:"2",key:"1egngj"}]])},88146:function(e,t,s){"use strict";s.d(t,{default:function(){return n.a}});var r=s(16340),n=s.n(r)},94492:function(e,t,s){"use strict";s.d(t,{F:function(){return l},e:function(){return i}});var r=s(7653);function n(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function l(...e){return t=>{let s=!1,r=e.map(e=>{let r=n(e,t);return s||"function"!=typeof r||(s=!0),r});if(s)return()=>{for(let t=0;t<r.length;t++){let s=r[t];"function"==typeof s?s():n(e[t],null)}}}}function i(...e){return r.useCallback(l(...e),e)}},8828:function(e,t,s){"use strict";s.d(t,{g7:function(){return d}});var r,n=s(7653),l=s(94492),i=s(27573),a=Symbol.for("react.lazy"),o=(r||(r=s.t(n,2)))[" use ".trim().toString()];function c(e){var t;return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===a&&"_payload"in e&&"object"==typeof(t=e._payload)&&null!==t&&"then"in t}var d=function(e){let t=function(e){let t=n.forwardRef((e,t)=>{let{children:s,...r}=e;if(c(s)&&"function"==typeof o&&(s=o(s._payload)),n.isValidElement(s)){var i;let e,a;let o=(i=s,(e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?i.props.ref:i.props.ref||i.ref),c=function(e,t){let s={...t};for(let r in t){let n=e[r],l=t[r];/^on[A-Z]/.test(r)?n&&l?s[r]=(...e)=>{let t=l(...e);return n(...e),t}:n&&(s[r]=n):"style"===r?s[r]={...n,...l}:"className"===r&&(s[r]=[n,l].filter(Boolean).join(" "))}return{...e,...s}}(r,s.props);return s.type!==n.Fragment&&(c.ref=t?(0,l.F)(t,o):o),n.cloneElement(s,c)}return n.Children.count(s)>1?n.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),s=n.forwardRef((e,s)=>{let{children:r,...l}=e;c(r)&&"function"==typeof o&&(r=o(r._payload));let a=n.Children.toArray(r),d=a.find(f);if(d){let e=d.props.children,r=a.map(t=>t!==d?t:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,i.jsx)(t,{...l,ref:s,children:n.isValidElement(e)?n.cloneElement(e,void 0,r):null})}return(0,i.jsx)(t,{...l,ref:s,children:r})});return s.displayName=`${e}.Slot`,s}("Slot"),u=Symbol("radix.slottable");function f(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===u}},49289:function(e,t,s){"use strict";s.d(t,{j:function(){return i}});var r=s(10607);let n=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,l=r.W,i=(e,t)=>s=>{var r;if((null==t?void 0:t.variants)==null)return l(e,null==s?void 0:s.class,null==s?void 0:s.className);let{variants:i,defaultVariants:a}=t,o=Object.keys(i).map(e=>{let t=null==s?void 0:s[e],r=null==a?void 0:a[e];if(null===t)return null;let l=n(t)||n(r);return i[e][l]}),c=s&&Object.entries(s).reduce((e,t)=>{let[s,r]=t;return void 0===r||(e[s]=r),e},{});return l(e,o,null==t?void 0:null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:s,className:r,...n}=t;return Object.entries(n).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...a,...c}[t]):({...a,...c})[t]===s})?[...e,s,r]:e},[]),null==s?void 0:s.class,null==s?void 0:s.className)}},10607:function(e,t,s){"use strict";function r(){for(var e,t,s=0,r="",n=arguments.length;s<n;s++)(e=arguments[s])&&(t=function e(t){var s,r,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t){if(Array.isArray(t)){var l=t.length;for(s=0;s<l;s++)t[s]&&(r=e(t[s]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r)}return n}(e))&&(r&&(r+=" "),r+=t);return r}s.d(t,{W:function(){return r}})}},function(e){e.O(0,[6340,3953,4701,3171,1293,1528,1744],function(){return e(e.s=30143)}),_N_E=e.O()}]);