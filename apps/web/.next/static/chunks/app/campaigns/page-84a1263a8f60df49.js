(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[905],{7531:function(e,s,a){Promise.resolve().then(a.bind(a,4425))},4425:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return b}});var t=a(7573),n=a(7653),l=a(7930),r=a(1988),i=a(5969),d=a(2628),c=a(5118),m=a(466),o=a(3638);let u=(0,a(2389).Z)("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]);var x=a(4115),p=a(3735);let g=["PROMOTIONAL","ANNOUNCEMENT","FOLLOW_UP","CUSTOM"],h=["VIP","REGULAR","NEW","PROSPECT"],f=e=>{if(!e)return 0;let[s,a]=e.split(":").map(e=>Number(e));return 60*s+a};function b(){var e;let s=(0,l.NL)(),a=(0,o.p)(),[b,N]=(0,n.useState)("New Campaign"),[j,v]=(0,n.useState)("PROMOTIONAL"),[y,w]=(0,n.useState)("Hi {name}, kami ada promo terbaru minggu ini. Balas jika berminat!"),[C,S]=(0,n.useState)(["REGULAR"]),[k,E]=(0,n.useState)(""),[P,D]=(0,n.useState)("OPT_OUT"),[L,A]=(0,n.useState)("90"),[O,z]=(0,n.useState)(""),[R,T]=(0,n.useState)(""),[U,F]=(0,n.useState)("09:00"),[M,I]=(0,n.useState)("18:00"),[_,Z]=(0,n.useState)("150"),[B,H]=(0,n.useState)("30"),[q,K]=(0,n.useState)("60"),[W,G]=(0,n.useState)(""),[Q,V]=(0,n.useState)(null),$=(0,r.a)({queryKey:["campaigns"],queryFn:async()=>(0,c.R1)("/api/campaigns")}),J=()=>{let e=R.split(/\n|,/).map(e=>e.trim()).filter(Boolean);return{customerTypes:C.length?C:void 0,tags:k?k.split(",").map(e=>e.trim()).filter(Boolean):void 0,excludeTags:P?P.split(",").map(e=>e.trim()).filter(Boolean):void 0,lastVisitDays:L?Number(L):void 0,inactiveDays:O?Number(O):void 0,manualPhones:e.length?e:void 0}},X=(0,i.D)({mutationFn:async()=>(0,c.sg)("/api/campaigns",{name:b,kind:j,message:y,filters:J(),businessHours:{start:f(U),end:f(M)},dailyLimit:Number(_)||150,randomDelay:{min:Number(B)||30,max:Number(q)||60},scheduledFor:W?new Date(W).toISOString():void 0}),onSuccess:()=>{a.success("Campaign saved"),s.invalidateQueries({queryKey:["campaigns"]})},onError:e=>a.error((null==e?void 0:e.message)||"Unable to save campaign")}),Y=(0,i.D)({mutationFn:async()=>(0,c.sg)("/api/campaigns/preview",{filters:J()}),onSuccess:e=>V(e),onError:e=>a.error((null==e?void 0:e.message)||"Preview failed")}),ee=(0,i.D)({mutationFn:async e=>{let{id:s,action:a}=e;return(0,c.sg)("/api/campaigns/".concat(s,"/").concat(a),{})},onSuccess:(e,t)=>{a.success("Campaign ".concat(t.action)),s.invalidateQueries({queryKey:["campaigns"]})},onError:e=>a.error((null==e?void 0:e.message)||"Action failed")}),es=e=>{switch(e){case"RUNNING":return"bg-emerald-100 text-emerald-700";case"PAUSED":return"bg-yellow-100 text-yellow-700";case"COMPLETED":return"bg-blue-100 text-blue-700";case"CANCELLED":return"bg-gray-200 text-gray-700";default:return"bg-slate-100 text-slate-700"}};return(0,t.jsx)(d.Z,{children:(0,t.jsxs)("section",{className:"space-y-8",children:[(0,t.jsx)("div",{className:"rounded-xl border bg-card/80 px-6 py-5 shadow-sm backdrop-blur",children:(0,t.jsx)(p.SectionHeader,{icon:(0,t.jsx)(u,{className:"h-4 w-4"}),overline:"Campaigns",title:"Campaigns",description:"Configure outbound WhatsApp campaigns with anti-ban rules.",actions:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(m.z,{variant:"outline",onClick:()=>Y.mutate(),disabled:Y.isPending,children:Y.isPending?"Previewing...":"Preview filters"}),(0,t.jsx)(m.z,{onClick:()=>X.mutate(),disabled:X.isPending,children:X.isPending?"Saving...":"Save Draft"})]})})}),(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,t.jsxs)("div",{className:"space-y-4 rounded-xl border bg-card p-4 lg:col-span-2",children:[(0,t.jsx)("h2",{className:"font-semibold",children:"Campaign brief"}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Name"}),(0,t.jsx)("input",{className:"w-full rounded-md border bg-transparent px-3 py-2",value:b,onChange:e=>N(e.target.value)})]}),(0,t.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Kind"}),(0,t.jsx)("select",{className:"w-full rounded-md border bg-background px-3 py-2 text-foreground",value:j,onChange:e=>v(e.target.value),children:g.map(e=>(0,t.jsx)("option",{value:e,className:"bg-background text-foreground",children:e.replace("_"," ")},e))})]}),(0,t.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Business hours (start)"}),(0,t.jsx)("input",{type:"time",className:"w-full rounded-md border bg-transparent px-3 py-2",value:U,onChange:e=>F(e.target.value)})]}),(0,t.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Business hours (end)"}),(0,t.jsx)("input",{type:"time",className:"w-full rounded-md border bg-transparent px-3 py-2",value:M,onChange:e=>I(e.target.value)})]}),(0,t.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Daily limit"}),(0,t.jsx)("input",{type:"number",className:"w-full rounded-md border bg-transparent px-3 py-2",value:_,onChange:e=>Z(e.target.value)})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Delay min (s)"}),(0,t.jsx)("input",{type:"number",className:"w-full rounded-md border bg-transparent px-3 py-2",value:B,onChange:e=>H(e.target.value)})]}),(0,t.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Delay max (s)"}),(0,t.jsx)("input",{type:"number",className:"w-full rounded-md border bg-transparent px-3 py-2",value:q,onChange:e=>K(e.target.value)})]})]}),(0,t.jsxs)("label",{className:"space-y-1 text-sm md:col-span-2",children:[(0,t.jsx)("span",{className:"font-medium",children:"Schedule (optional)"}),(0,t.jsx)("input",{type:"datetime-local",className:"w-full rounded-md border bg-transparent px-3 py-2",value:W,onChange:e=>G(e.target.value)})]})]}),(0,t.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Message Template"}),(0,t.jsx)("textarea",{className:"min-h-[140px] w-full rounded-md border bg-transparent px-3 py-2",value:y,onChange:e=>w(e.target.value)}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Use variables like ","{name}"," or ","{phone}",". Delays & business hours are enforced automatically."]})]})]}),(0,t.jsxs)("div",{className:"space-y-4 rounded-xl border bg-card p-4",children:[(0,t.jsx)("h2",{className:"font-semibold",children:"Filters"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Customer Types"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 pt-1 text-xs",children:h.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>S(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]),className:"rounded-full border px-3 py-1 ".concat(C.includes(e)?"border-primary bg-primary/10 text-primary":"text-muted-foreground"),children:e},e))})]}),(0,t.jsxs)("label",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"Include tags (comma separated)"}),(0,t.jsx)("input",{className:"w-full rounded-md border bg-transparent px-3 py-2",value:k,onChange:e=>E(e.target.value)})]}),(0,t.jsxs)("label",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"Exclude tags"}),(0,t.jsx)("input",{className:"w-full rounded-md border bg-transparent px-3 py-2",value:P,onChange:e=>D(e.target.value)})]}),(0,t.jsxs)("label",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"Last visit within (days)"}),(0,t.jsx)("input",{type:"number",className:"w-full rounded-md border bg-transparent px-3 py-2",value:L,onChange:e=>A(e.target.value)})]}),(0,t.jsxs)("label",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"Inactive for at least (days)"}),(0,t.jsx)("input",{type:"number",className:"w-full rounded-md border bg-transparent px-3 py-2",value:O,onChange:e=>z(e.target.value)})]}),(0,t.jsxs)("label",{className:"space-y-1",children:[(0,t.jsx)("span",{className:"font-medium",children:"Manual phone numbers"}),(0,t.jsx)("textarea",{className:"h-24 w-full rounded-md border bg-transparent px-3 py-2",value:R,onChange:e=>T(e.target.value),placeholder:"Separate numbers with commas or new lines"})]})]}),Q?(0,t.jsxs)("div",{className:"rounded-lg border bg-background p-3 text-xs",children:[(0,t.jsx)("p",{className:"font-semibold",children:"Preview"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Matches: ",Q.totalCustomers," | Manual: ",Q.manualCount]}),(0,t.jsx)("ul",{className:"mt-2 space-y-1",children:Q.sample.slice(0,5).map(e=>(0,t.jsxs)("li",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsx)("span",{className:"font-mono",children:e.phone})]},"".concat(e.phone,"-").concat(e.customerId)))})]}):null]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Existing campaigns"}),(0,t.jsx)(m.z,{variant:"ghost",size:"sm",onClick:()=>s.invalidateQueries({queryKey:["campaigns"]}),children:"Refresh"})]}),$.isLoading?(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading campaigns..."}):$.isError?(0,t.jsx)("p",{className:"text-sm text-red-500",children:"Failed to load campaigns"}):(null===(e=$.data)||void 0===e?void 0:e.length)?(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:$.data.map(e=>(0,t.jsxs)("article",{className:"rounded-xl border bg-card p-4",children:[(0,t.jsxs)("header",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.kind}),(0,t.jsx)("h3",{className:"text-lg font-semibold",children:e.name})]}),(0,t.jsx)("span",{className:"rounded-full px-2 py-1 text-xs font-semibold ".concat(es(e.status)),children:e.status})]}),(0,t.jsxs)("dl",{className:"mt-3 grid grid-cols-3 gap-3 text-xs",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("dt",{className:"text-muted-foreground",children:"Targets"}),(0,t.jsx)("dd",{className:"text-base font-semibold",children:e.targetCount})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("dt",{className:"text-muted-foreground",children:"Sent"}),(0,t.jsx)("dd",{className:"text-base font-semibold text-emerald-600",children:e.sentCount})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("dt",{className:"text-muted-foreground",children:"Failed"}),(0,t.jsx)("dd",{className:"text-base font-semibold text-red-600",children:e.failedCount})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2 text-xs",children:[e.scheduledFor?(0,t.jsxs)("span",{className:"rounded bg-muted px-2 py-1",children:["Scheduled: ",new Date(e.scheduledFor).toLocaleString()]}):null,e.startedAt?(0,t.jsxs)("span",{className:"rounded bg-muted px-2 py-1",children:["Started: ",new Date(e.startedAt).toLocaleString()]}):null,(0,t.jsxs)("span",{className:"rounded bg-muted px-2 py-1",children:["Daily limit: ",e.dailyLimit]})]}),(0,t.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2 text-sm",children:[["DRAFT","SCHEDULED","PAUSED"].includes(e.status)?(0,t.jsx)(m.z,{size:"sm",onClick:()=>ee.mutate({id:e.id,action:"start"}),disabled:ee.isPending,children:"Start"}):null,"RUNNING"===e.status?(0,t.jsx)(m.z,{size:"sm",variant:"outline",onClick:()=>ee.mutate({id:e.id,action:"pause"}),disabled:ee.isPending,children:"Pause"}):null,"PAUSED"===e.status?(0,t.jsx)(m.z,{size:"sm",variant:"outline",onClick:()=>ee.mutate({id:e.id,action:"resume"}),disabled:ee.isPending,children:"Resume"}):null,["COMPLETED","CANCELLED"].includes(e.status)?null:(0,t.jsx)(m.z,{size:"sm",variant:"destructive",onClick:()=>ee.mutate({id:e.id,action:"cancel"}),disabled:ee.isPending,children:"Cancel"})]})]},e.id))}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 py-10 text-center text-muted-foreground",children:[(0,t.jsx)("div",{className:"mb-2 flex h-16 w-16 items-center justify-center rounded-full border border-dashed border-slate-800 bg-slate-950/60",children:(0,t.jsx)(x.Z,{className:"h-7 w-7 text-slate-500"})}),(0,t.jsx)("p",{className:"text-sm font-medium text-slate-100",children:"No campaigns yet"}),(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"Draft a campaign and preview your filters to begin outreach."}),(0,t.jsx)(m.z,{size:"sm",className:"mt-2",onClick:()=>X.mutate(),disabled:X.isPending,children:X.isPending?"Saving...":"Create your first campaign"})]})]})]})})}},2628:function(e,s,a){"use strict";a.d(s,{Z:function(){return i}});var t=a(7573),n=a(1695),l=a(7653),r=a(1799);function i(e){let{children:s,redirectOnFail:a=!0}=e,{user:i,loading:d,error:c,status:m}=(0,r.a)(),o=(0,n.useRouter)();return((0,l.useEffect)(()=>{if(a&&!d&&(!i||c||"unauthenticated"===m)){let e=c?"?reason=".concat(encodeURIComponent(c)):"";o.replace("/login".concat(e))}},[i,d,c,o,a,m]),d)?(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading session..."}):!i&&a?null:(0,t.jsx)(t.Fragment,{children:s})}},3735:function(e,s,a){"use strict";a.d(s,{SectionHeader:function(){return l}});var t=a(7573),n=a(9147);function l(e){let{icon:s,overline:a,title:l,description:r,actions:i,className:d}=e;return(0,t.jsxs)("div",{className:(0,n.cn)("flex flex-wrap items-center justify-between gap-4",d),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[s?(0,t.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-full border border-sky-500/30 bg-sky-500/10 text-sky-400 shadow-sm",children:s}):null,(0,t.jsxs)("div",{children:[a?(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:a}):null,(0,t.jsx)("h1",{className:"text-xl font-semibold text-slate-50 md:text-2xl",children:l}),r?(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:r}):null]})]}),i?(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:i}):null]})}},2389:function(e,s,a){"use strict";a.d(s,{Z:function(){return d}});var t=a(7653);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return s.filter((e,s,a)=>!!e&&a.indexOf(e)===s).join(" ")};var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,t.forwardRef)((e,s)=>{let{color:a="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:d,className:c="",children:m,iconNode:o,...u}=e;return(0,t.createElement)("svg",{ref:s,...r,width:n,height:n,stroke:a,strokeWidth:d?24*Number(i)/Number(n):i,className:l("lucide",c),...u},[...o.map(e=>{let[s,a]=e;return(0,t.createElement)(s,a)}),...Array.isArray(m)?m:[m]])}),d=(e,s)=>{let a=(0,t.forwardRef)((a,r)=>{let{className:d,...c}=a;return(0,t.createElement)(i,{ref:r,iconNode:s,className:l("lucide-".concat(n(e)),d),...c})});return a.displayName="".concat(e),a}},4115:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(2389).Z)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]])}},function(e){e.O(0,[362,485,422,293,914,744],function(){return e(e.s=7531)}),_N_E=e.O()}]);