(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{19198:function(e,t,a){Promise.resolve().then(a.bind(a,11403))},11403:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var n=a(27573),r=a(7653),s=a(81695),l=a(83185),o=a(90743),c=a(41799);function i(){let e=(0,s.useRouter)(),{user:t,loading:a}=(0,c.a)();return(0,r.useEffect)(()=>{a||(t?e.replace("/dashboard"):e.replace("/login"))},[t,a,e]),(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,n.jsxs)(l.E.div,{className:"flex flex-col items-center gap-6",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:[(0,n.jsx)(l.E.div,{className:"flex h-20 w-20 items-center justify-center rounded-2xl bg-gradient-to-br from-primary to-purple-500 shadow-xl shadow-primary/25",animate:{scale:[1,1.05,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:(0,n.jsx)(o.Z,{className:"h-10 w-10 text-white"})}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"WhatsApp Bot POS"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"SuperApp"})]}),(0,n.jsx)("div",{className:"flex items-center gap-1.5",children:[0,1,2].map(e=>(0,n.jsx)(l.E.div,{className:"h-2 w-2 rounded-full bg-primary",animate:{y:[-4,0,-4]},transition:{duration:.6,repeat:1/0,delay:.15*e,ease:"easeInOut"}},e))})]})})}},45118:function(e,t,a){"use strict";a.d(t,{QW:function(){return f},R1:function(){return d},SC:function(){return i},pE:function(){return h},sg:function(){return u},zi:function(){return m}});let n="http://localhost:4000",r=()=>window.sessionStorage,s="accessToken",l="refreshToken",o=e=>e.startsWith("/api/auth/login")||e.startsWith("/api/auth/register")||e.startsWith("/api/auth/refresh"),c=!1;async function i(e){var t,a,u,d,h,f,m,v,g;let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{method:y="GET",body:k,headers:w,_retry:T}=p,E="".concat(n).concat(e),P=r(),x=(null==P?void 0:P.getItem(s))||null,A=(null==P?void 0:P.getItem(l))||null;try{let r=await fetch(E,{method:y,headers:{"Content-Type":"application/json",...w||{},...x&&!o?{Authorization:"Bearer ".concat(x)}:{}},body:k?JSON.stringify(k):void 0,credentials:"include"}),c=await r.text(),h={};if(c)try{h=JSON.parse(c)}catch(e){h={message:c}}if(!r.ok){let c=(null==h?void 0:h.message)||"HTTP ".concat(r.status,": ").concat(r.statusText);if(console.error("[API] Request failed: ".concat(y," ").concat(E," - ").concat(c)),401===r.status&&(console.warn("[API] Unauthorized â€“ will let auth layer handle redirect / logout"),!o(e)&&!T&&A)){try{let t=await fetch("".concat(n,"/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:A}),credentials:"include"});if(t.ok){let a=await t.json(),n=null==a?void 0:a.accessToken,r=null==a?void 0:a.refreshToken;return n&&(null==P||P.setItem(s,n)),r&&(null==P||P.setItem(l,r)),i(e,{...p,_retry:!0})}}catch(e){console.error("[API] Refresh token request failed",e)}null==P||P.removeItem(s),null==P||P.removeItem(l)}if(502===r.status||503===r.status||504===r.status){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};try{null===(a=globalThis.__toast)||void 0===a||null===(t=a.error)||void 0===t||t.call(a,e.message)}catch(e){}let n=Error(e.message);throw n.code=e.code,n}try{null===(d=globalThis.__toast)||void 0===d||null===(u=d.error)||void 0===u||u.call(d,c)}catch(e){}throw Error(c)}return h}catch(t){if((null==t?void 0:null===(h=t.message)||void 0===h?void 0:h.includes("Failed to fetch"))||(null==t?void 0:null===(f=t.message)||void 0===f?void 0:f.includes("NetworkError"))||(null==t?void 0:null===(m=t.message)||void 0===m?void 0:m.includes("ECONNREFUSED"))||(null==t?void 0:t.name)==="TypeError"){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};c||(console.error("[API] Connection error: ".concat(y," ").concat(E),t),c=!0);try{null===(g=globalThis.__toast)||void 0===g||null===(v=g.error)||void 0===v||v.call(g,e.message)}catch(e){}let a=Error(e.message);throw a.code=e.code,a}if(t instanceof Error&&t.message)throw t;let e=(null==t?void 0:t.message)||"Failed to fetch: ".concat(y," ").concat(E);throw console.error("[API] Request error: ".concat(y," ").concat(E),t),Error(e)}}let u=(e,t)=>i(e,{method:"POST",body:t}),d=e=>i(e,{method:"GET"}),h=(e,t)=>i(e,{method:"PUT",body:t}),f=e=>i(e,{method:"DELETE"});async function m(e,t){let a=await fetch("".concat(n).concat(e),{method:"POST",body:t,credentials:"include"}),r=await a.text(),s=r?JSON.parse(r):{};if(!a.ok)throw Error((null==s?void 0:s.message)||"HTTP ".concat(a.status));return s}},41799:function(e,t,a){"use strict";a.d(t,{H:function(){return u},a:function(){return d}});var n=a(27573),r=a(7653),s=a(45118);let l=(0,r.createContext)(void 0),o=()=>window.sessionStorage,c="accessToken",i="refreshToken",u=e=>{let{children:t}=e,[a,u]=(0,r.useState)(null),[d,h]=(0,r.useState)("authenticating"),[f,m]=(0,r.useState)(null),[v,g]=(0,r.useState)(null),p="authenticating"===d,y=(0,r.useCallback)(()=>{let e=o();null==e||e.removeItem(c),null==e||e.removeItem(i),g(null)},[]),k=(0,r.useCallback)(()=>{let e=o();return e?{access:e.getItem(c),refresh:e.getItem(i)}:{access:null,refresh:null}},[]),w=(0,r.useCallback)((e,t)=>{let a=o();a&&(e&&a.setItem(c,e),t&&a.setItem(i,t))},[]),T=(0,r.useCallback)(async()=>{let e=await (0,s.R1)("/api/auth/me");return u(e),h("authenticated"),m(null),e},[]),E=(0,r.useCallback)(async()=>{let{refresh:e}=k();if(!e)return!1;try{let a=await (0,s.sg)("/api/auth/refresh",{refreshToken:e});if(null==a?void 0:a.accessToken){var t;return w(a.accessToken,null!==(t=a.refreshToken)&&void 0!==t?t:e),g(a.accessToken),!0}return!1}catch(e){return y(),!1}},[y,k,w]),P=(0,r.useCallback)(async(e,t)=>{m(null),h("authenticating");try{let n=await (0,s.sg)("/api/auth/login",{email:e,password:t});if(null==n?void 0:n.accessToken){var a;w(n.accessToken,null!==(a=n.refreshToken)&&void 0!==a?a:null),g(n.accessToken)}let r=(null==n?void 0:n.user)?n.user:await T();u(r),h("authenticated")}catch(e){throw m((null==e?void 0:e.message)||"Login failed"),h("unauthenticated"),y(),e}},[T,w,y]),x=(0,r.useCallback)(async()=>{try{let{refresh:e}=k();e&&await (0,s.sg)("/api/auth/logout",{refreshToken:e})}catch(e){}finally{y(),u(null),h("unauthenticated")}},[y,k]);(0,r.useEffect)(()=>{let e=!1;return(async()=>{h("authenticating");try{let{access:t,refresh:a}=k(),n=!!t;!n&&a?n=await E():t&&g(t),n?(await T(),e||h("authenticated")):e||(h("unauthenticated"),u(null))}catch(t){if(!e){let e=(null==t?void 0:t.message)||"";(e.includes("Backend API")||e.includes("BACKEND_UNAVAILABLE"))&&m(e),h("unauthenticated"),u(null),y()}}})(),()=>{e=!0}},[E,T,y,k]);let A=(0,r.useMemo)(()=>({user:a,loading:p,status:d,error:f,login:P,logout:x,accessToken:v}),[a,p,d,f,P,x,v]);return(0,n.jsx)(l.Provider,{value:A,children:t})},d=()=>{let e=(0,r.useContext)(l);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},90743:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});let n=(0,a(2389).Z)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},81695:function(e,t,a){"use strict";var n=a(21219);a.o(n,"useParams")&&a.d(t,{useParams:function(){return n.useParams}}),a.o(n,"usePathname")&&a.d(t,{usePathname:function(){return n.usePathname}}),a.o(n,"useRouter")&&a.d(t,{useRouter:function(){return n.useRouter}}),a.o(n,"useSearchParams")&&a.d(t,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[1294,1293,1528,1744],function(){return e(e.s=19198)}),_N_E=e.O()}]);