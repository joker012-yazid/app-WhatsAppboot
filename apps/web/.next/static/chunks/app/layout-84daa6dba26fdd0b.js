(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{90039:function(e,t,n){Promise.resolve().then(n.t.bind(n,72625,23)),Promise.resolve().then(n.bind(n,49799))},49799:function(e,t,n){"use strict";n.d(t,{Providers:function(){return f}});var r=n(27573),a=n(70772),l=n(77930),o=n(54689),s=n(7653),i=n(17787),u=n(41799),c=n(73638),d=n(10957);let f=e=>{let{children:t}=e,[n]=(0,s.useState)(()=>new a.S({defaultOptions:{queries:{staleTime:3e5,retry:1,refetchOnWindowFocus:!1}}}));return(0,r.jsx)(o.f,{attribute:"class",defaultTheme:"dark",enableSystem:!0,disableTransitionOnChange:!1,children:(0,r.jsx)(l.aH,{client:n,children:(0,r.jsx)(u.H,{children:(0,r.jsx)(c.V,{children:(0,r.jsxs)(d.W,{children:[t,(0,r.jsx)(i.x7,{position:"top-right",expand:!0,richColors:!0,closeButton:!0,theme:"system",toastOptions:{style:{background:"hsl(var(--card))",border:"1px solid hsl(var(--border))",color:"hsl(var(--foreground))"},className:"sonner-toast"}})]})})})})})}},10957:function(e,t,n){"use strict";n.d(t,{N:function(){return i},W:function(){return s}});var r=n(27573),a=n(7653),l=n(3458);let o=(0,a.createContext)(void 0);function s(e){let{children:t}=e,[n,s]=(0,a.useState)(null),[i,u]=(0,a.useState)(!1),c=(0,a.useRef)(null),d=(0,a.useRef)(null),f=(0,a.useRef)(null);(0,a.useEffect)(()=>{u(!0)},[]);let h=(0,a.useCallback)(e=>new Promise(t=>{var n,r,a,l,o;s({id:Date.now(),resolve:t,title:null!==(n=e.title)&&void 0!==n?n:"Confirm action",description:null!==(r=e.description)&&void 0!==r?r:"Are you sure you want to proceed? This action cannot be undone.",confirmText:null!==(a=e.confirmText)&&void 0!==a?a:"Confirm",cancelText:null!==(l=e.cancelText)&&void 0!==l?l:"Cancel",variant:null!==(o=e.variant)&&void 0!==o?o:"default"})}),[]),m=(0,a.useMemo)(()=>({confirm:h}),[h]),v=(0,a.useCallback)(e=>{s(t=>(t&&t.resolve(e),null))},[]);(0,a.useEffect)(()=>{if(!n)return;c.current=document.activeElement||null;let e=setTimeout(()=>{var e;null===(e=d.current||f.current)||void 0===e||e.focus()},0),t=e=>{if(n){if("Escape"===e.key){e.preventDefault(),v(!1);return}if("Enter"===e.key){e.preventDefault(),v(!0);return}if("Tab"===e.key){let t=[f.current,d.current].filter(Boolean);if(0===t.length)return;let n=t.indexOf(document.activeElement);if(e.shiftKey){let r=n<=0?t[t.length-1]:t[n-1];e.preventDefault(),r.focus()}else{let r=-1===n||n>=t.length-1?t[0]:t[n+1];e.preventDefault(),r.focus()}}}};return document.addEventListener("keydown",t),()=>{clearTimeout(e),document.removeEventListener("keydown",t);try{var n;null===(n=c.current)||void 0===n||n.focus()}catch(e){}}},[n,v]);let b=i&&n?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"presentation",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>v(!1)}),(0,r.jsxs)("div",{className:"relative z-10 w-full max-w-sm rounded-xl border border-slate-800 bg-slate-950/90 p-5 shadow-2xl shadow-black/40 outline-none backdrop-blur",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-desc",tabIndex:-1,children:[(0,r.jsx)("h3",{id:"confirm-title",className:"mb-1 text-lg font-semibold text-slate-50",children:n.title}),(0,r.jsx)("p",{id:"confirm-desc",className:"mb-4 text-sm text-slate-300",children:n.description}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{ref:f,className:"rounded-md border border-slate-700 px-3 py-1.5 text-sm text-slate-200 transition hover:border-slate-500 hover:bg-slate-900",onClick:()=>v(!1),children:n.cancelText}),(0,r.jsx)("button",{ref:d,className:"rounded-md px-3 py-1.5 text-sm text-white transition ".concat("destructive"===n.variant?"bg-red-600 hover:bg-red-700":"bg-sky-600 hover:bg-sky-500"),onClick:()=>v(!0),children:n.confirmText})]})]})]}):null;return(0,r.jsxs)(o.Provider,{value:m,children:[t,i&&"undefined"!=typeof document&&b?(0,l.createPortal)(b,document.body):null]})}function i(){let e=(0,a.useContext)(o);if(!e)throw Error("useConfirm must be used within ConfirmProvider");return e.confirm}},73638:function(e,t,n){"use strict";n.d(t,{V:function(){return i},p:function(){return u}});var r=n(27573),a=n(7653),l=n(3458);function o(e){let{message:t,variant:n="info",onClose:l,duration:o=2500}=e;return(0,a.useEffect)(()=>{if(!o)return;let e=setTimeout(()=>l&&l(),o);return()=>clearTimeout(e)},[o,l]),(0,r.jsx)("div",{className:"pointer-events-auto fixed bottom-4 right-4 z-50 max-w-sm rounded-lg border bg-slate-950/90 px-4 py-3 shadow-lg shadow-black/40 backdrop-blur ".concat("success"===n?"border-emerald-500/60 text-emerald-50":"error"===n?"border-red-500/60 text-red-50":"warning"===n?"border-amber-500/60 text-amber-50":"border-slate-700 text-slate-50"),role:"status","aria-live":"polite",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"text-sm",children:t}),l?(0,r.jsx)("button",{className:"ml-auto text-xs text-slate-300 opacity-80 transition hover:opacity-100",onClick:l,"aria-label":"Close",children:"x"}):null]})})}let s=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[n,i]=(0,a.useState)([]),[u,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{c(!0)},[]);let d=(0,a.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e))},[]),f=(0,a.useCallback)((e,t)=>{var n,r;let a={id:Math.floor(Date.now()+1e3*Math.random()),message:e,variant:null!==(n=null==t?void 0:t.variant)&&void 0!==n?n:"info",duration:null!==(r=null==t?void 0:t.duration)&&void 0!==r?r:2500};i(e=>[...e,a])},[]),h=(0,a.useMemo)(()=>({show:f,success:(e,t)=>f(e,{variant:"success",duration:t}),error:(e,t)=>f(e,{variant:"error",duration:t}),info:(e,t)=>f(e,{variant:"info",duration:t}),warning:(e,t)=>f(e,{variant:"warning",duration:t})}),[f]);(0,a.useEffect)(()=>(globalThis.__toast=h,()=>{globalThis.__toast===h&&delete globalThis.__toast}),[h]);let m=u&&n.length>0?(0,r.jsx)(r.Fragment,{children:n.map(e=>(0,r.jsx)(o,{message:e.message,variant:e.variant,duration:e.duration,onClose:()=>d(e.id)},e.id))}):null;return(0,r.jsxs)(s.Provider,{value:h,children:[t,u&&"undefined"!=typeof document&&m?(0,l.createPortal)(m,document.body):null]})}function u(){let e=(0,a.useContext)(s);if(!e)throw Error("useToast must be used within ToastProvider");return e}},45118:function(e,t,n){"use strict";n.d(t,{QW:function(){return h},R1:function(){return d},SC:function(){return u},pE:function(){return f},sg:function(){return c},zi:function(){return m}});let r="http://localhost:4000",a=()=>window.sessionStorage,l="accessToken",o="refreshToken",s=e=>e.startsWith("/api/auth/login")||e.startsWith("/api/auth/register")||e.startsWith("/api/auth/refresh"),i=!1;async function u(e){var t,n,c,d,f,h,m,v,b;let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{method:x="GET",body:p,headers:k,_retry:y}=g,w="".concat(r).concat(e),T=a(),E=(null==T?void 0:T.getItem(l))||null,C=(null==T?void 0:T.getItem(o))||null;try{let a=await fetch(w,{method:x,headers:{"Content-Type":"application/json",...k||{},...E&&!s?{Authorization:"Bearer ".concat(E)}:{}},body:p?JSON.stringify(p):void 0,credentials:"include"}),i=await a.text(),f={};if(i)try{f=JSON.parse(i)}catch(e){f={message:i}}if(!a.ok){let i=(null==f?void 0:f.message)||"HTTP ".concat(a.status,": ").concat(a.statusText);if(console.error("[API] Request failed: ".concat(x," ").concat(w," - ").concat(i)),401===a.status&&(console.warn("[API] Unauthorized â€“ will let auth layer handle redirect / logout"),!s(e)&&!y&&C)){try{let t=await fetch("".concat(r,"/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:C}),credentials:"include"});if(t.ok){let n=await t.json(),r=null==n?void 0:n.accessToken,a=null==n?void 0:n.refreshToken;return r&&(null==T||T.setItem(l,r)),a&&(null==T||T.setItem(o,a)),u(e,{...g,_retry:!0})}}catch(e){console.error("[API] Refresh token request failed",e)}null==T||T.removeItem(l),null==T||T.removeItem(o)}if(502===a.status||503===a.status||504===a.status){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};try{null===(n=globalThis.__toast)||void 0===n||null===(t=n.error)||void 0===t||t.call(n,e.message)}catch(e){}let r=Error(e.message);throw r.code=e.code,r}try{null===(d=globalThis.__toast)||void 0===d||null===(c=d.error)||void 0===c||c.call(d,i)}catch(e){}throw Error(i)}return f}catch(t){if((null==t?void 0:null===(f=t.message)||void 0===f?void 0:f.includes("Failed to fetch"))||(null==t?void 0:null===(h=t.message)||void 0===h?void 0:h.includes("NetworkError"))||(null==t?void 0:null===(m=t.message)||void 0===m?void 0:m.includes("ECONNREFUSED"))||(null==t?void 0:t.name)==="TypeError"){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};i||(console.error("[API] Connection error: ".concat(x," ").concat(w),t),i=!0);try{null===(b=globalThis.__toast)||void 0===b||null===(v=b.error)||void 0===v||v.call(b,e.message)}catch(e){}let n=Error(e.message);throw n.code=e.code,n}if(t instanceof Error&&t.message)throw t;let e=(null==t?void 0:t.message)||"Failed to fetch: ".concat(x," ").concat(w);throw console.error("[API] Request error: ".concat(x," ").concat(w),t),Error(e)}}let c=(e,t)=>u(e,{method:"POST",body:t}),d=e=>u(e,{method:"GET"}),f=(e,t)=>u(e,{method:"PUT",body:t}),h=e=>u(e,{method:"DELETE"});async function m(e,t){let n=await fetch("".concat(r).concat(e),{method:"POST",body:t,credentials:"include"}),a=await n.text(),l=a?JSON.parse(a):{};if(!n.ok)throw Error((null==l?void 0:l.message)||"HTTP ".concat(n.status));return l}},41799:function(e,t,n){"use strict";n.d(t,{H:function(){return c},a:function(){return d}});var r=n(27573),a=n(7653),l=n(45118);let o=(0,a.createContext)(void 0),s=()=>window.sessionStorage,i="accessToken",u="refreshToken",c=e=>{let{children:t}=e,[n,c]=(0,a.useState)(null),[d,f]=(0,a.useState)("authenticating"),[h,m]=(0,a.useState)(null),[v,b]=(0,a.useState)(null),g="authenticating"===d,x=(0,a.useCallback)(()=>{let e=s();null==e||e.removeItem(i),null==e||e.removeItem(u),b(null)},[]),p=(0,a.useCallback)(()=>{let e=s();return e?{access:e.getItem(i),refresh:e.getItem(u)}:{access:null,refresh:null}},[]),k=(0,a.useCallback)((e,t)=>{let n=s();n&&(e&&n.setItem(i,e),t&&n.setItem(u,t))},[]),y=(0,a.useCallback)(async()=>{let e=await (0,l.R1)("/api/auth/me");return c(e),f("authenticated"),m(null),e},[]),w=(0,a.useCallback)(async()=>{let{refresh:e}=p();if(!e)return!1;try{let n=await (0,l.sg)("/api/auth/refresh",{refreshToken:e});if(null==n?void 0:n.accessToken){var t;return k(n.accessToken,null!==(t=n.refreshToken)&&void 0!==t?t:e),b(n.accessToken),!0}return!1}catch(e){return x(),!1}},[x,p,k]),T=(0,a.useCallback)(async(e,t)=>{m(null),f("authenticating");try{let r=await (0,l.sg)("/api/auth/login",{email:e,password:t});if(null==r?void 0:r.accessToken){var n;k(r.accessToken,null!==(n=r.refreshToken)&&void 0!==n?n:null),b(r.accessToken)}let a=(null==r?void 0:r.user)?r.user:await y();c(a),f("authenticated")}catch(e){throw m((null==e?void 0:e.message)||"Login failed"),f("unauthenticated"),x(),e}},[y,k,x]),E=(0,a.useCallback)(async()=>{try{let{refresh:e}=p();e&&await (0,l.sg)("/api/auth/logout",{refreshToken:e})}catch(e){}finally{x(),c(null),f("unauthenticated")}},[x,p]);(0,a.useEffect)(()=>{let e=!1;return(async()=>{f("authenticating");try{let{access:t,refresh:n}=p(),r=!!t;!r&&n?r=await w():t&&b(t),r?(await y(),e||f("authenticated")):e||(f("unauthenticated"),c(null))}catch(t){if(!e){let e=(null==t?void 0:t.message)||"";(e.includes("Backend API")||e.includes("BACKEND_UNAVAILABLE"))&&m(e),f("unauthenticated"),c(null),x()}}})(),()=>{e=!0}},[w,y,x,p]);let C=(0,a.useMemo)(()=>({user:n,loading:g,status:d,error:h,login:T,logout:E,accessToken:v}),[n,g,d,h,T,E,v]);return(0,r.jsx)(o.Provider,{value:C,children:t})},d=()=>{let e=(0,a.useContext)(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},72625:function(){}},function(e){e.O(0,[9387,7787,3953,8119,1293,1528,1744],function(){return e(e.s=90039)}),_N_E=e.O()}]);