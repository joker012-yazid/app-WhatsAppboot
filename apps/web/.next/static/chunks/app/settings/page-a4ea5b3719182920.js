(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6938],{35925:function(e,s,a){Promise.resolve().then(a.bind(a,30519))},30519:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return U}});var t=a(27573),l=a(7653),n=a(77930),r=a(31988),d=a(15969),i=a(85481),o=a(62441),c=a(26302),m=a(45015),u=a(30609),x=a(75721),p=a(79901),h=a(84355),b=a(34965),g=a(38983),j=a(92482),y=a(78340),N=a(92612),f=a(60066),v=a(76251),w=a(84115),k=a(81695),S=a(22628),C=a(50466),R=a(45118),A=a(73638),F=a(41799),E=a(327),D=a(29147);function I(e){let{items:s,value:a,onValueChange:l}=e;return(0,t.jsx)("div",{className:"inline-flex rounded-full border border-slate-800 bg-slate-950/70 p-1 shadow-sm backdrop-blur",children:s.map(e=>{let s=a===e.id;return(0,t.jsx)("button",{type:"button",onClick:()=>l(e.id),className:(0,D.cn)("rounded-full px-3 py-1 text-xs transition",s?"bg-sky-500 text-slate-950 shadow-sm":"text-slate-400 hover:text-slate-100"),children:e.label},e.id)})})}var W=a(43735),B=a(45036);let M={companyName:"",businessEmail:"",businessPhone:"",taxRate:6,currency:"MYR",businessHours:{start:"09:00",end:"18:00",timezone:"Asia/Kuala_Lumpur"},terms:""},O={businessNumber:"",sessionName:"primary",dailyLimit:150,randomDelayMin:30,randomDelayMax:60,respectBusinessHours:!0,optOutKeywords:["STOP","UNSUBSCRIBE"]},P={provider:"openai",apiKey:"",baseUrl:"",model:"gpt-4o-mini",temperature:.2,maxTokens:512},Q={manualEnabled:!0,includeUploads:!0,retentionDays:30,schedule:"02:00",notifyEmail:""};function U(){var e;let s=(0,A.p)(),{user:a,status:U,loading:q}=(0,F.a)(),z=(0,k.useRouter)(),L=(0,E.A)(null==a?void 0:a.role,["ADMIN","MANAGER"]),T=(0,n.NL)(),[Z,H]=(0,l.useState)(M),[K,_]=(0,l.useState)(O),[J,G]=(0,l.useState)(P),[Y,V]=(0,l.useState)(Q),[X,$]=(0,l.useState)("STOP, UNSUBSCRIBE"),[ee,es]=(0,l.useState)(null),[ea,et]=(0,l.useState)("general"),[el,en]=(0,l.useState)(!1),{status:er,loading:ed,startSession:ei,reset:eo,debugStatusJson:ec}=function(){let[e,s]=(0,l.useState)(null),[a,t]=(0,l.useState)(!1),[n,r]=(0,l.useState)(null),[d,i]=(0,l.useState)(!1),o=(0,l.useRef)(null),c=(0,l.useCallback)(async()=>{try{let a=await (0,B.ML)(),t=JSON.stringify(a);if(o.current!==t){var e;console.log("[WhatsApp] status changed",{status:a.status,hasQR:a.hasQR,error:null!==(e=a.lastError)&&void 0!==e?e:"none"}),o.current=t}s(a),r(JSON.stringify(a,null,2))}catch(a){console.error("[WhatsApp][session] status error",a);let e={status:"error",qrImage:null,hasQR:!1,lastError:(null==a?void 0:a.message)||"Failed to fetch WhatsApp status"};o.current=JSON.stringify(e),s(e),r(JSON.stringify(e,null,2))}},[]),m=(0,l.useCallback)(async function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if((null==e?void 0:e.status)!=="connecting"&&(null==e?void 0:e.status)!=="connected"&&(null==e?void 0:e.status)!=="qr_ready"){t(!0),i(!0);try{await (0,B.wi)(a),await c()}catch(a){console.error("[WhatsApp][session] init error",a);let e={status:"error",qrImage:null,hasQR:!1,lastError:(null==a?void 0:a.message)||"Failed to start WhatsApp session"};s(e),r(JSON.stringify(e,null,2))}finally{t(!1),i(!1)}}},[c,null==e?void 0:e.status]),u=(0,l.useCallback)(async()=>{t(!0);try{await (0,B.BX)();let e={status:"disconnected",qrImage:null,hasQR:!1,lastError:null};s(e),r(JSON.stringify(e,null,2))}catch(a){console.error("[WhatsApp][session] reset error",a);let e={status:"error",qrImage:null,hasQR:!1,lastError:(null==a?void 0:a.message)||"Failed to reset WhatsApp session"};s(e),r(JSON.stringify(e,null,2))}finally{t(!1)}},[c]);return(0,l.useEffect)(()=>{c()},[c]),(0,l.useEffect)(()=>{if(e&&("connecting"===e.status||"qr_ready"===e.status)){let e=setInterval(()=>{c()},3e3);return()=>clearInterval(e)}},[e,c]),{status:e,loading:a,startSession:m,reset:u,refresh:c,debugStatusJson:n,isConnecting:d}}(),em=(0,r.a)({queryKey:["settings"],queryFn:async()=>(0,R.R1)("/api/settings"),enabled:"authenticated"===U});(0,l.useEffect)(()=>{em.data&&(H(em.data.general),_(em.data.whatsapp),G(em.data.ai),V(em.data.backup),$(em.data.whatsapp.optOutKeywords.join(", ")))},[em.data]);let eu=(0,d.D)({mutationFn:async e=>{let{key:s,value:a}=e;return await (0,R.pE)("/api/settings/".concat(s),a),{key:s,value:a}},onSuccess:e=>{let{key:a,value:t}=e;T.setQueryData(["settings"],e=>e?{...e,[a]:t}:e),s.success("Settings saved")},onError:e=>{s.error((null==e?void 0:e.message)||"Failed to save settings")},onSettled:()=>es(null)}),ex=(0,r.a)({queryKey:["backups"],queryFn:async()=>(0,R.R1)("/api/backups"),enabled:L&&"authenticated"===U,refetchInterval:6e4}),ep=(0,d.D)({mutationFn:async()=>(0,R.sg)("/api/backups"),onSuccess:e=>{s.success("Backup created (".concat((e.size/1048576).toFixed(1)," MB)")),T.invalidateQueries({queryKey:["backups"]})},onError:e=>s.error((null==e?void 0:e.message)||"Failed to create backup")}),eh=(0,d.D)({mutationFn:async e=>(0,R.sg)("/api/backups/".concat(encodeURIComponent(e),"/restore")),onSuccess:e=>{s.success("Backup extracted to "+((null==e?void 0:e.extractedTo)||"restore folder"))},onError:e=>s.error((null==e?void 0:e.message)||"Restore failed")}),eb=e=>{if(!L){s.error("You need admin or manager access to edit settings");return}es(e.key),eu.mutate(e)},eg=(0,l.useMemo)(()=>{let e=X.split(",").map(e=>e.trim()).filter(Boolean);return{...K,optOutKeywords:e.length?e:O.optOutKeywords}},[X,K]),ej=(0,l.useMemo)(()=>{let e=(null==er?void 0:er.status)||"disconnected";return"connected"===e?{label:"Connected",className:"bg-emerald-500/15 text-emerald-200 border-emerald-500/50"}:"qr_ready"===e||"connecting"===e&&(null==er?void 0:er.hasQR)?{label:"Scan QR",className:"bg-amber-500/15 text-amber-200 border-amber-500/50"}:"connecting"===e?{label:"Connecting...",className:"bg-sky-500/15 text-sky-100 border-sky-500/50"}:"error"===e?{label:"Error",className:"bg-rose-500/15 text-rose-200 border-rose-500/60"}:{label:"Disconnected",className:"bg-slate-800/60 text-slate-200 border-slate-600/60"}},[null==er?void 0:er.status]),ey=null!==(e=null==er?void 0:er.status)&&void 0!==e?e:"disconnected",eN=(0,l.useMemo)(()=>"qr_ready"===ey||"connecting"===ey&&(null==er?void 0:er.hasQR)?"Scan the QR to link your device.":"connected"===ey?"Connected. Messages will sync to the control room.":"connecting"===ey?"Connecting to WhatsApp... please wait.":"error"===ey?"Something went wrong. Start a new session or reset.":"Start the session to generate a QR code.",[ey,null==er?void 0:er.hasQR]),ef=(0,l.useMemo)(()=>"connected"===ey?3:"qr_ready"===ey||"connecting"===ey&&(null==er?void 0:er.hasQR)?2:1,[ey]),ev=(0,l.useMemo)(()=>{let e=(null==er?void 0:er.lastError)||"";return e.includes("Backend API server is not running")?"The backend API is offline. Please start the API server on port 4000 and try again.":e||null},[null==er?void 0:er.lastError]),ew=(0,l.useMemo)(()=>[{id:"start",label:"Start Session"},{id:"scan",label:"Scan QR"},{id:"connected",label:"Connected"}],[]);return"authenticating"===U||q?(0,t.jsx)("div",{className:"flex min-h-[50vh] items-center justify-center rounded-xl border border-slate-800 bg-slate-950/60 p-6 text-sm text-slate-200",children:"Checking your session..."}):"unauthenticated"===U?(0,t.jsx)("div",{className:"flex min-h-[50vh] items-center justify-center px-4",children:(0,t.jsxs)("div",{className:"w-full max-w-lg space-y-4 rounded-xl border border-slate-800 bg-slate-950/70 p-6 text-center shadow-lg shadow-black/30",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.25em] text-slate-400",children:"Access required"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-100",children:"Youâ€™re not signed in"}),(0,t.jsx)("p",{className:"text-sm text-slate-400",children:"Sign in to manage your WhatsApp and application settings."}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)(C.z,{onClick:()=>z.push("/login"),className:"mt-2",children:"Go to Login"})})]})}):"error"===U?(0,t.jsx)("div",{className:"flex min-h-[50vh] items-center justify-center px-4",children:(0,t.jsxs)("div",{className:"w-full max-w-lg space-y-3 rounded-xl border border-rose-500/40 bg-rose-500/10 p-6 text-center shadow-lg shadow-rose-900/30",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-rose-100",children:"Session error"}),(0,t.jsx)("p",{className:"text-sm text-rose-50/80",children:"Please login again to continue."}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)(C.z,{variant:"outline",onClick:()=>z.push("/login"),children:"Go to Login"})})]})}):(0,t.jsx)(S.Z,{redirectOnFail:!1,children:(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("section",{className:"rounded-xl border bg-card/80 px-6 py-5 shadow-sm backdrop-blur",children:[(0,t.jsx)(W.SectionHeader,{icon:(0,t.jsx)(i.Z,{className:"h-4 w-4"}),overline:"Settings",title:"Application Settings",description:"Manage business identity, WhatsApp guardrails, AI preferences, and backup routines.",actions:(0,t.jsx)(I,{items:[{id:"general",label:"General"},{id:"whatsapp",label:"WhatsApp"},{id:"ai",label:"AI & Automation"},{id:"backup",label:"Backup"}],value:ea,onValueChange:e=>et(e)})}),L?null:(0,t.jsx)("div",{className:"mt-4 rounded-md border border-amber-400/60 bg-amber-500/10 px-3 py-2 text-xs text-amber-100",children:"You are in read-only mode. Contact an administrator to update settings."})]}),em.isLoading?(0,t.jsx)("div",{className:"rounded-xl border bg-card/80 px-4 py-6 text-sm text-muted-foreground backdrop-blur",children:"Loading settings..."}):em.isError?(0,t.jsx)("div",{className:"rounded-xl border bg-card/80 px-4 py-6 text-sm text-red-500 backdrop-blur",children:"Failed to load settings"}):(0,t.jsxs)("div",{className:"space-y-6",children:["general"===ea?(0,t.jsxs)("section",{className:"rounded-xl border bg-card/80 p-6 shadow-sm backdrop-blur",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"General"}),(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Business profile"})]}),(0,t.jsx)(o.Z,{className:"h-5 w-5 text-primary"})]}),(0,t.jsxs)("form",{className:"mt-6 grid gap-4 md:grid-cols-2",onSubmit:e=>{e.preventDefault(),eb({key:"general",value:Z})},children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"companyName",children:"Company name"}),(0,t.jsx)("input",{id:"companyName",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:Z.companyName,onChange:e=>H(s=>({...s,companyName:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"businessEmail",children:"Billing email"}),(0,t.jsx)("input",{id:"businessEmail",type:"email",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:Z.businessEmail,onChange:e=>H(s=>({...s,businessEmail:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"businessPhone",children:"Hotline / WhatsApp number"}),(0,t.jsx)("input",{id:"businessPhone",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:Z.businessPhone,onChange:e=>H(s=>({...s,businessPhone:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"currency",children:"Currency code"}),(0,t.jsx)("input",{id:"currency",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm uppercase",value:Z.currency,onChange:e=>H(s=>({...s,currency:e.target.value.toUpperCase()})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"taxRate",children:"Tax rate (%)"}),(0,t.jsx)("input",{id:"taxRate",type:"number",min:0,max:100,step:.1,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:Z.taxRate,onChange:e=>H(s=>({...s,taxRate:Number(e.target.value)})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Business hours"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"time",className:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm",value:Z.businessHours.start,onChange:e=>H(s=>({...s,businessHours:{...s.businessHours,start:e.target.value}})),disabled:!L}),(0,t.jsx)("input",{type:"time",className:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm",value:Z.businessHours.end,onChange:e=>H(s=>({...s,businessHours:{...s.businessHours,end:e.target.value}})),disabled:!L})]}),(0,t.jsx)("input",{className:"mt-2 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:Z.businessHours.timezone,onChange:e=>H(s=>({...s,businessHours:{...s.businessHours,timezone:e.target.value}})),disabled:!L})]}),(0,t.jsxs)("div",{className:"md:col-span-2 space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"terms",children:"Terms & conditions (shown on invoices & WhatsApp quotes)"}),(0,t.jsx)("textarea",{id:"terms",rows:4,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:Z.terms,onChange:e=>H(s=>({...s,terms:e.target.value})),disabled:!L})]}),(0,t.jsx)("div",{className:"md:col-span-2 flex justify-end",children:(0,t.jsx)(C.z,{type:"submit",disabled:!L||"general"===ee,children:"general"===ee?"Saving...":"Save general settings"})})]})]}):null,"whatsapp"===ea?(0,t.jsxs)("section",{className:"rounded-xl border bg-card/80 p-6 shadow-sm backdrop-blur",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"WhatsApp"}),(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Anti-ban controls"})]}),(0,t.jsx)(c.Z,{className:"h-5 w-5 text-primary"})]}),(0,t.jsxs)("div",{className:"mt-4 space-y-4 rounded-xl border border-slate-800/80 bg-slate-950/60 p-5 shadow-inner shadow-slate-900/40",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-sky-500/10 text-sky-200",children:(0,t.jsx)(m.Z,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-slate-100",children:"WhatsApp session"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:eN})]})]}),(0,t.jsx)("span",{className:(0,D.cn)("rounded-full border px-3 py-1 text-xs font-semibold",ej.className),children:ej.label})]}),(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:ew.map((e,s)=>{let a=s+1,l=ef===a,n=ef>a&&"error"!==ey,r="error"===ey&&1===a;return(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:(0,D.cn)("flex min-w-[0] items-center gap-2 rounded-full border px-3 py-1.5 text-xs transition",r&&"border-rose-500/60 bg-rose-500/10 text-rose-100",!r&&l&&"connecting"===ey&&"border-sky-500/50 bg-sky-500/10 text-sky-50 animate-pulse",!r&&l&&"connecting"!==ey&&"border-emerald-400/60 bg-emerald-500/10 text-emerald-50 shadow-inner shadow-emerald-900/30",!r&&!l&&n&&"border-emerald-500/40 bg-emerald-500/5 text-emerald-100",!r&&!l&&!n&&"border-slate-800 bg-slate-900/60 text-slate-300"),children:[(0,t.jsx)("span",{className:(0,D.cn)("block h-2 w-2 rounded-full",r?"bg-rose-400":l||n?"bg-emerald-400":"bg-slate-500")}),r?(0,t.jsx)(u.Z,{className:"h-3.5 w-3.5 text-rose-200"}):null,(0,t.jsx)("span",{className:"truncate",children:e.label})]}),s<ew.length-1?(0,t.jsx)("div",{className:(0,D.cn)("h-px w-12 md:w-16",n?"bg-emerald-500/60":"bg-slate-800")}):null]},e.id)})}),(0,t.jsxs)("div",{className:"grid gap-4 lg:grid-cols-2",children:[(0,t.jsx)("div",{className:"space-y-3",children:"qr_ready"===ey?(0,t.jsx)("div",{className:"rounded-xl border bg-slate-900/70 px-4 py-4 text-center shadow-lg shadow-emerald-900/30",children:(null==er?void 0:er.qrImage)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mx-auto max-w-[14rem] overflow-hidden rounded-lg border border-slate-800/80 bg-black/30 p-3",children:(0,t.jsx)("img",{src:er.qrImage,alt:"WhatsApp QR",className:"h-48 w-48 object-contain"})}),(0,t.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-slate-100",children:"Scan this QR with WhatsApp on your phone"}),(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"On your phone, open WhatsApp > Linked Devices > Link a device."})]})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,t.jsx)("div",{className:"h-48 w-48 rounded-lg border border-slate-800/70 bg-slate-900/80 shadow-inner shadow-slate-900/30 animate-pulse"}),(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"Generating QR code..."})]})}):"connecting"===ey?(0,t.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-sky-500/30 bg-sky-500/10 px-4 py-3 shadow-inner shadow-sky-900/30",children:[(0,t.jsx)(x.Z,{className:"mt-0.5 h-5 w-5 animate-spin text-sky-100"}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-sky-100",children:"Connecting to WhatsApp... please wait"}),(0,t.jsx)("p",{className:"text-xs text-slate-200",children:"If this takes too long, start a new session (force) or check connectivity."})]})]}):"connected"===ey?(0,t.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-emerald-500/40 bg-emerald-500/10 px-4 py-3 shadow-inner shadow-emerald-900/30",children:[(0,t.jsx)(p.Z,{className:"mt-0.5 h-5 w-5 text-emerald-200"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-emerald-100",children:"Connected to WhatsApp."}),(0,t.jsx)("p",{className:"text-xs text-emerald-50/80",children:"Messages will sync into the Control Room."})]})]}):"error"===ey?(0,t.jsxs)("div",{className:"space-y-2 rounded-lg border border-rose-500/50 bg-rose-500/10 px-4 py-3 shadow-inner shadow-rose-900/30",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(u.Z,{className:"mt-0.5 h-5 w-5 text-rose-200"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-rose-100",children:"Failed to connect to WhatsApp."}),(0,t.jsx)("p",{className:"text-xs text-rose-50/80",children:"Try starting a new session or reset the connection."})]})]}),ev?(0,t.jsx)("pre",{className:"text-xs bg-slate-900/70 border border-rose-500/50 rounded-md p-2 overflow-x-auto",children:ev}):null]}):(0,t.jsx)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-4 py-3 text-xs text-slate-300 shadow-inner shadow-slate-900/30",children:"Start a session to generate a QR code and link WhatsApp to the control room."})}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 rounded-lg border border-slate-800/70 bg-slate-900/60 p-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-slate-100",children:"Control the session"}),(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"Kick off a connection, force a new login, or reset if something looks off."})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(C.z,{size:"sm",onClick:()=>ei(!1),disabled:ed,children:ed?"Working...":"Start Session"}),(0,t.jsx)(C.z,{size:"sm",variant:"outline",onClick:()=>ei(!0),disabled:ed,children:ed?"Starting...":"Start New Session (force)"})]}),(0,t.jsx)("button",{type:"button",className:"self-start text-xs text-slate-400 underline decoration-dotted underline-offset-4 hover:text-slate-200 disabled:opacity-60",onClick:()=>eo(),disabled:ed,children:"Reset session"}),(0,t.jsx)("div",{className:"rounded-lg border border-dashed border-slate-800/80 bg-slate-950/40 p-3 text-xs text-slate-400",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(h.Z,{className:"mt-0.5 h-4 w-4 text-slate-500"}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{children:"Tips"}),(0,t.jsxs)("ul",{className:"list-disc space-y-1 pl-5",children:[(0,t.jsx)("li",{children:"Keep this tab open while scanning the QR."}),(0,t.jsx)("li",{children:"Use the force option if the QR refuses to update."}),(0,t.jsx)("li",{children:"Stable internet helps the handshake complete faster."})]})]})]})})]})]}),(0,t.jsxs)("div",{className:"border-t border-slate-800/70 pt-3",children:[(0,t.jsxs)("button",{type:"button",className:"flex items-center gap-2 text-xs text-slate-400 hover:text-slate-200",onClick:()=>en(e=>!e),children:[(0,t.jsx)("span",{children:"Developer debug (WhatsApp status)"}),el?(0,t.jsx)(b.Z,{className:"h-4 w-4"}):(0,t.jsx)(g.Z,{className:"h-4 w-4"})]}),el?(0,t.jsx)("pre",{className:"mt-2 max-h-40 overflow-x-auto rounded-md border border-slate-700 bg-slate-950/80 p-2 text-[10px] text-slate-200",children:ec||"No status received yet."}):null]})]}),(0,t.jsxs)("form",{className:"mt-6 grid gap-4 md:grid-cols-2",onSubmit:e=>{e.preventDefault(),eb({key:"whatsapp",value:eg})},children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"businessNumber",children:"Business number"}),(0,t.jsx)("input",{id:"businessNumber",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:K.businessNumber,onChange:e=>_(s=>({...s,businessNumber:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"sessionName",children:"Session name"}),(0,t.jsx)("input",{id:"sessionName",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:K.sessionName,onChange:e=>_(s=>({...s,sessionName:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"dailyLimit",children:"Daily limit"}),(0,t.jsx)("input",{id:"dailyLimit",type:"number",min:10,max:5e3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:K.dailyLimit,onChange:e=>_(s=>({...s,dailyLimit:Number(e.target.value)})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Random delay (seconds)"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"number",min:0,className:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm",value:K.randomDelayMin,onChange:e=>_(s=>({...s,randomDelayMin:Number(e.target.value)})),disabled:!L}),(0,t.jsx)("input",{type:"number",min:0,className:"flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm",value:K.randomDelayMax,onChange:e=>_(s=>({...s,randomDelayMax:Number(e.target.value)})),disabled:!L})]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"optOut",children:"Opt-out keywords (comma separated)"}),(0,t.jsx)("input",{id:"optOut",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:X,onChange:e=>$(e.target.value),disabled:!L})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 pt-6",children:[(0,t.jsx)("input",{id:"respectBusinessHours",type:"checkbox",className:"h-4 w-4",checked:K.respectBusinessHours,onChange:e=>_(s=>({...s,respectBusinessHours:e.target.checked})),disabled:!L}),(0,t.jsx)("label",{htmlFor:"respectBusinessHours",className:"text-sm text-muted-foreground",children:"Respect business hours window"})]}),(0,t.jsx)("div",{className:"md:col-span-2 flex justify-end",children:(0,t.jsx)(C.z,{type:"submit",disabled:!L||"whatsapp"===ee,children:"whatsapp"===ee?"Saving...":"Save WhatsApp settings"})})]})]}):null,"ai"===ea?(0,t.jsxs)("section",{className:"rounded-xl border bg-card/80 p-6 shadow-sm backdrop-blur",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.Z,{className:"h-5 w-5 text-primary"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"AI"}),(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Assistant preferences"})]})]}),(0,t.jsx)(y.Z,{className:"h-5 w-5 text-primary"})]}),(0,t.jsxs)("form",{className:"mt-6 grid gap-4 md:grid-cols-2",onSubmit:e=>{e.preventDefault(),eb({key:"ai",value:J})},children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"provider",children:"Provider"}),(0,t.jsx)("input",{id:"provider",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:J.provider,onChange:e=>G(s=>({...s,provider:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"model",children:"Model"}),(0,t.jsx)("input",{id:"model",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:J.model,onChange:e=>G(s=>({...s,model:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"apiKey",children:"API key"}),(0,t.jsx)("input",{id:"apiKey",type:"password",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:J.apiKey,onChange:e=>G(s=>({...s,apiKey:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"baseUrl",children:"Base URL (optional)"}),(0,t.jsx)("input",{id:"baseUrl",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:J.baseUrl,onChange:e=>G(s=>({...s,baseUrl:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"temperature",children:"Temperature"}),(0,t.jsx)("input",{id:"temperature",type:"number",min:0,max:1,step:.05,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:J.temperature,onChange:e=>G(s=>({...s,temperature:Number(e.target.value)})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"maxTokens",children:"Max tokens"}),(0,t.jsx)("input",{id:"maxTokens",type:"number",min:64,max:4e3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:J.maxTokens,onChange:e=>G(s=>({...s,maxTokens:Number(e.target.value)})),disabled:!L})]}),(0,t.jsxs)("div",{className:"md:col-span-2 flex justify-between gap-2",children:[(0,t.jsx)(C.z,{type:"submit",disabled:!L||"ai"===ee,children:"ai"===ee?"Saving...":"Save AI settings"}),(0,t.jsx)(C.z,{type:"button",variant:"outline",onClick:()=>s.success("Test command queued - implement transport hook next."),disabled:!L,children:"Run test prompt"})]})]})]}):null,"backup"===ea?(0,t.jsxs)("section",{className:"rounded-xl border bg-card/80 p-6 shadow-sm backdrop-blur",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Backup & safety"}),(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Disaster recovery"})]}),(0,t.jsx)(N.Z,{className:"h-5 w-5 text-primary"})]}),(0,t.jsxs)("form",{className:"mt-6 grid gap-4 md:grid-cols-2",onSubmit:e=>{e.preventDefault(),eb({key:"backup",value:Y})},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{id:"manualEnabled",type:"checkbox",className:"h-4 w-4",checked:Y.manualEnabled,onChange:e=>V(s=>({...s,manualEnabled:e.target.checked})),disabled:!L}),(0,t.jsx)("label",{htmlFor:"manualEnabled",className:"text-sm text-muted-foreground",children:"Enable manual backup button in dashboard"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{id:"includeUploads",type:"checkbox",className:"h-4 w-4",checked:Y.includeUploads,onChange:e=>V(s=>({...s,includeUploads:e.target.checked})),disabled:!L}),(0,t.jsx)("label",{htmlFor:"includeUploads",className:"text-sm text-muted-foreground",children:"Include uploads & WhatsApp sessions"})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"retentionDays",children:"Retention (days)"}),(0,t.jsx)("input",{id:"retentionDays",type:"number",min:1,max:365,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:Y.retentionDays,onChange:e=>V(s=>({...s,retentionDays:Number(e.target.value)})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"schedule",children:"Daily schedule (24h)"}),(0,t.jsx)("input",{id:"schedule",type:"time",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:Y.schedule,onChange:e=>V(s=>({...s,schedule:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"space-y-1 md:col-span-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",htmlFor:"notifyEmail",children:"Notify email"}),(0,t.jsx)("input",{id:"notifyEmail",type:"email",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:Y.notifyEmail,onChange:e=>V(s=>({...s,notifyEmail:e.target.value})),disabled:!L})]}),(0,t.jsxs)("div",{className:"md:col-span-2 flex justify-between gap-2",children:[(0,t.jsx)(C.z,{type:"submit",disabled:!L||"backup"===ee,children:"backup"===ee?"Saving...":"Save backup plan"}),(0,t.jsx)(C.z,{type:"button",variant:"outline",disabled:!L||ep.isPending,onClick:()=>ep.mutate(),children:ep.isPending?"Creating backup...":(0,t.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,t.jsx)(f.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Trigger manual backup"})]})})]}),(0,t.jsxs)("div",{className:"md:col-span-2 rounded-lg border border-dashed px-4 py-3 text-xs text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Checklist before production"})]}),(0,t.jsxs)("ul",{className:"mt-2 list-disc space-y-1 pl-5",children:[(0,t.jsx)("li",{children:"Verify S3 / local backup destination has enough storage."}),(0,t.jsx)("li",{children:"Store encryption password safely (preferably in a vault)."}),(0,t.jsx)("li",{children:"Test restore on a staging database monthly."})]})]})]}),(0,t.jsxs)("div",{className:"mt-6 rounded-xl border border-dashed bg-card/30 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-sm font-semibold",children:"Recent backups"}),(0,t.jsx)(C.z,{variant:"ghost",size:"sm",onClick:()=>ex.refetch(),disabled:ex.isFetching,children:ex.isFetching?"Refreshing...":"Refresh"})]}),ex.isLoading?(0,t.jsx)("p",{className:"mt-4 text-sm text-muted-foreground",children:"Loading backup history..."}):ex.data&&ex.data.length>0?(0,t.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,t.jsx)("thead",{className:"text-xs uppercase text-muted-foreground",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"py-2",children:"File"}),(0,t.jsx)("th",{className:"py-2",children:"Size"}),(0,t.jsx)("th",{className:"py-2",children:"Created"}),(0,t.jsx)("th",{className:"py-2 text-right",children:"Actions"})]})}),(0,t.jsx)("tbody",{children:ex.data.map(e=>(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"py-2 font-mono text-xs",children:e.filename}),(0,t.jsxs)("td",{className:"py-2",children:[(e.size/1048576).toFixed(1)," MB"]}),(0,t.jsx)("td",{className:"py-2",children:new Date(e.createdAt).toLocaleString()}),(0,t.jsx)("td",{className:"py-2 text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)("a",{href:"/api/backups/".concat(encodeURIComponent(e.filename),"/download"),className:"text-xs text-primary underline",children:"Download"}),(0,t.jsx)("button",{className:"text-xs text-muted-foreground underline disabled:opacity-50",disabled:eh.isPending,onClick:()=>eh.mutate(e.filename),children:eh.isPending?"Restoring...":"Extract"})]})})]},e.filename))})]})}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 py-6 text-center text-muted-foreground",children:[(0,t.jsx)("div",{className:"mb-2 flex h-12 w-12 items-center justify-center rounded-full border border-dashed border-slate-800 bg-slate-950/60",children:(0,t.jsx)(w.Z,{className:"h-6 w-6 text-slate-500"})}),(0,t.jsx)("p",{className:"text-sm font-medium text-slate-100",children:"No backups generated yet."}),(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"Run a manual backup to start your recovery history."})]})]})]}):null]})]})})}},327:function(e,s,a){"use strict";a.d(s,{A:function(){return t}});let t=(e,s)=>!!e&&s.includes(e)},45036:function(e,s,a){"use strict";a.d(s,{BX:function(){return r},ML:function(){return n},fk:function(){return d},iL:function(){return o},vh:function(){return i},wi:function(){return l}});var t=a(45118);async function l(e){return(0,t.SC)("/api/whatsapp/session/init",{method:"POST",body:{forceNewSession:e}})}async function n(){return(0,t.SC)("/api/whatsapp/session/status")}async function r(){return(0,t.SC)("/api/whatsapp/session/reset",{method:"POST"})}async function d(){return(0,t.SC)("/api/whatsapp/chats")}async function i(e){return(0,t.SC)("/api/whatsapp/chats/".concat(encodeURIComponent(e),"/messages"))}async function o(e,s){await (0,t.SC)("/api/whatsapp/chats/"+encodeURIComponent(e)+"/messages",{method:"POST",body:{text:s}})}}},function(e){e.O(0,[3953,4701,2741,3171,1293,1528,1744],function(){return e(e.s=35925)}),_N_E=e.O()}]);