(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[109],{2310:function(e,t,s){Promise.resolve().then(s.bind(s,2945))},2945:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var l=s(7573),r=s(7930),n=s(1988),i=s(5969),a=s(8146),o=s(7653),d=s(2628),c=s(5118),u=s(466),m=s(3638),x=s(957),f=s(1799),b=s(327),h=s(7785),v=s(7051),p=s(4115),g=s(3735);let j=[{id:"ALL",label:"All"},{id:"PENDING",label:"Pending"},{id:"QUOTED",label:"Quoted"},{id:"APPROVED",label:"Approved"},{id:"IN_PROGRESS",label:"In Progress"},{id:"COMPLETED",label:"Completed"}];function N(){var e,t;let s=(0,r.NL)(),{user:N}=(0,f.a)(),[y,w]=(0,o.useState)({status:"",customer:""}),[k,C]=(0,o.useState)(""),[A,E]=(0,o.useState)(""),[S,D]=(0,o.useState)(""),[T,R]=(0,o.useState)(""),[L,I]=(0,o.useState)("NORMAL"),[P,F]=(0,o.useState)(""),[M,q]=(0,o.useState)(""),[z,O]=(0,o.useState)(null),Z=(0,m.p)(),G=(0,x.N)(),H=(0,n.a)({queryKey:["customers","forJobForm"],queryFn:async()=>(0,c.R1)("/api/customers")}),U=(0,n.a)({queryKey:["devices",k||"all-for-job"],enabled:!!k,queryFn:async()=>(0,c.R1)("/api/devices?customerId=".concat(encodeURIComponent(k)))}),W=(0,n.a)({queryKey:["jobs",y],queryFn:async()=>{let e=new URLSearchParams;y.status&&e.set("status",y.status),y.customer&&e.set("customer",y.customer);let t=e.toString();return(0,c.R1)("/api/jobs".concat(t?"?".concat(t):""))}});(0,o.useEffect)(()=>{E("")},[k]);let _=(0,i.D)({mutationFn:async()=>(0,c.sg)("/api/jobs",{customerId:k,deviceId:A,title:S,description:T||void 0,priority:L,quotedAmount:P?Number(P):void 0,dueDate:M?new Date(M).toISOString():void 0}),onSuccess:()=>{D(""),R(""),F(""),q(""),s.invalidateQueries({queryKey:["jobs"]}),Z.success("Job created")},onError:e=>{let t=(null==e?void 0:e.message)||"Failed to create job";O(t),Z.error(t)}}),K=H.data||[],Q=U.data||[],J=(0,i.D)({mutationFn:async e=>(0,c.QW)("/api/jobs/".concat(e)),onSuccess:async()=>{await s.invalidateQueries({queryKey:["jobs"]}),Z.success("Job deleted")},onError:e=>Z.error((null==e?void 0:e.message)||"Failed to delete job")}),B=y.status||"ALL";return(0,l.jsx)(d.Z,{children:(0,l.jsxs)("section",{className:"space-y-6",children:[(0,l.jsx)("div",{className:"rounded-xl border bg-card/80 px-6 py-5 shadow-sm backdrop-blur",children:(0,l.jsx)(g.SectionHeader,{icon:(0,l.jsx)(v.Z,{className:"h-4 w-4"}),overline:"Jobs",title:"Jobs & Tickets",description:"Track repair jobs and create new ones.",actions:(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,l.jsx)(h.s,{items:j,value:B,onValueChange:e=>w(t=>({...t,status:"ALL"===e?"":e}))}),(0,l.jsx)("input",{placeholder:"Filter by customer name",value:y.customer,onChange:e=>w(t=>({...t,customer:e.target.value})),className:"w-56 rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]})})}),(0,b.A)(null==N?void 0:N.role,["ADMIN","MANAGER","TECHNICIAN"])?null:(0,l.jsx)("div",{className:"rounded-md border border-amber-400/60 bg-amber-500/10 px-3 py-2 text-sm text-amber-100",children:"You have read-only access to jobs. Contact an administrator for edit permissions."}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,l.jsx)("div",{className:"md:col-span-2 rounded-xl border bg-card/80 shadow-sm backdrop-blur",children:W.isLoading?(0,l.jsx)("div",{className:"p-6 text-sm text-muted-foreground",children:"Loading..."}):W.isError?(0,l.jsx)("div",{className:"p-6 text-sm text-red-500",children:"Error loading jobs"}):(null!==(t=null===(e=W.data)||void 0===e?void 0:e.length)&&void 0!==t?t:0)===0?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 py-10 text-center text-muted-foreground",children:[(0,l.jsx)("div",{className:"mb-2 flex h-16 w-16 items-center justify-center rounded-full border border-dashed border-slate-800 bg-slate-950/60",children:(0,l.jsx)(p.Z,{className:"h-7 w-7 text-slate-500"})}),(0,l.jsx)("p",{className:"text-sm font-medium text-slate-100",children:"No jobs yet"}),(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"When you create a job, it will appear here for tracking."}),(0,b.A)(null==N?void 0:N.role,["ADMIN","MANAGER","TECHNICIAN"])?(0,l.jsx)(u.z,{size:"sm",className:"mt-2",asChild:!0,children:(0,l.jsx)(a.default,{href:"/jobs",children:"Create your first job"})}):null]}):(0,l.jsx)("div",{className:"overflow-hidden rounded-xl",children:(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{className:"bg-slate-950/60 text-xs uppercase tracking-wide text-slate-400",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-4 py-3 text-left",children:"Photo"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left",children:"Title"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left",children:"Customer"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left",children:"Device"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left",children:"Status"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left",children:"Priority"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left",children:"Created"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),(0,l.jsx)("tbody",{children:(W.data||[]).map((e,t)=>{var s,r,n,i,o;return(0,l.jsxs)("tr",{className:"border-b border-slate-800/70 text-sm transition hover:bg-slate-900/70 ".concat(t%2==0?"bg-slate-950/40":""),children:[(0,l.jsx)("td",{className:"px-4 py-2",children:e.thumbnailUrl?(0,l.jsxs)("div",{className:"relative inline-block",children:[(0,l.jsx)("img",{src:e.thumbnailUrl,alt:"thumb",className:"h-12 w-12 rounded object-cover"}),(0,l.jsx)("span",{className:"absolute -right-1 -top-1 rounded-full bg-black/80 px-1.5 py-0.5 text-[10px] text-white",children:null!==(o=e.photoCount)&&void 0!==o?o:1})]}):(0,l.jsx)("span",{className:"text-xs text-muted-foreground",children:"-"})}),(0,l.jsx)("td",{className:"px-4 py-2",children:(0,l.jsx)(a.default,{href:"/jobs/".concat(e.id),className:"underline hover:no-underline",children:e.title})}),(0,l.jsx)("td",{className:"px-4 py-2",children:null===(s=e.customer)||void 0===s?void 0:s.name}),(0,l.jsx)("td",{className:"px-4 py-2",children:[null===(r=e.device)||void 0===r?void 0:r.deviceType,null===(n=e.device)||void 0===n?void 0:n.brand,null===(i=e.device)||void 0===i?void 0:i.model].filter(Boolean).join(" ")}),(0,l.jsx)("td",{className:"px-4 py-2",children:e.status}),(0,l.jsx)("td",{className:"px-4 py-2",children:e.priority}),(0,l.jsx)("td",{className:"px-4 py-2",children:new Date(e.createdAt).toLocaleString()}),(0,l.jsx)("td",{className:"px-4 py-2",children:(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsx)(u.z,{asChild:!0,size:"sm",variant:"outline",children:(0,l.jsx)(a.default,{href:"/jobs/".concat(e.id),children:"View"})}),(0,b.A)(null==N?void 0:N.role,["ADMIN","MANAGER"])?(0,l.jsx)(u.z,{size:"sm",variant:"destructive",onClick:async()=>{await G({title:"Delete job",description:"Are you sure you want to delete this job? This action cannot be undone.",variant:"destructive",confirmText:"Delete"})&&J.mutate(e.id)},disabled:J.isPending,children:"Delete"}):null]})})]},e.id)})})]})})}),(0,b.A)(null==N?void 0:N.role,["ADMIN","MANAGER","TECHNICIAN"])?(0,l.jsxs)("div",{className:"rounded-xl border bg-card/80 p-5 shadow-sm backdrop-blur",children:[(0,l.jsx)("h2",{className:"mb-3 text-lg font-semibold text-slate-50",children:"New job"}),(0,l.jsxs)("form",{className:"space-y-3",onSubmit:e=>{e.preventDefault(),O(null),_.mutate()},children:[(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"text-sm font-medium",htmlFor:"customer",children:"Customer"}),(0,l.jsxs)("select",{id:"customer",value:k,onChange:e=>C(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm text-foreground shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",required:!0,children:[(0,l.jsx)("option",{value:"",disabled:!0,className:"bg-background text-foreground",children:"Select customer"}),K.map(e=>(0,l.jsx)("option",{value:e.id,className:"bg-background text-foreground",children:e.name},e.id))]})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"text-sm font-medium",htmlFor:"device",children:"Device"}),(0,l.jsxs)("select",{id:"device",value:A,onChange:e=>E(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm text-foreground shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",required:!0,disabled:!k||U.isLoading,children:[(0,l.jsx)("option",{value:"",disabled:!0,className:"bg-background text-foreground",children:k?"Select device":"Select customer first"}),Q.map(e=>(0,l.jsx)("option",{value:e.id,className:"bg-background text-foreground",children:[e.deviceType,e.brand,e.model].filter(Boolean).join(" ")},e.id))]})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"text-sm font-medium",htmlFor:"title",children:"Title"}),(0,l.jsx)("input",{id:"title",value:S,onChange:e=>D(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",required:!0})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"text-sm font-medium",htmlFor:"description",children:"Description (optional)"}),(0,l.jsx)("textarea",{id:"description",value:T,onChange:e=>R(e.target.value),className:"h-20 w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"text-sm font-medium",htmlFor:"priority",children:"Priority"}),(0,l.jsx)("select",{id:"priority",value:L,onChange:e=>I(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm text-foreground shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950",children:["LOW","NORMAL","HIGH","URGENT"].map(e=>(0,l.jsx)("option",{value:e,className:"bg-background text-foreground",children:e},e))})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"text-sm font-medium",htmlFor:"quoted",children:"Quoted (RM)"}),(0,l.jsx)("input",{id:"quoted",type:"number",step:"0.01",value:P,onChange:e=>F(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"text-sm font-medium",htmlFor:"due",children:"Due date (optional)"}),(0,l.jsx)("input",{id:"due",type:"datetime-local",value:M,onChange:e=>q(e.target.value),className:"w-full rounded-md border border-input bg-background/80 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/80 focus-visible:ring-offset-1 focus-visible:ring-offset-slate-950"})]}),z?(0,l.jsx)("p",{className:"text-sm text-red-500",children:z}):null,(0,l.jsx)(u.z,{className:"w-full",type:"submit",disabled:_.isPending||!k||!A,children:_.isPending?"Creating...":"Create job"})]})]}):null]})]})})}},2628:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var l=s(7573),r=s(1695),n=s(7653),i=s(1799);function a(e){let{children:t,redirectOnFail:s=!0}=e,{user:a,loading:o,error:d,status:c}=(0,i.a)(),u=(0,r.useRouter)();return((0,n.useEffect)(()=>{if(s&&!o&&(!a||d||"unauthenticated"===c)){let e=d?"?reason=".concat(encodeURIComponent(d)):"";u.replace("/login".concat(e))}},[a,o,d,u,s,c]),o)?(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading session..."}):!a&&s?null:(0,l.jsx)(l.Fragment,{children:t})}},957:function(e,t,s){"use strict";s.d(t,{N:function(){return o},W:function(){return a}});var l=s(7573),r=s(7653),n=s(3458);let i=(0,r.createContext)(void 0);function a(e){let{children:t}=e,[s,a]=(0,r.useState)(null),[o,d]=(0,r.useState)(!1),c=(0,r.useRef)(null),u=(0,r.useRef)(null),m=(0,r.useRef)(null);(0,r.useEffect)(()=>{d(!0)},[]);let x=(0,r.useCallback)(e=>new Promise(t=>{var s,l,r,n,i;a({id:Date.now(),resolve:t,title:null!==(s=e.title)&&void 0!==s?s:"Confirm action",description:null!==(l=e.description)&&void 0!==l?l:"Are you sure you want to proceed? This action cannot be undone.",confirmText:null!==(r=e.confirmText)&&void 0!==r?r:"Confirm",cancelText:null!==(n=e.cancelText)&&void 0!==n?n:"Cancel",variant:null!==(i=e.variant)&&void 0!==i?i:"default"})}),[]),f=(0,r.useMemo)(()=>({confirm:x}),[x]),b=(0,r.useCallback)(e=>{a(t=>(t&&t.resolve(e),null))},[]);(0,r.useEffect)(()=>{if(!s)return;c.current=document.activeElement||null;let e=setTimeout(()=>{var e;null===(e=u.current||m.current)||void 0===e||e.focus()},0),t=e=>{if(s){if("Escape"===e.key){e.preventDefault(),b(!1);return}if("Enter"===e.key){e.preventDefault(),b(!0);return}if("Tab"===e.key){let t=[m.current,u.current].filter(Boolean);if(0===t.length)return;let s=t.indexOf(document.activeElement);if(e.shiftKey){let l=s<=0?t[t.length-1]:t[s-1];e.preventDefault(),l.focus()}else{let l=-1===s||s>=t.length-1?t[0]:t[s+1];e.preventDefault(),l.focus()}}}};return document.addEventListener("keydown",t),()=>{clearTimeout(e),document.removeEventListener("keydown",t);try{var s;null===(s=c.current)||void 0===s||s.focus()}catch(e){}}},[s,b]);let h=o&&s?(0,l.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",role:"presentation",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>b(!1)}),(0,l.jsxs)("div",{className:"relative z-10 w-full max-w-sm rounded-xl border border-slate-800 bg-slate-950/90 p-5 shadow-2xl shadow-black/40 outline-none backdrop-blur",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-title","aria-describedby":"confirm-desc",tabIndex:-1,children:[(0,l.jsx)("h3",{id:"confirm-title",className:"mb-1 text-lg font-semibold text-slate-50",children:s.title}),(0,l.jsx)("p",{id:"confirm-desc",className:"mb-4 text-sm text-slate-300",children:s.description}),(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,l.jsx)("button",{ref:m,className:"rounded-md border border-slate-700 px-3 py-1.5 text-sm text-slate-200 transition hover:border-slate-500 hover:bg-slate-900",onClick:()=>b(!1),children:s.cancelText}),(0,l.jsx)("button",{ref:u,className:"rounded-md px-3 py-1.5 text-sm text-white transition ".concat("destructive"===s.variant?"bg-red-600 hover:bg-red-700":"bg-sky-600 hover:bg-sky-500"),onClick:()=>b(!0),children:s.confirmText})]})]})]}):null;return(0,l.jsxs)(i.Provider,{value:f,children:[t,o&&"undefined"!=typeof document&&h?(0,n.createPortal)(h,document.body):null]})}function o(){let e=(0,r.useContext)(i);if(!e)throw Error("useConfirm must be used within ConfirmProvider");return e.confirm}},3735:function(e,t,s){"use strict";s.d(t,{SectionHeader:function(){return n}});var l=s(7573),r=s(9147);function n(e){let{icon:t,overline:s,title:n,description:i,actions:a,className:o}=e;return(0,l.jsxs)("div",{className:(0,r.cn)("flex flex-wrap items-center justify-between gap-4",o),children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[t?(0,l.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-full border border-sky-500/30 bg-sky-500/10 text-sky-400 shadow-sm",children:t}):null,(0,l.jsxs)("div",{children:[s?(0,l.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:s}):null,(0,l.jsx)("h1",{className:"text-xl font-semibold text-slate-50 md:text-2xl",children:n}),i?(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:i}):null]})]}),a?(0,l.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:a}):null]})}},7785:function(e,t,s){"use strict";s.d(t,{s:function(){return n}});var l=s(7573),r=s(9147);function n(e){let{items:t,value:s,onValueChange:n}=e;return(0,l.jsx)("div",{className:"inline-flex rounded-full border border-slate-800 bg-slate-950/70 p-1 shadow-sm backdrop-blur",children:t.map(e=>{let t=s===e.id;return(0,l.jsx)("button",{type:"button",onClick:()=>n(e.id),className:(0,r.cn)("rounded-full px-3 py-1 text-xs transition",t?"bg-sky-500 text-slate-950 shadow-sm":"text-slate-400 hover:text-slate-100"),children:e.label},e.id)})})}},327:function(e,t,s){"use strict";s.d(t,{A:function(){return l}});let l=(e,t)=>!!e&&t.includes(e)},2389:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var l=s(7653);let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&s.indexOf(e)===t).join(" ")};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=(0,l.forwardRef)((e,t)=>{let{color:s="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:d="",children:c,iconNode:u,...m}=e;return(0,l.createElement)("svg",{ref:t,...i,width:r,height:r,stroke:s,strokeWidth:o?24*Number(a)/Number(r):a,className:n("lucide",d),...m},[...u.map(e=>{let[t,s]=e;return(0,l.createElement)(t,s)}),...Array.isArray(c)?c:[c]])}),o=(e,t)=>{let s=(0,l.forwardRef)((s,i)=>{let{className:o,...d}=s;return(0,l.createElement)(a,{ref:i,iconNode:t,className:n("lucide-".concat(r(e)),o),...d})});return s.displayName="".concat(e),s}},4115:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(2389).Z)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]])},7051:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(2389).Z)("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]])},8146:function(e,t,s){"use strict";s.d(t,{default:function(){return r.a}});var l=s(6340),r=s.n(l)}},function(e){e.O(0,[340,362,485,422,293,914,744],function(){return e(e.s=2310)}),_N_E=e.O()}]);