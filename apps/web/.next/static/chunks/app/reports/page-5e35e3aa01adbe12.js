(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[882],{5557:function(e,s,t){Promise.resolve().then(t.bind(t,8635))},8635:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return Z}});var r=t(7573),a=t(7653),d=t(3025),l=t(2796),n=t(5721),c=t(2439),i=t(3989),m=t(4115),o=t(2596),x=t(8854),u=t(9790),p=t(1569),h=t(2689),j=t(54),f=t(2628),g=t(466),N=t(5118),b=t(3638),v=t(3735);let y=new Intl.NumberFormat("en-MY",{style:"currency",currency:"MYR",maximumFractionDigits:0}),w=new Intl.DateTimeFormat("en-MY",{month:"short",day:"numeric"}),C=e=>y.format(e||0),k=e=>e.toISOString().slice(0,10),R=()=>{let e=new Date,s=new Date(e);return s.setDate(s.getDate()-6),{from:k(s),to:k(e)}};function Z(){var e;let s=(0,b.p)(),t=(0,a.useMemo)(()=>R(),[]),[y,Z]=(0,a.useState)(t.from),[D,S]=(0,a.useState)(t.to),[M,U]=(0,a.useState)(t),[F,I]=(0,a.useState)(!0),[_,A]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=!1;return I(!0),(async()=>{try{let s="?from=".concat(encodeURIComponent(M.from),"&to=").concat(encodeURIComponent(M.to)),t=await (0,N.R1)("/api/reports/summary".concat(s));e||(A(t),I(!1))}catch(t){e||(I(!1),s.error((null==t?void 0:t.message)||"Unable to load report summary"))}})(),()=>{e=!0}},[M.from,M.to,s]);let E=()=>{if(!y||!D){s.error("Please select both start and end dates");return}U({from:y,to:D})},O=(0,a.useMemo)(()=>{var e,s,t;return Math.max(...null!==(t=null==_?void 0:null===(s=_.sales)||void 0===s?void 0:null===(e=s.perDay)||void 0===e?void 0:e.map(e=>e.revenue))&&void 0!==t?t:[1],1)},[_]),T=(0,a.useMemo)(()=>{var e,s,t;return Math.max(...null!==(t=null==_?void 0:null===(s=_.customers)||void 0===s?void 0:null===(e=s.trend)||void 0===e?void 0:e.map(e=>e.newCustomers))&&void 0!==t?t:[1],1)},[_]);return(0,r.jsx)(f.Z,{children:(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("section",{className:"space-y-4 rounded-xl border bg-card/80 px-6 py-5 shadow-sm backdrop-blur",children:[(0,r.jsx)(v.SectionHeader,{icon:(0,r.jsx)(d.Z,{className:"h-4 w-4"}),overline:"Reports",title:"Reports & Analytics",description:"View revenue, operations, customer, and campaign performance across the selected range.",actions:(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2 rounded-xl border bg-card px-4 py-3 text-sm",children:[(0,r.jsx)(l.Z,{className:"h-4 w-4 text-primary"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-medium",children:[M.from," -> ",M.to]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[null!==(e=null==_?void 0:_.range.days)&&void 0!==e?e:0," day window"]})]})]})}),(0,r.jsxs)("form",{className:"flex flex-wrap items-end gap-3 rounded-xl border bg-card px-4 py-3",onSubmit:e=>{e.preventDefault(),E()},children:[(0,r.jsxs)("div",{className:"flex flex-col text-sm",children:[(0,r.jsx)("label",{className:"mb-1 font-medium",htmlFor:"from-date",children:"From"}),(0,r.jsx)("input",{id:"from-date",type:"date",value:y,max:D,onChange:e=>Z(e.target.value),className:"rounded-md border border-input bg-background px-3 py-2 text-sm",required:!0})]}),(0,r.jsxs)("div",{className:"flex flex-col text-sm",children:[(0,r.jsx)("label",{className:"mb-1 font-medium",htmlFor:"to-date",children:"To"}),(0,r.jsx)("input",{id:"to-date",type:"date",value:D,min:y,max:k(new Date),onChange:e=>S(e.target.value),className:"rounded-md border border-input bg-background px-3 py-2 text-sm",required:!0})]}),(0,r.jsxs)(g.z,{type:"submit",disabled:F,children:[F?(0,r.jsx)(n.Z,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Update"]}),(0,r.jsx)(g.z,{type:"button",variant:"ghost",onClick:()=>{Z(t.from),S(t.to),U(t)},disabled:F,children:"Reset"})]})]}),F?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 rounded-xl border bg-card px-4 py-6 text-sm text-muted-foreground",children:[(0,r.jsx)(n.Z,{className:"h-4 w-4 animate-spin"})," Loading summary..."]}):_?(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("section",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,r.jsx)(c.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Sales report"})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Revenue"}),(0,r.jsx)("p",{className:"mt-2 text-3xl font-semibold",children:C(_.sales.totalRevenue)}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[_.sales.transactions," closed jobs"]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Average sale"}),(0,r.jsx)("p",{className:"mt-2 text-3xl font-semibold",children:C(_.sales.averageSale)}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Across all completed jobs"})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Daily jobs"}),(0,r.jsx)("p",{className:"mt-2 text-3xl font-semibold",children:_.sales.perDay.reduce((e,s)=>e+s.jobs,0)}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Within selected range"})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"Revenue trend"}),(0,r.jsxs)("span",{className:"text-muted-foreground",children:["Last ",_.range.days," days"]})]}),(0,r.jsx)("div",{className:"mt-4 flex h-40 items-end gap-3",children:_.sales.perDay.map(e=>{let s=Math.max(e.revenue/O*100,6);return(0,r.jsxs)("div",{className:"flex flex-1 flex-col items-center gap-2",children:[(0,r.jsx)("div",{className:"flex h-32 w-full items-end justify-center rounded bg-primary/10",children:(0,r.jsx)("div",{className:"w-full rounded bg-primary",style:{height:"".concat(s,"%")},title:"".concat(C(e.revenue)," / ").concat(e.jobs," jobs")})}),(0,r.jsx)("p",{className:"text-[11px] text-muted-foreground",children:w.format(new Date(e.date))})]},e.date)})})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-semibold",children:"Top customers"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"By approved amount"})]}),(0,r.jsx)(i.Z,{className:"h-4 w-4 text-primary"})]}),(0,r.jsx)("div",{className:"mt-3 overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,r.jsx)("thead",{className:"text-xs uppercase text-muted-foreground",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"py-2",children:"Customer"}),(0,r.jsx)("th",{className:"py-2",children:"Jobs"}),(0,r.jsx)("th",{className:"py-2",children:"Revenue"})]})}),(0,r.jsx)("tbody",{children:0===_.sales.topCustomers.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{className:"py-4 text-sm text-muted-foreground",colSpan:3,children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 text-center",children:[(0,r.jsx)("div",{className:"mb-1 flex h-10 w-10 items-center justify-center rounded-full border border-dashed border-slate-800 bg-slate-950/60",children:(0,r.jsx)(m.Z,{className:"h-5 w-5 text-slate-500"})}),(0,r.jsx)("p",{className:"text-sm font-medium text-slate-100",children:"No completed jobs in this range."}),(0,r.jsx)("p",{className:"text-xs text-slate-400",children:"Complete jobs to see your top customers here."})]})})}):_.sales.topCustomers.map(e=>(0,r.jsxs)("tr",{className:"border-t text-sm",children:[(0,r.jsxs)("td",{className:"py-2",children:[(0,r.jsx)("p",{className:"font-medium",children:e.name}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:e.phone||"Unknown phone"})]}),(0,r.jsx)("td",{className:"py-2",children:e.jobs}),(0,r.jsx)("td",{className:"py-2",children:C(e.totalRevenue)})]},e.id))})]})})]})]}),(0,r.jsxs)("section",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Job report"})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total jobs"}),(0,r.jsx)("p",{className:"mt-2 text-2xl font-semibold",children:_.jobs.total})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Completed"}),(0,r.jsx)("p",{className:"mt-2 text-2xl font-semibold",children:_.jobs.completed}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[_.jobs.completionRate,"% completion rate"]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Avg turnaround"}),(0,r.jsxs)("p",{className:"mt-2 text-2xl font-semibold",children:[_.jobs.averageTurnaroundHours," h"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"From intake to completion"})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Urgent queue"}),(0,r.jsx)("p",{className:"mt-2 text-2xl font-semibold",children:_.inventory.proxyUrgentJobs}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Priority jobs in range"})]})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"Status breakdown"}),(0,r.jsx)(x.Z,{className:"h-4 w-4 text-primary"})]}),(0,r.jsx)("div",{className:"mt-4 space-y-2 text-sm",children:Object.entries(_.jobs.statusBreakdown).map(e=>{let[s,t]=e;return(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"uppercase tracking-wide text-muted-foreground",children:s.replace("_"," ")}),(0,r.jsx)("span",{children:t})]},s)})})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"Priority mix"}),(0,r.jsx)(u.Z,{className:"h-4 w-4 text-primary"})]}),(0,r.jsx)("div",{className:"mt-4 space-y-2 text-sm",children:Object.entries(_.jobs.priorityBreakdown).map(e=>{let[s,t]=e;return(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"uppercase tracking-wide text-muted-foreground",children:s}),(0,r.jsx)("span",{children:t})]},s)})})]})]})]}),(0,r.jsxs)("section",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,r.jsx)(i.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Customer report"})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"New customers"}),(0,r.jsx)("p",{className:"mt-2 text-2xl font-semibold",children:_.customers.new})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Returning customers"}),(0,r.jsx)("p",{className:"mt-2 text-2xl font-semibold",children:_.customers.returning})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Retention rate"}),(0,r.jsxs)("p",{className:"mt-2 text-2xl font-semibold",children:[_.customers.retentionRate,"%"]})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"Acquisition trend"}),(0,r.jsx)(d.Z,{className:"h-4 w-4 text-primary"})]}),(0,r.jsx)("div",{className:"mt-4 flex h-32 items-end gap-3",children:_.customers.trend.map(e=>{let s=Math.max(e.newCustomers/T*100,8);return(0,r.jsxs)("div",{className:"flex flex-1 flex-col items-center gap-2",children:[(0,r.jsx)("div",{className:"flex h-24 w-full items-end justify-center rounded bg-muted/40",children:(0,r.jsx)("div",{className:"w-full rounded bg-primary/70",style:{height:"".concat(s,"%")},title:"".concat(e.newCustomers," new customers")})}),(0,r.jsx)("p",{className:"text-[11px] text-muted-foreground",children:w.format(new Date(e.date))})]},e.date)})})]})]}),(0,r.jsxs)("section",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"WhatsApp & Campaigns"})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Campaigns created"}),(0,r.jsx)("p",{className:"mt-2 text-2xl font-semibold",children:_.messaging.campaignsCreated})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Running now"}),(0,r.jsx)("p",{className:"mt-2 text-2xl font-semibold",children:_.messaging.runningNow})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Messages sent"}),(0,r.jsx)("p",{className:"mt-2 text-2xl font-semibold",children:_.messaging.sent})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Failed deliveries"}),(0,r.jsx)("p",{className:"mt-2 text-2xl font-semibold",children:_.messaging.failed})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"Recent campaigns"}),(0,r.jsx)(h.Z,{className:"h-4 w-4 text-primary"})]}),(0,r.jsx)("div",{className:"mt-3 space-y-3 text-sm",children:0===_.messaging.recentCampaigns.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 py-4 text-center text-muted-foreground",children:[(0,r.jsx)("div",{className:"mb-1 flex h-10 w-10 items-center justify-center rounded-full border border-dashed border-slate-800 bg-slate-950/60",children:(0,r.jsx)(m.Z,{className:"h-5 w-5 text-slate-500"})}),(0,r.jsx)("p",{className:"text-sm font-medium text-slate-100",children:"No campaigns in this range."}),(0,r.jsx)("p",{className:"text-xs text-slate-400",children:"Launch a campaign to see delivery stats here."})]}):_.messaging.recentCampaigns.slice(0,5).map(e=>(0,r.jsxs)("div",{className:"rounded-lg border p-3",children:[(0,r.jsx)("p",{className:"font-medium",children:e.name}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.status," - ",e.sentCount," sent / ",e.failedCount," failed"]})]},e.id))})]})]}),(0,r.jsxs)("section",{className:"rounded-xl border bg-card p-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-amber-500",children:[(0,r.jsx)(j.Z,{className:"h-4 w-4"}),(0,r.jsx)("p",{className:"text-sm font-semibold",children:"Inventory report pending"})]}),(0,r.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:_.inventory.message}),(0,r.jsxs)("p",{className:"mt-3 rounded-md bg-amber-50 px-3 py-2 text-xs text-amber-800",children:["Current urgent jobs in range: ",_.inventory.proxyUrgentJobs]})]})]}):(0,r.jsx)("div",{className:"rounded-xl border bg-card px-4 py-6 text-sm text-muted-foreground",children:"Unable to load reports for this range."})]})})}},2628:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});var r=t(7573),a=t(1695),d=t(7653),l=t(1799);function n(e){let{children:s,redirectOnFail:t=!0}=e,{user:n,loading:c,error:i,status:m}=(0,l.a)(),o=(0,a.useRouter)();return((0,d.useEffect)(()=>{if(t&&!c&&(!n||i||"unauthenticated"===m)){let e=i?"?reason=".concat(encodeURIComponent(i)):"";o.replace("/login".concat(e))}},[n,c,i,o,t,m]),c)?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading session..."}):!n&&t?null:(0,r.jsx)(r.Fragment,{children:s})}},3735:function(e,s,t){"use strict";t.d(s,{SectionHeader:function(){return d}});var r=t(7573),a=t(9147);function d(e){let{icon:s,overline:t,title:d,description:l,actions:n,className:c}=e;return(0,r.jsxs)("div",{className:(0,a.cn)("flex flex-wrap items-center justify-between gap-4",c),children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[s?(0,r.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-full border border-sky-500/30 bg-sky-500/10 text-sky-400 shadow-sm",children:s}):null,(0,r.jsxs)("div",{children:[t?(0,r.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:t}):null,(0,r.jsx)("h1",{className:"text-xl font-semibold text-slate-50 md:text-2xl",children:d}),l?(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:l}):null]})]}),n?(0,r.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:n}):null]})}}},function(e){e.O(0,[112,422,293,914,744],function(){return e(e.s=5557)}),_N_E=e.O()}]);