"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5611],{33571:function(e,t,n){n.d(t,{h:function(){return f},w:function(){return h}});var r=n(27573),a=n(7653),o=n(83185),s=n(8828),l=n(49289),i=n(75721),c=n(29147);let u=(0,l.j)("relative inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:pointer-events-none disabled:opacity-50 overflow-hidden",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-lg shadow-primary/25 hover:shadow-primary/40",destructive:"bg-destructive text-destructive-foreground shadow-lg shadow-destructive/25 hover:shadow-destructive/40",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",gradient:"bg-gradient-to-r from-primary to-purple-500 text-white shadow-lg hover:shadow-xl hover:shadow-primary/30",glow:"bg-primary text-primary-foreground shadow-glow hover:shadow-glow-lg"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3 text-xs",lg:"h-12 rounded-lg px-8 text-base",xl:"h-14 rounded-xl px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=(0,o.E)(s.g7),h=a.forwardRef((e,t)=>{let{className:n,variant:a,size:s,asChild:l=!1,loading:h=!1,loadingText:f,leftIcon:g,rightIcon:v,children:m,disabled:p,...w}=e,y=p||h,b=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"absolute inset-0 overflow-hidden rounded-[inherit]",children:(0,r.jsx)("span",{className:"absolute inset-0 rounded-[inherit] opacity-0 transition-opacity duration-300 bg-white/20 group-active:opacity-100"})}),(0,r.jsx)("span",{className:"relative flex items-center gap-2",children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{className:"h-4 w-4 animate-spin"}),f||m]}):(0,r.jsxs)(r.Fragment,{children:[g,m,v]})})]});return l?(0,r.jsx)(d,{className:(0,c.cn)(u({variant:a,size:s,className:n}),"group"),ref:t,whileHover:{scale:y?1:1.02},whileTap:{scale:y?1:.98},transition:{type:"spring",stiffness:400,damping:17},...w,children:b}):(0,r.jsx)(o.E.button,{className:(0,c.cn)(u({variant:a,size:s,className:n}),"group"),ref:t,disabled:y,whileHover:{scale:y?1:1.02},whileTap:{scale:y?1:.98},transition:{type:"spring",stiffness:400,damping:17},...w,children:b})});h.displayName="AnimatedButton";let f=a.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,r.jsx)(h,{ref:t,size:"icon",variant:"ghost",className:(0,c.cn)("rounded-full",n),...o,children:a})});f.displayName="IconButton"},45118:function(e,t,n){n.d(t,{QW:function(){return f},R1:function(){return d},SC:function(){return c},pE:function(){return h},sg:function(){return u},zi:function(){return g}});let r="http://localhost:4000",a=()=>window.sessionStorage,o="accessToken",s="refreshToken",l=e=>e.startsWith("/api/auth/login")||e.startsWith("/api/auth/register")||e.startsWith("/api/auth/refresh"),i=!1;async function c(e){var t,n,u,d,h,f,g,v,m;let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{method:w="GET",body:y,headers:b,_retry:x}=p,k="".concat(r).concat(e),T=a(),E=(null==T?void 0:T.getItem(o))||null,A=(null==T?void 0:T.getItem(s))||null;try{let a=await fetch(k,{method:w,headers:{"Content-Type":"application/json",...b||{},...E&&!l?{Authorization:"Bearer ".concat(E)}:{}},body:y?JSON.stringify(y):void 0,credentials:"include"}),i=await a.text(),h={};if(i)try{h=JSON.parse(i)}catch(e){h={message:i}}if(!a.ok){let i=(null==h?void 0:h.message)||"HTTP ".concat(a.status,": ").concat(a.statusText);if(console.error("[API] Request failed: ".concat(w," ").concat(k," - ").concat(i)),401===a.status&&(console.warn("[API] Unauthorized â€“ will let auth layer handle redirect / logout"),!l(e)&&!x&&A)){try{let t=await fetch("".concat(r,"/api/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:A}),credentials:"include"});if(t.ok){let n=await t.json(),r=null==n?void 0:n.accessToken,a=null==n?void 0:n.refreshToken;return r&&(null==T||T.setItem(o,r)),a&&(null==T||T.setItem(s,a)),c(e,{...p,_retry:!0})}}catch(e){console.error("[API] Refresh token request failed",e)}null==T||T.removeItem(o),null==T||T.removeItem(s)}if(502===a.status||503===a.status||504===a.status){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};try{null===(n=globalThis.__toast)||void 0===n||null===(t=n.error)||void 0===t||t.call(n,e.message)}catch(e){}let r=Error(e.message);throw r.code=e.code,r}try{null===(d=globalThis.__toast)||void 0===d||null===(u=d.error)||void 0===u||u.call(d,i)}catch(e){}throw Error(i)}return h}catch(t){if((null==t?void 0:null===(h=t.message)||void 0===h?void 0:h.includes("Failed to fetch"))||(null==t?void 0:null===(f=t.message)||void 0===f?void 0:f.includes("NetworkError"))||(null==t?void 0:null===(g=t.message)||void 0===g?void 0:g.includes("ECONNREFUSED"))||(null==t?void 0:t.name)==="TypeError"){let e={code:"BACKEND_UNAVAILABLE",message:"Backend API server is not running. Please start the API server on port 4000."};i||(console.error("[API] Connection error: ".concat(w," ").concat(k),t),i=!0);try{null===(m=globalThis.__toast)||void 0===m||null===(v=m.error)||void 0===v||v.call(m,e.message)}catch(e){}let n=Error(e.message);throw n.code=e.code,n}if(t instanceof Error&&t.message)throw t;let e=(null==t?void 0:t.message)||"Failed to fetch: ".concat(w," ").concat(k);throw console.error("[API] Request error: ".concat(w," ").concat(k),t),Error(e)}}let u=(e,t)=>c(e,{method:"POST",body:t}),d=e=>c(e,{method:"GET"}),h=(e,t)=>c(e,{method:"PUT",body:t}),f=e=>c(e,{method:"DELETE"});async function g(e,t){let n=await fetch("".concat(r).concat(e),{method:"POST",body:t,credentials:"include"}),a=await n.text(),o=a?JSON.parse(a):{};if(!n.ok)throw Error((null==o?void 0:o.message)||"HTTP ".concat(n.status));return o}},41799:function(e,t,n){n.d(t,{H:function(){return u},a:function(){return d}});var r=n(27573),a=n(7653),o=n(45118);let s=(0,a.createContext)(void 0),l=()=>window.sessionStorage,i="accessToken",c="refreshToken",u=e=>{let{children:t}=e,[n,u]=(0,a.useState)(null),[d,h]=(0,a.useState)("authenticating"),[f,g]=(0,a.useState)(null),[v,m]=(0,a.useState)(null),p="authenticating"===d,w=(0,a.useCallback)(()=>{let e=l();null==e||e.removeItem(i),null==e||e.removeItem(c),m(null)},[]),y=(0,a.useCallback)(()=>{let e=l();return e?{access:e.getItem(i),refresh:e.getItem(c)}:{access:null,refresh:null}},[]),b=(0,a.useCallback)((e,t)=>{let n=l();n&&(e&&n.setItem(i,e),t&&n.setItem(c,t))},[]),x=(0,a.useCallback)(async()=>{let e=await (0,o.R1)("/api/auth/me");return u(e),h("authenticated"),g(null),e},[]),k=(0,a.useCallback)(async()=>{let{refresh:e}=y();if(!e)return!1;try{let n=await (0,o.sg)("/api/auth/refresh",{refreshToken:e});if(null==n?void 0:n.accessToken){var t;return b(n.accessToken,null!==(t=n.refreshToken)&&void 0!==t?t:e),m(n.accessToken),!0}return!1}catch(e){return w(),!1}},[w,y,b]),T=(0,a.useCallback)(async(e,t)=>{g(null),h("authenticating");try{let r=await (0,o.sg)("/api/auth/login",{email:e,password:t});if(null==r?void 0:r.accessToken){var n;b(r.accessToken,null!==(n=r.refreshToken)&&void 0!==n?n:null),m(r.accessToken)}let a=(null==r?void 0:r.user)?r.user:await x();u(a),h("authenticated")}catch(e){throw g((null==e?void 0:e.message)||"Login failed"),h("unauthenticated"),w(),e}},[x,b,w]),E=(0,a.useCallback)(async()=>{try{let{refresh:e}=y();e&&await (0,o.sg)("/api/auth/logout",{refreshToken:e})}catch(e){}finally{w(),u(null),h("unauthenticated")}},[w,y]);(0,a.useEffect)(()=>{let e=!1;return(async()=>{h("authenticating");try{let{access:t,refresh:n}=y(),r=!!t;!r&&n?r=await k():t&&m(t),r?(await x(),e||h("authenticated")):e||(h("unauthenticated"),u(null))}catch(t){if(!e){let e=(null==t?void 0:t.message)||"";(e.includes("Backend API")||e.includes("BACKEND_UNAVAILABLE"))&&g(e),h("unauthenticated"),u(null),w()}}})(),()=>{e=!0}},[k,x,w,y]);let A=(0,a.useMemo)(()=>({user:n,loading:p,status:d,error:f,login:T,logout:E,accessToken:v}),[n,p,d,f,T,E,v]);return(0,r.jsx)(s.Provider,{value:A,children:t})},d=()=>{let e=(0,a.useContext)(s);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},29147:function(e,t,n){n.d(t,{cn:function(){return r}});let r=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}}}]);