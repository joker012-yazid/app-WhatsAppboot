(()=>{var e={};e.id=712,e.ids=[712],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},77892:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>o}),s(17118),s(88029),s(74773),s(87824);var a=s(93282),r=s(5736),l=s(93906),i=s.n(l),n=s(36880),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);s.d(t,d);let o=["",{children:["jobs",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,17118)),"/home/user/app-WhatsAppboot/apps/web/src/app/jobs/[id]/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,88029)),"/home/user/app-WhatsAppboot/apps/web/src/app/jobs/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,74773)),"/home/user/app-WhatsAppboot/apps/web/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,87824,23)),"next/dist/client/components/not-found-error"]}],c=["/home/user/app-WhatsAppboot/apps/web/src/app/jobs/[id]/page.tsx"],u="/jobs/[id]/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/jobs/[id]/page",pathname:"/jobs/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},44459:(e,t,s)=>{Promise.resolve().then(s.bind(s,48426))},36138:(e,t,s)=>{Promise.resolve().then(s.bind(s,98104))},48426:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(73227),r=s(20649),l=s(41043),i=s(23677),n=s(14455),d=s(29536),o=s(241),c=s(73398),u=s(87674),m=s(3254),x=s(72372),p=s(11250),h=s(38609),b=s(5328);function g(){let{id:e}=(0,l.useParams)(),t=(0,l.useRouter)(),s=(0,n.NL)(),g=(0,m.p)(),N=(0,x.N)(),{user:j}=(0,h.a)(),f=(0,d.a)({queryKey:["job",e],queryFn:async()=>(0,u.R1)(`/api/jobs/${e}`)}),y=f.data?.job,v=f.data?.qr_url||"",[D,E]=(0,i.useState)("PENDING"),[A,C]=(0,i.useState)("NORMAL"),[P,w]=(0,i.useState)(""),[k,S]=(0,i.useState)(""),[R,I]=(0,i.useState)(null),T=()=>{y&&(E(y.status),C(y.priority),w(y.dueDate?y.dueDate.substring(0,16):""),S(y.diagnosis||""))};(0,i.useMemo)(()=>{T()},[y?.id]);let[M,G]=(0,i.useState)(!1),F=(0,o.D)({mutationFn:async()=>(0,u.pE)(`/api/jobs/${e}`,{status:D,priority:A,dueDate:P?new Date(P).toISOString():null,diagnosis:k}),onSuccess:async()=>{await s.invalidateQueries({queryKey:["job",e]}),await s.invalidateQueries({queryKey:["jobs"]}),M||g.success("Job updated")},onError:e=>I(e?.message||"Failed to update job")}),{data:$,refetch:H}=(0,d.a)({queryKey:["job-history",e],queryFn:async()=>(0,u.R1)(`/api/jobs/${e}/history`)}),[O,z]=(0,i.useState)(null),[L,q]=(0,i.useState)(""),[_,J]=(0,i.useState)({}),[B,Q]=(0,i.useState)({}),[W,U]=(0,i.useState)({}),K=e=>{if(!et)return[];let t=new Date(e.createdAt);return et.filter(e=>3e5>=Math.abs(new Date(e.createdAt).getTime()-t.getTime()))},V=(0,o.D)({mutationFn:async t=>(0,u.QW)(`/api/jobs/${e}/history/${t}`),onSuccess:async()=>{await H(),g.success("History entry deleted")},onError:e=>g.error(e?.message||"Failed to delete history entry")}),Y=(0,o.D)({mutationFn:async({historyId:t,notes:s})=>(0,u.pE)(`/api/jobs/${e}/history/${t}`,{notes:s}),onSuccess:async()=>{await H(),z(null),q(""),J({}),Q({}),U({}),g.success("History entry updated")},onError:e=>g.error(e?.message||"Failed to update history entry")}),X=(0,o.D)({mutationFn:async({photoId:t,label:s})=>(0,u.pE)(`/api/jobs/${e}/photos/${t}`,{label:s}),onSuccess:async()=>{await es(),g.success("Photo label updated")},onError:e=>g.error(e?.message||"Failed to update photo label")}),Z=(0,o.D)({mutationFn:async({historyId:t,files:s,label:a})=>{let r=new FormData;return s.forEach(e=>r.append("photos",e)),a&&r.append("label",a),(0,u.zi)(`/api/jobs/${e}/photos`,r)},onSuccess:async()=>{await es(),g.success("Photos uploaded")},onError:e=>g.error(e?.message||"Failed to upload photos")}),ee=(0,o.D)({mutationFn:async()=>(0,u.sg)(`/api/jobs/${e}/qr/renew`,{}),onSuccess:async()=>{await s.invalidateQueries({queryKey:["job",e]}),g.success("QR reissued")}}),{data:et,refetch:es}=(0,d.a)({queryKey:["job-photos",e],queryFn:async()=>(0,u.R1)(`/api/jobs/${e}/photos`)}),[ea,er]=(0,i.useState)(""),[el,ei]=(0,i.useState)(null),[en,ed]=(0,i.useState)(null),eo=(0,o.D)({mutationFn:async()=>{if(!el||0===el.length)throw Error("Select file(s)");let t=new FormData;return el.forEach(e=>t.append("photos",e)),ea&&t.append("label",ea),(0,u.zi)(`/api/jobs/${e}/photos`,t)},onSuccess:async e=>{er(""),ei(null),document.getElementById("photo-input")?.value&&(document.getElementById("photo-input").value=""),await es(),M||g.success(`Uploaded ${e?.length??el?.length??0} photo(s)`)},onError:e=>{let t=e?.message||"Failed to upload";ed(t),g.error(t)}}),ec=(0,o.D)({mutationFn:async t=>(0,u.QW)(`/api/jobs/${e}/photos/${t}`),onSuccess:async()=>{await es(),g.success("Photo deleted")}}),eu=(0,o.D)({mutationFn:async()=>(0,u.QW)(`/api/jobs/${e}`),onSuccess:async()=>{await s.invalidateQueries({queryKey:["jobs"]}),g.success("Job deleted"),t.replace("/jobs")},onError:e=>g.error(e?.message||"Failed to delete job")});return a.jsx(c.Z,{children:(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.35em] text-muted-foreground",children:"Job Detail"}),a.jsx("h1",{className:"text-2xl font-semibold",children:y?.title||"Loading…"}),y?(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[y.customer.name," • ",[y.device.deviceType,y.device.brand,y.device.model].filter(Boolean).join(" ")]}):null]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(p.z,{variant:"outline",asChild:!0,children:a.jsx(r.default,{href:"/jobs",children:"Back"})}),a.jsx(p.z,{variant:"destructive",onClick:async()=>{await N({title:"Delete job",description:"Are you sure you want to delete this job? This action cannot be undone.",confirmText:"Delete",variant:"destructive"})&&eu.mutate()},disabled:eu.isPending,children:"Delete"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"QR Progress"}),v?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground break-all",children:[a.jsx("span",{className:"font-medium",children:"URL:"})," ",v]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(p.z,{type:"button",onClick:()=>{navigator.clipboard?.writeText(v)},children:"Copy link"}),a.jsx(p.z,{asChild:!0,variant:"outline",children:a.jsx("a",{href:v,target:"_blank",rel:"noreferrer",children:"Open link"})}),(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"])?a.jsx(p.z,{variant:"secondary",type:"button",onClick:()=>ee.mutate(),disabled:ee.isPending,children:ee.isPending?"Reissuing…":"Reissue QR"}):null]}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Share this link with the customer to check their job progress and photos."})]}):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading QR link…"})]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Status Kerja & Photos"}),a.jsx("div",{className:"mb-4 grid grid-cols-2 gap-2 md:grid-cols-4",children:[{value:"PENDING",label:"Diterima",icon:"\uD83D\uDCE5",color:"amber"},{value:"IN_PROGRESS",label:"Sedang Dibaiki",icon:"\uD83D\uDD27",color:"cyan"},{value:"COMPLETED",label:"Siap Ambil",icon:"✅",color:"green"},{value:"REJECTED",label:"Tidak Dapat Dibaiki",icon:"❌",color:"red"}].map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"])&&E(e.value),disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"]),className:`flex flex-col items-center gap-1 rounded-lg border p-3 text-center transition-all ${D===e.value?"amber"===e.color?"border-amber-500 bg-amber-500/20 text-amber-300":"cyan"===e.color?"border-cyan-500 bg-cyan-500/20 text-cyan-300":"green"===e.color?"border-green-500 bg-green-500/20 text-green-300":"border-red-500 bg-red-500/20 text-red-300":"border-slate-700 bg-slate-900/50 text-slate-400 hover:border-slate-600"}`,children:[a.jsx("span",{className:"text-xl",children:e.icon}),a.jsx("span",{className:"text-xs font-medium",children:e.label})]},e.value))}),(0,a.jsxs)("form",{className:"space-y-4",onSubmit:async e=>{e.preventDefault(),I(null),ed(null),G(!0);try{await F.mutateAsync(),el&&el.length>0&&await eo.mutateAsync(),el&&el.length>0?g.success(`Status updated dan ${el.length} photo(s) uploaded!`):g.success("Status updated!")}catch(e){console.error("Form submission error:",e)}finally{G(!1)}},children:[(0,a.jsxs)("div",{className:"rounded-lg border border-slate-700 bg-slate-900/30 p-4",children:[(0,a.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[a.jsx("h3",{className:"text-sm font-semibold text-slate-200",children:"\uD83D\uDCF7 Upload Photos"}),a.jsx("span",{className:"text-xs text-slate-400 italic",children:"(Pilihan - Skip jika tiada photos)"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[a.jsx("input",{id:"photo-input",type:"file",accept:"image/*",multiple:!0,onChange:e=>{let t=Array.from(e.target.files||[]);if(t.length>6){ei(null),ed("Select up to 6 files"),e.target.value="";return}if(t.find(e=>!e.type.startsWith("image/")||e.size>5242880)){ei(null),ed("Only images up to 5 MB each are allowed"),e.target.value="";return}ed(null),ei(t)},className:"md:col-span-2 rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground file:mr-4 file:rounded-md file:border-0 file:bg-cyan-600 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-white hover:file:bg-cyan-700",disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"])}),a.jsx("input",{type:"text",placeholder:"Label (optional)",value:ea,onChange:e=>er(e.target.value),className:"rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground",disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"])})]}),(0,a.jsxs)("p",{className:"mt-2 text-xs text-muted-foreground",children:["PNG/JPG/WebP up to 5 MB each. Max 6 files. ",a.jsx("span",{className:"text-slate-500",children:"Boleh skip jika tiada photos untuk upload."})]}),en?a.jsx("p",{className:"mt-2 text-sm text-red-500",children:en}):null,el&&el.length>0&&(0,a.jsxs)("div",{className:"mt-3 rounded-md bg-cyan-500/10 border border-cyan-500/30 p-2 text-xs text-cyan-300",children:["\uD83D\uDCCE ",el.length," file",el.length>1?"s":""," selected - akan diupload bersama status update"]})]}),("IN_PROGRESS"===D||"QUOTED"===D||"APPROVED"===D)&&(0,a.jsxs)("div",{className:"rounded-lg border border-cyan-500/30 bg-cyan-950/20 p-4",children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-cyan-300",children:"\uD83D\uDD27 Fasa Kerja Semasa"}),a.jsx("div",{className:"grid grid-cols-2 gap-2 md:grid-cols-5",children:[{id:"troubleshoot",label:"Troubleshoot",icon:"\uD83D\uDD0D"},{id:"repair",label:"Repair",icon:"\uD83D\uDEE0️"},{id:"order",label:"Order Parts",icon:"\uD83D\uDCE6"},{id:"install",label:"Pemasangan",icon:"⚙️"},{id:"testing",label:"Testing/QA",icon:"✔️"}].map(e=>{let t=k.match(/\[PHASE:(\w+)\]/)?.[1]||"troubleshoot",s=t===e.id,r=["troubleshoot","repair","order","install","testing"],l=r.indexOf(t)>r.indexOf(e.id);return(0,a.jsxs)("button",{type:"button",onClick:()=>{if(!(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"]))return;let t=k.replace(/\[PHASE:\w+\]\s*/g,"");S(`[PHASE:${e.id}] ${t}`)},disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"]),className:`flex flex-col items-center gap-1 rounded-lg border p-2 text-center transition-all ${s?"border-cyan-400 bg-cyan-500/30 text-cyan-200 ring-2 ring-cyan-500/50":l?"border-green-500/50 bg-green-500/20 text-green-400":"border-slate-700 bg-slate-800/50 text-slate-500 hover:border-slate-600"}`,children:[a.jsx("span",{className:"text-lg",children:e.icon}),a.jsx("span",{className:"text-[10px] font-medium",children:e.label})]},e.id)})})]}),"REJECTED"===D&&(0,a.jsxs)("div",{className:"rounded-lg border border-red-500/30 bg-red-950/20 p-4",children:[a.jsx("h3",{className:"mb-2 text-sm font-semibold text-red-300",children:"❌ Sebab Tidak Dapat Dibaiki"}),a.jsx("p",{className:"mb-2 text-xs text-red-400",children:"Sila nyatakan sebab kenapa barang ini tidak dapat dibaiki:"}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:["Kerosakan teruk","Part tidak ada","Kos repair > nilai barang","Customer tolak quote","Masalah lain"].map(e=>a.jsx("button",{type:"button",onClick:()=>{if(!(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"]))return;let t=k.replace(/\[REJECT:.*?\]\s*/g,"");S(`[REJECT:${e}] ${t}`)},className:`rounded-full px-3 py-1 text-xs font-medium transition-all ${k.includes(`[REJECT:${e}]`)?"bg-red-500/30 text-red-200 ring-1 ring-red-500":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,children:e},e))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"priority",children:"Prioriti"}),a.jsx("select",{id:"priority",value:A,onChange:e=>C(e.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground",disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"]),children:["LOW","NORMAL","HIGH","URGENT"].map(e=>a.jsx("option",{value:e,className:"bg-background text-foreground",children:{LOW:"Rendah",NORMAL:"Biasa",HIGH:"Tinggi",URGENT:"Segera"}[e]||e},e))})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"due",children:"ETA Siap"}),a.jsx("input",{id:"due",type:"datetime-local",value:P,onChange:e=>w(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"])})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"diagnosis",children:"\uD83D\uDCDD Catatan Technician"}),a.jsx("textarea",{id:"diagnosis",value:k.replace(/\[PHASE:\w+\]\s*/g,"").replace(/\[REJECT:.*?\]\s*/g,""),onChange:e=>{let t=k.match(/\[PHASE:\w+\]/),s=k.match(/\[REJECT:.*?\]/),a=t?`${t[0]} `:s?`${s[0]} `:"";S(`${a}${e.target.value}`)},placeholder:"Masukkan catatan kerja, masalah yang ditemui, parts yang diganti, dll...",className:"h-28 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"])}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Catatan ini akan dipaparkan kepada customer dalam timeline progress."})]}),R?a.jsx("p",{className:"text-sm text-red-500",children:R}):null,(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"])?a.jsx("div",{className:"flex gap-2",children:a.jsx(p.z,{type:"submit",disabled:F.isPending||eo.isPending,className:"flex-1",children:F.isPending||eo.isPending?"Menyimpan…":el&&el.length>0?"\uD83D\uDCBE Simpan Status & Upload Photos":"\uD83D\uDCBE Simpan & Update Timeline"})}):null]}),(0,a.jsxs)("div",{className:"mt-6 border-t border-slate-800 pt-4",children:[a.jsx("h3",{className:"mb-3 text-sm font-semibold text-slate-200",children:"\uD83D\uDCF8 Photos Terkumpul"}),et?0===et.length?a.jsx("p",{className:"text-sm text-muted-foreground",children:"Belum ada photos."}):a.jsx("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:et.map(e=>(0,a.jsxs)("figure",{className:"space-y-1",children:[a.jsx("img",{src:e.url,alt:e.label||"Job photo",className:"h-32 w-full rounded-md object-cover border border-slate-700"}),(0,a.jsxs)("figcaption",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[a.jsx("span",{className:"truncate",children:e.label||"—"}),(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"])?a.jsx("button",{className:"rounded border border-red-500/30 bg-red-500/10 px-2 py-0.5 text-red-400 hover:bg-red-500/20 transition-colors",onClick:async()=>{await N({title:"Delete photo",description:"Are you sure you want to delete this photo?",confirmText:"Delete",variant:"destructive"})&&ec.mutate(e.id)},disabled:ec.isPending,children:"\uD83D\uDDD1️"}):null]})]},e.id))}):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"})]})]})]}),(0,a.jsxs)("aside",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h3",{className:"mb-2 text-sm font-semibold text-muted-foreground",children:"Maklumat Job"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("li",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Job ID:"}),a.jsx("span",{className:"font-mono text-xs",children:y?.id?.slice(0,8)||"-"})]}),(0,a.jsxs)("li",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Tarikh Masuk:"}),a.jsx("span",{children:y?new Date(y.createdAt).toLocaleDateString("ms-MY"):"-"})]}),(0,a.jsxs)("li",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Status:"}),a.jsx("span",{className:`font-medium ${y?.status==="COMPLETED"?"text-green-400":y?.status==="IN_PROGRESS"?"text-cyan-400":y?.status==="REJECTED"?"text-red-400":y?.status==="APPROVED"?"text-emerald-400":"text-amber-400"}`,children:{PENDING:"Checked-In",QUOTED:"Diagnosing",APPROVED:"Approved",REJECTED:"Declined",IN_PROGRESS:"In Repair",COMPLETED:"Closed"}[y?.status||""]||y?.status||"-"})]}),(0,a.jsxs)("li",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Prioriti:"}),a.jsx("span",{className:`font-medium ${y?.priority==="URGENT"?"text-red-400":y?.priority==="HIGH"?"text-orange-400":y?.priority==="NORMAL"?"text-slate-300":"text-slate-500"}`,children:{LOW:"Rendah",NORMAL:"Biasa",HIGH:"Tinggi",URGENT:"Segera"}[y?.priority||""]||y?.priority||"-"})]}),y?.quotedAmount&&(0,a.jsxs)("li",{className:"flex justify-between",children:[a.jsx("span",{className:"text-muted-foreground",children:"Quote:"}),(0,a.jsxs)("span",{className:"font-medium text-emerald-400",children:["RM ",Number(y.quotedAmount).toFixed(2)]})]})]})]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h3",{className:"mb-2 text-sm font-semibold text-muted-foreground",children:"Timeline Status"}),$?0===$.length?a.jsx("p",{className:"text-sm text-muted-foreground",children:"Belum ada perubahan."}):a.jsx("ul",{className:"space-y-3 text-sm max-h-96 overflow-y-auto",children:$.map(e=>{let t=O===e.id,s=(e.notes||"").replace(/\[PHASE:\w+\]\s*/g,"").replace(/\[REJECT:.*?\]\s*/g,"").trim(),r=K(e),l=B[e.id]||[];return a.jsx("li",{className:"border-b border-slate-800 pb-3 last:border-b-0",children:a.jsx("div",{className:"flex items-start justify-between gap-2",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-1",children:[a.jsx("span",{className:"font-medium text-cyan-300",children:{PENDING:"Checked-In",QUOTED:"Diagnosing",APPROVED:"Approved",REJECTED:"Declined",IN_PROGRESS:"In Repair",COMPLETED:"Closed"}[e.status]||e.status}),a.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:new Date(e.createdAt).toLocaleString("ms-MY",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]}),t?(0,a.jsxs)("div",{className:"mt-2 space-y-3",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs font-medium mb-1 block",children:"Catatan:"}),a.jsx("textarea",{value:L,onChange:e=>q(e.target.value),placeholder:"Masukkan catatan...",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-xs text-foreground min-h-[60px]",autoFocus:!0})]}),r.length>0&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs font-medium mb-2 block",children:"\uD83D\uDCF7 Edit Photos:"}),a.jsx("div",{className:"space-y-2",children:r.map(e=>(0,a.jsxs)("div",{className:"flex gap-2 items-start p-2 bg-slate-900/50 rounded",children:[a.jsx("img",{src:e.url,alt:e.label||"Photo",className:"w-16 h-16 object-cover rounded"}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("input",{type:"text",value:_[e.id]??e.label??"",onChange:t=>J({..._,[e.id]:t.target.value}),placeholder:"Label photo...",className:"w-full rounded-md border border-input bg-background px-2 py-1 text-xs text-foreground mb-1"}),(0,a.jsxs)("div",{className:"flex gap-1",children:[a.jsx(p.z,{size:"sm",variant:"ghost",className:"h-5 text-xs text-cyan-400",onClick:()=>{X.mutate({photoId:e.id,label:_[e.id]??e.label??""})},disabled:X.isPending,children:"Simpan Label"}),a.jsx(p.z,{size:"sm",variant:"ghost",className:"h-5 text-xs text-red-400",onClick:async()=>{await N({title:"Delete Photo",description:"Are you sure you want to delete this photo?",confirmText:"Delete",variant:"destructive"})&&ec.mutate(e.id)},disabled:ec.isPending,children:"\uD83D\uDDD1️"})]})]})]},e.id))})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"text-xs font-medium mb-2 block",children:"\uD83D\uDCF7 Tambah Photos Baru:"}),a.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:t=>{let s=Array.from(t.target.files||[]);Q({...B,[e.id]:s})},className:"w-full rounded-md border border-input bg-background px-3 py-2 text-xs text-foreground file:mr-4 file:rounded-md file:border-0 file:bg-cyan-600 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-white"}),l.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[a.jsx("input",{type:"text",value:W[e.id]??"",onChange:t=>U({...W,[e.id]:t.target.value}),placeholder:"Label untuk photos baru (optional)",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-xs text-foreground mb-2"}),(0,a.jsxs)(p.z,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:()=>{Z.mutate({historyId:e.id,files:l,label:W[e.id]})},disabled:Z.isPending,children:["Upload ",l.length," Photo(s)"]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 pt-2",children:[a.jsx(p.z,{size:"sm",variant:"default",className:"h-7 text-xs flex-1",onClick:()=>{Y.mutate({historyId:e.id,notes:L})},disabled:Y.isPending||Z.isPending,children:"Simpan Semua"}),a.jsx(p.z,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:()=>{z(null),q(""),J({}),Q({}),U({})},disabled:Y.isPending||Z.isPending,children:"Batal"})]})]}):(0,a.jsxs)(a.Fragment,{children:[s?a.jsx("p",{className:"text-xs text-muted-foreground mt-1 bg-slate-900/50 rounded px-2 py-1.5",children:s}):null,r.length>0&&(0,a.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,a.jsxs)("div",{className:"text-xs font-medium text-slate-400 mb-1",children:["\uD83D\uDCF7 Photos (",r.length,"):"]}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:r.map(e=>(0,a.jsxs)("div",{className:"relative group",children:[a.jsx("img",{src:e.url,alt:e.label||"Photo",className:"w-full h-20 object-cover rounded border border-slate-700"}),e.label&&a.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/70 text-white text-[10px] px-1 py-0.5 rounded-b truncate",children:e.label})]},e.id))})]}),(0,b.A)(j?.role,["ADMIN","MANAGER","TECHNICIAN"])&&(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[a.jsx(p.z,{size:"sm",variant:"ghost",className:"h-6 text-xs text-cyan-400 hover:text-cyan-300",onClick:()=>{z(e.id),q(s);let t={};r.forEach(e=>{t[e.id]=e.label||""}),J(t)},children:"✏️ Edit"}),a.jsx(p.z,{size:"sm",variant:"ghost",className:"h-6 text-xs text-red-400 hover:text-red-300",onClick:async()=>{await N({title:"Delete History Entry",description:"Are you sure you want to delete this timeline entry? This action cannot be undone.",confirmText:"Delete",variant:"destructive"})&&V.mutate(e.id)},disabled:V.isPending,children:"\uD83D\uDDD1️ Delete"})]})]})]})})},e.id)})}):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Memuatkan…"})]})]})]})]})})}},98104:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var a=s(73227),r=s(90708);function l({children:e}){return a.jsx(r.L,{children:e})}},11250:(e,t,s)=>{"use strict";s.d(t,{z:()=>o});var a=s(73227),r=s(23677),l=s(62007),i=s(31086),n=s(18755);let d=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef(({className:e,variant:t,size:s,asChild:r=!1,...i},o)=>{let c=r?l.g7:"button";return a.jsx(c,{className:(0,n.cn)(d({variant:t,size:s,className:e})),ref:o,...i})});o.displayName="Button"},5328:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(e,t)=>!!e&&t.includes(e)},17118:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(53189).createProxy)(String.raw`/home/user/app-WhatsAppboot/apps/web/src/app/jobs/[id]/page.tsx#default`)},88029:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(53189).createProxy)(String.raw`/home/user/app-WhatsAppboot/apps/web/src/app/jobs/layout.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[193,2,456,415,916,933,777,708],()=>s(77892));module.exports=a})();