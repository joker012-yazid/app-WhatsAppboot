(()=>{var e={};e.id=712,e.ids=[712],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8137:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>o}),t(7118),t(8322),t(7824);var a=t(3282),r=t(5736),n=t(3906),l=t.n(n),i=t(6880),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);t.d(s,d);let o=["",{children:["jobs",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,7118)),"C:\\Users\\Jokeryazid\\Documents\\My projek\\new whatsappbot\\app-WhatsAppboot\\apps\\web\\src\\app\\jobs\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,8322)),"C:\\Users\\Jokeryazid\\Documents\\My projek\\new whatsappbot\\app-WhatsAppboot\\apps\\web\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,7824,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\Jokeryazid\\Documents\\My projek\\new whatsappbot\\app-WhatsAppboot\\apps\\web\\src\\app\\jobs\\[id]\\page.tsx"],u="/jobs/[id]/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/jobs/[id]/page",pathname:"/jobs/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},9320:(e,s,t)=>{Promise.resolve().then(t.bind(t,8426))},8426:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>b});var a=t(3227),r=t(649),n=t(1043),l=t(3677),i=t(4455),d=t(9536),o=t(241),c=t(3398),u=t(7674),m=t(3254),p=t(2372),x=t(1250),h=t(8609),g=t(5328);function b(){let{id:e}=(0,n.useParams)(),s=(0,n.useRouter)(),t=(0,i.NL)(),b=(0,m.p)(),N=(0,p.N)(),{user:y}=(0,h.a)(),f=(0,d.a)({queryKey:["job",e],queryFn:async()=>(0,u.R1)(`/api/jobs/${e}`)}),v=f.data?.job,A=f.data?.qr_url||"",[w,D]=(0,l.useState)("PENDING"),[E,C]=(0,l.useState)("NORMAL"),[P,S]=(0,l.useState)(""),[I,k]=(0,l.useState)(""),[R,M]=(0,l.useState)(null),q=()=>{v&&(D(v.status),C(v.priority),S(v.dueDate?v.dueDate.substring(0,16):""),k(v.diagnosis||""))};(0,l.useMemo)(()=>{q()},[v?.id]);let F=(0,o.D)({mutationFn:async()=>(0,u.pE)(`/api/jobs/${e}`,{status:w,priority:E,dueDate:P?new Date(P).toISOString():null,diagnosis:I}),onSuccess:async()=>{await t.invalidateQueries({queryKey:["job",e]}),await t.invalidateQueries({queryKey:["jobs"]}),b.success("Job updated")},onError:e=>M(e?.message||"Failed to update job")}),{data:G}=(0,d.a)({queryKey:["job-history",e],queryFn:async()=>(0,u.R1)(`/api/jobs/${e}/history`)}),T=(0,o.D)({mutationFn:async()=>(0,u.sg)(`/api/jobs/${e}/qr/renew`,{}),onSuccess:async()=>{await t.invalidateQueries({queryKey:["job",e]}),b.success("QR reissued")}}),{data:_,refetch:L}=(0,d.a)({queryKey:["job-photos",e],queryFn:async()=>(0,u.R1)(`/api/jobs/${e}/photos`)}),[z,U]=(0,l.useState)(""),[$,H]=(0,l.useState)(null),[O,Q]=(0,l.useState)(null),J=(0,o.D)({mutationFn:async()=>{if(!$||0===$.length)throw Error("Select file(s)");let s=new FormData;return $.forEach(e=>s.append("photos",e)),z&&s.append("label",z),(0,u.zi)(`/api/jobs/${e}/photos`,s)},onSuccess:async e=>{U(""),H(null),document.getElementById("photo-input")?.value&&(document.getElementById("photo-input").value=""),await L(),b.success(`Uploaded ${e?.length??$?.length??0} photo(s)`)},onError:e=>{let s=e?.message||"Failed to upload";Q(s),b.error(s)}}),W=(0,o.D)({mutationFn:async s=>(0,u.QW)(`/api/jobs/${e}/photos/${s}`),onSuccess:async()=>{await L(),b.success("Photo deleted")}}),K=(0,o.D)({mutationFn:async()=>(0,u.QW)(`/api/jobs/${e}`),onSuccess:async()=>{await t.invalidateQueries({queryKey:["jobs"]}),b.success("Job deleted"),s.replace("/jobs")},onError:e=>b.error(e?.message||"Failed to delete job")});return a.jsx(c.Z,{children:(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.35em] text-muted-foreground",children:"Job Detail"}),a.jsx("h1",{className:"text-2xl font-semibold",children:v?.title||"Loading…"}),v?(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[v.customer.name," • ",[v.device.deviceType,v.device.brand,v.device.model].filter(Boolean).join(" ")]}):null]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(x.z,{variant:"outline",asChild:!0,children:a.jsx(r.default,{href:"/jobs",children:"Back"})}),a.jsx(x.z,{variant:"destructive",onClick:async()=>{await N({title:"Delete job",description:"Are you sure you want to delete this job? This action cannot be undone.",confirmText:"Delete",variant:"destructive"})&&K.mutate()},disabled:K.isPending,children:"Delete"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"AI Assistant"}),a.jsx(j,{jobId:e})]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"QR Registration"}),A?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-sm text-muted-foreground break-all",children:[a.jsx("span",{className:"font-medium",children:"URL:"})," ",A]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(x.z,{type:"button",onClick:()=>{navigator.clipboard?.writeText(A)},children:"Copy link"}),a.jsx(x.z,{asChild:!0,variant:"outline",children:a.jsx("a",{href:A,target:"_blank",rel:"noreferrer",children:"Open link"})}),(0,g.A)(y?.role,["ADMIN","MANAGER","TECHNICIAN"])?a.jsx(x.z,{variant:"secondary",type:"button",onClick:()=>T.mutate(),disabled:T.isPending,children:T.isPending?"Reissuing…":"Reissue QR"}):null]}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Share this link with the customer to complete registration."})]}):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading QR link…"})]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Photos"}),(0,a.jsxs)("form",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-3",onSubmit:e=>{e.preventDefault(),Q(null),J.mutate()},children:[a.jsx("input",{id:"photo-input",type:"file",accept:"image/*",multiple:!0,onChange:e=>{let s=Array.from(e.target.files||[]);if(s.length>6){H(null),Q("Select up to 6 files"),e.target.value="";return}if(s.find(e=>!e.type.startsWith("image/")||e.size>5242880)){H(null),Q("Only images up to 5 MB each are allowed"),e.target.value="";return}Q(null),H(s)},className:"md:col-span-2"}),a.jsx("input",{type:"text",placeholder:"Label (optional)",value:z,onChange:e=>U(e.target.value),className:"rounded-md border border-input bg-transparent px-3 py-2 text-sm"}),(0,a.jsxs)("div",{className:"md:col-span-3",children:[a.jsx("p",{className:"mb-2 text-xs text-muted-foreground",children:"PNG/JPG/WebP up to 5 MB each. Max 6 files."}),O?a.jsx("p",{className:"mb-2 text-sm text-red-500",children:O}):null,a.jsx(x.z,{type:"submit",disabled:J.isPending||!$||0===$.length||!!O||!(0,g.A)(y?.role,["ADMIN","MANAGER","TECHNICIAN"]),children:J.isPending?"Uploading…":"Upload"})]})]}),_?0===_.length?a.jsx("p",{className:"text-sm text-muted-foreground",children:"No photos yet."}):a.jsx("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-3",children:_.map(e=>(0,a.jsxs)("figure",{className:"space-y-1",children:[a.jsx("img",{src:e.url,alt:e.label||"Job photo",className:"h-40 w-full rounded-md object-cover"}),(0,a.jsxs)("figcaption",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[a.jsx("span",{className:"truncate",children:e.label||"—"}),(0,g.A)(y?.role,["ADMIN","MANAGER","TECHNICIAN"])?a.jsx("button",{className:"rounded border px-2 py-0.5",onClick:async()=>{await N({title:"Delete photo",description:"Are you sure you want to delete this photo?",confirmText:"Delete",variant:"destructive"})&&W.mutate(e.id)},disabled:W.isPending,children:"Delete"}):null]})]},e.id))}):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"})]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Status & Scheduling"}),(0,a.jsxs)("form",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",onSubmit:e=>{e.preventDefault(),M(null),F.mutate()},children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"status",children:"Status"}),a.jsx("select",{id:"status",value:w,onChange:e=>D(e.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground",disabled:!(0,g.A)(y?.role,["ADMIN","MANAGER","TECHNICIAN"]),children:["PENDING","QUOTED","APPROVED","REJECTED","IN_PROGRESS","COMPLETED"].map(e=>a.jsx("option",{value:e,className:"bg-background text-foreground",children:e},e))})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"priority",children:"Priority"}),a.jsx("select",{id:"priority",value:E,onChange:e=>C(e.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground",disabled:!(0,g.A)(y?.role,["ADMIN","MANAGER","TECHNICIAN"]),children:["LOW","NORMAL","HIGH","URGENT"].map(e=>a.jsx("option",{value:e,className:"bg-background text-foreground",children:e},e))})]}),(0,a.jsxs)("div",{className:"space-y-1 md:col-span-2",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"due",children:"Due date"}),a.jsx("input",{id:"due",type:"datetime-local",value:P,onChange:e=>S(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",disabled:!(0,g.A)(y?.role,["ADMIN","MANAGER","TECHNICIAN"])})]}),(0,a.jsxs)("div",{className:"space-y-1 md:col-span-2",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"diagnosis",children:"Diagnosis (optional)"}),a.jsx("textarea",{id:"diagnosis",value:I,onChange:e=>k(e.target.value),className:"h-24 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",disabled:!(0,g.A)(y?.role,["ADMIN","MANAGER","TECHNICIAN"])})]}),R?a.jsx("p",{className:"text-sm text-red-500 md:col-span-2",children:R}):null,(0,g.A)(y?.role,["ADMIN","MANAGER","TECHNICIAN"])?a.jsx("div",{className:"md:col-span-2",children:a.jsx(x.z,{type:"submit",disabled:F.isPending,children:F.isPending?"Saving…":"Save changes"})}):null]})]})]}),(0,a.jsxs)("aside",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h3",{className:"mb-2 text-sm font-semibold text-muted-foreground",children:"Meta"}),(0,a.jsxs)("ul",{className:"text-sm",children:[(0,a.jsxs)("li",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Created:"})," ",v?new Date(v.createdAt).toLocaleString():"-"]}),(0,a.jsxs)("li",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Status:"})," ",v?.status||"-"]}),(0,a.jsxs)("li",{children:[a.jsx("span",{className:"text-muted-foreground",children:"Priority:"})," ",v?.priority||"-"]})]})]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h3",{className:"mb-2 text-sm font-semibold text-muted-foreground",children:"Status History"}),G?0===G.length?a.jsx("p",{className:"text-sm text-muted-foreground",children:"No changes yet."}):a.jsx("ul",{className:"space-y-2 text-sm",children:G.map(e=>(0,a.jsxs)("li",{className:"border-b pb-2 last:border-b-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:e.status}),a.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleString()})]}),e.notes?a.jsx("p",{className:"text-muted-foreground",children:e.notes}):null]},e.id))}):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"})]})]})]})]})})}function j({jobId:e}){let{data:s,refetch:t,isFetching:r}=(0,d.a)({queryKey:["ai-messages",e],queryFn:async()=>(0,u.R1)(`/api/ai/job/${e}/messages`)}),n=(0,m.p)(),[i,c]=(0,l.useState)(""),p=(0,o.D)({mutationFn:async()=>(0,u.sg)("/api/ai/ask",{jobId:e,message:i}),onSuccess:async()=>{c(""),await t()},onError:e=>n.error(e?.message||"Failed to ask AI")});return(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("div",{className:"max-h-64 space-y-2 overflow-auto rounded border p-3 text-sm",children:!s||r?a.jsx("p",{className:"text-muted-foreground",children:"Loading…"}):0===s.messages.length?a.jsx("p",{className:"text-muted-foreground",children:"No messages yet. Ask something about this job."}):s.messages.map(e=>a.jsx("div",{className:"USER"===e.role?"text-right":"text-left",children:a.jsx("span",{className:`inline-block rounded-md px-2 py-1 ${"USER"===e.role?"bg-primary text-primary-foreground":"bg-muted text-foreground"}`,children:e.content})},e.id))}),(0,a.jsxs)("form",{className:"flex items-center gap-2",onSubmit:e=>{e.preventDefault(),i.trim()&&p.mutate()},children:[a.jsx("input",{value:i,onChange:e=>c(e.target.value),placeholder:"Ask AI about this job…",className:"flex-1 rounded-md border border-input bg-transparent px-3 py-2 text-sm"}),a.jsx(x.z,{type:"submit",disabled:p.isPending||!i.trim(),children:p.isPending?"Sending…":"Send"})]})]})}},3398:(e,s,t)=>{"use strict";t.d(s,{Z:()=>l});var a=t(3227),r=t(1043);t(3677);var n=t(8609);function l({children:e,redirectOnFail:s=!0}){let{user:t,loading:l,error:i,status:d}=(0,n.a)();return((0,r.useRouter)(),l)?a.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading session..."}):!t&&s?null:a.jsx(a.Fragment,{children:e})}},5328:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(e,s)=>!!e&&s.includes(e)},7118:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(3189).createProxy)(String.raw`C:\Users\Jokeryazid\Documents\My projek\new whatsappbot\app-WhatsAppboot\apps\web\src\app\jobs\[id]\page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[193,937,933,420],()=>t(8137));module.exports=a})();