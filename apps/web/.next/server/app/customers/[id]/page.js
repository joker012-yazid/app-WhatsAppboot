(()=>{var e={};e.id=238,e.ids=[238],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1882:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>d.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>o}),t(754),t(8322),t(7824);var a=t(3282),r=t(5736),n=t(3906),d=t.n(n),l=t(6880),i={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>l[e]);t.d(s,i);let o=["",{children:["customers",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,754)),"C:\\Users\\Jokeryazid\\Documents\\My projek\\new whatsappbot\\app-WhatsAppboot\\apps\\web\\src\\app\\customers\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,8322)),"C:\\Users\\Jokeryazid\\Documents\\My projek\\new whatsappbot\\app-WhatsAppboot\\apps\\web\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,7824,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\Jokeryazid\\Documents\\My projek\\new whatsappbot\\app-WhatsAppboot\\apps\\web\\src\\app\\customers\\[id]\\page.tsx"],u="/customers/[id]/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/customers/[id]/page",pathname:"/customers/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},8764:(e,s,t)=>{Promise.resolve().then(t.bind(t,9284))},9284:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g});var a=t(3227),r=t(649),n=t(1043),d=t(3677),l=t(4455),i=t(9536),o=t(241),c=t(3398),u=t(7674),m=t(1250),p=t(3254),x=t(2372),h=t(8609),b=t(5328);function g(){let{id:e}=(0,n.useParams)(),s=(0,n.useRouter)(),t=(0,l.NL)(),g=(0,i.a)({queryKey:["customer",e],queryFn:async()=>(0,u.R1)(`/api/customers/${e}`)}),{user:j}=(0,h.a)(),N=g.data,[v,f]=(0,d.useState)(""),[y,A]=(0,d.useState)(""),[w,M]=(0,d.useState)(""),[D,P]=(0,d.useState)(""),[E,_]=(0,d.useState)(null),C=(0,p.p)(),k=(0,x.N)(),q=(0,o.D)({mutationFn:async()=>(0,u.pE)(`/api/customers/${e}`,{name:v,phone:y,email:w,notes:D}),onSuccess:async()=>{await t.invalidateQueries({queryKey:["customer",e]}),await t.invalidateQueries({queryKey:["customers"]}),C.success("Customer updated")},onError:e=>{let s=e?.message||"Failed to save";_(s),C.error(s)}}),S=(0,o.D)({mutationFn:async()=>(0,u.QW)(`/api/customers/${e}`),onSuccess:async()=>{await t.invalidateQueries({queryKey:["customers"]}),C.success("Customer deleted"),s.replace("/customers")},onError:e=>{let s=e?.message||"Failed to delete";_(s),C.error(s)}}),G=!!N&&(N._count?.devices||0)+(N._count?.jobs||0)>0;return a.jsx(c.Z,{children:(0,a.jsxs)("section",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.35em] text-muted-foreground",children:"Customer Detail"}),a.jsx("h1",{className:"text-2xl font-semibold",children:N?N.name:"Loading…"}),N?a.jsx("p",{className:"text-sm text-muted-foreground",children:N.phone}):null]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(m.z,{variant:"outline",asChild:!0,children:a.jsx(r.default,{href:"/customers",children:"Back"})}),(0,b.A)(j?.role,["ADMIN","MANAGER"])?a.jsx(m.z,{variant:"destructive",disabled:G||S.isPending,onClick:async()=>{await k({title:"Delete customer",description:"Are you sure you want to delete this customer? This action cannot be undone.",variant:"destructive",confirmText:"Delete"})&&S.mutate()},children:G?"Has records":"Delete"}):null]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsxs)("div",{className:"md:col-span-2 rounded-xl border bg-card p-4",children:[a.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Edit Customer"}),(0,b.A)(j?.role,["ADMIN","MANAGER"])?null:a.jsx("p",{className:"mb-3 text-sm text-amber-700",children:"You have read-only access. Editing is restricted to Admin/Manager."}),G?a.jsx("p",{className:"mb-3 text-sm text-muted-foreground",children:"This customer has related records. You can update details but deletion is disabled."}):null,(0,a.jsxs)("form",{className:"space-y-3",onSubmit:e=>{e.preventDefault(),_(null),q.mutate()},children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"name",children:"Name"}),a.jsx("input",{id:"name",value:v,onChange:e=>f(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",required:!0,disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER"])})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"phone",children:"Phone"}),a.jsx("input",{id:"phone",value:y,onChange:e=>A(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",required:!0,disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER"])})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"email",children:"Email"}),a.jsx("input",{id:"email",type:"email",value:w,onChange:e=>M(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER"])})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-medium",htmlFor:"notes",children:"Notes"}),a.jsx("input",{id:"notes",value:D,onChange:e=>P(e.target.value),className:"w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm",disabled:!(0,b.A)(j?.role,["ADMIN","MANAGER"])})]}),E?a.jsx("p",{className:"text-sm text-red-500",children:E}):null,(0,b.A)(j?.role,["ADMIN","MANAGER"])?a.jsx(m.z,{type:"submit",disabled:q.isPending,children:q.isPending?"Saving…":"Save changes"}):null]})]}),(0,a.jsxs)("aside",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h3",{className:"mb-2 text-sm font-semibold text-muted-foreground",children:"Devices"}),N?0===N.devices.length?a.jsx("p",{className:"text-sm text-muted-foreground",children:"No devices."}):a.jsx("ul",{className:"space-y-2 text-sm",children:N.devices.map(e=>a.jsx("li",{children:a.jsx(r.default,{href:`/devices/${e.id}`,className:"underline hover:no-underline",children:[e.deviceType,e.brand,e.model].filter(Boolean).join(" ")})},e.id))}):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"})]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-card p-4",children:[a.jsx("h3",{className:"mb-2 text-sm font-semibold text-muted-foreground",children:"Jobs"}),N?0===N.jobs.length?a.jsx("p",{className:"text-sm text-muted-foreground",children:"No jobs."}):a.jsx("ul",{className:"space-y-2 text-sm",children:N.jobs.map(e=>(0,a.jsxs)("li",{className:"flex items-center justify-between gap-2",children:[a.jsx(r.default,{href:`/jobs/${e.id}`,className:"underline hover:no-underline",children:e.title}),a.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(e.createdAt).toLocaleString()})]},e.id))}):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"})]})]})]})]})})}},3398:(e,s,t)=>{"use strict";t.d(s,{Z:()=>d});var a=t(3227),r=t(1043);t(3677);var n=t(8609);function d({children:e,redirectOnFail:s=!0}){let{user:t,loading:d,error:l,status:i}=(0,n.a)();return((0,r.useRouter)(),d)?a.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading session..."}):!t&&s?null:a.jsx(a.Fragment,{children:e})}},5328:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(e,s)=>!!e&&s.includes(e)},754:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(3189).createProxy)(String.raw`C:\Users\Jokeryazid\Documents\My projek\new whatsappbot\app-WhatsAppboot\apps\web\src\app\customers\[id]\page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[193,937,933,420],()=>t(1882));module.exports=a})();