<!doctype html>
<html lang="ms">
  <head>
    <meta charset="utf-8">
    <title>Pendaftaran Customer & Device - WhatsApp Bot POS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
        min-height: 100vh;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        position: relative;
        overflow-x: hidden;
      }

      /* Animated background elements */
      .bg-decoration {
        position: fixed;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.4;
        pointer-events: none;
      }

      .bg-decoration-1 {
        width: 400px;
        height: 400px;
        background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
        top: -100px;
        right: -100px;
        animation: float 8s ease-in-out infinite;
      }

      .bg-decoration-2 {
        width: 300px;
        height: 300px;
        background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
        bottom: -50px;
        left: -50px;
        animation: float 10s ease-in-out infinite reverse;
      }

      .bg-decoration-3 {
        width: 200px;
        height: 200px;
        background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation: pulse 6s ease-in-out infinite;
      }

      @keyframes float {
        0%, 100% { transform: translate(0, 0) rotate(0deg); }
        33% { transform: translate(30px, -30px) rotate(5deg); }
        66% { transform: translate(-20px, 20px) rotate(-5deg); }
      }

      @keyframes pulse {
        0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
        50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.5; }
      }

      .container {
        width: 100%;
        max-width: 520px;
        position: relative;
        z-index: 10;
      }

      .card {
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(148, 163, 184, 0.1);
        border-radius: 24px;
        overflow: hidden;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        animation: slideUp 0.6s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(40px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Header */
      .header {
        padding: 36px 32px 28px;
        text-align: center;
        position: relative;
      }

      .header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #06b6d4 0%, #8b5cf6 50%, #ec4899 100%);
      }

      .logo-container {
        width: 72px;
        height: 72px;
        margin: 0 auto 20px;
        background: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%);
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 40px rgba(6, 182, 212, 0.3);
        animation: bounce 2s ease-in-out infinite;
      }

      @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-6px); }
      }

      .logo-container svg {
        width: 36px;
        height: 36px;
        color: white;
      }

      .header h1 {
        font-size: 26px;
        font-weight: 800;
        color: #f1f5f9;
        margin-bottom: 8px;
        background: linear-gradient(135deg, #f1f5f9 0%, #94a3b8 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header p {
        font-size: 14px;
        color: #94a3b8;
        line-height: 1.5;
      }

      /* Form */
      .form-container {
        padding: 0 32px 36px;
      }

      /* Section Divider */
      .section-title {
        display: flex;
        align-items: center;
        gap: 12px;
        margin: 24px 0 20px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      }

      .section-title:first-child {
        margin-top: 0;
      }

      .section-icon {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .section-icon.customer {
        background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
      }

      .section-icon.device {
        background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      }

      .section-icon svg {
        width: 18px;
        height: 18px;
        color: white;
      }

      .section-title h2 {
        font-size: 16px;
        font-weight: 700;
        color: #e2e8f0;
      }

      .section-title span {
        font-size: 12px;
        color: #64748b;
        font-weight: 500;
      }

      .add-device-btn {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
        border: none;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      }

      .add-device-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
      }

      .add-device-btn:active {
        transform: scale(0.95);
      }

      .add-device-btn svg {
        width: 18px;
        height: 18px;
      }

      .device-card {
        background: rgba(15, 23, 42, 0.4);
        border: 2px solid rgba(139, 92, 246, 0.2);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 16px;
        position: relative;
        animation: slideIn 0.3s ease-out;
      }

      .device-card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(139, 92, 246, 0.2);
      }

      .device-card-number {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 700;
        color: #a78bfa;
        font-size: 14px;
      }

      .remove-device-btn {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #f87171;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }

      .remove-device-btn:hover {
        background: rgba(239, 68, 68, 0.3);
        transform: scale(1.1);
      }

      .remove-device-btn svg {
        width: 14px;
        height: 14px;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        color: #e2e8f0;
        margin-bottom: 8px;
        font-size: 13px;
      }

      label svg {
        width: 16px;
        height: 16px;
        color: #06b6d4;
      }

      .required {
        color: #f87171;
        margin-left: 2px;
      }

      .optional {
        color: #64748b;
        font-weight: 400;
        font-size: 11px;
      }

      input[type="text"],
      input[type="tel"],
      input[type="email"],
      textarea,
      select {
        width: 100%;
        padding: 14px 16px;
        background: rgba(15, 23, 42, 0.6);
        border: 2px solid rgba(148, 163, 184, 0.1);
        border-radius: 12px;
        font-size: 15px;
        color: #f1f5f9;
        transition: all 0.3s;
        font-family: inherit;
      }

      select {
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 20px;
        padding-right: 44px;
      }

      select option {
        background: #1e293b;
        color: #f1f5f9;
        padding: 12px;
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #06b6d4;
        background: rgba(15, 23, 42, 0.8);
        box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.1);
      }

      input::placeholder,
      textarea::placeholder {
        color: #64748b;
      }

      textarea {
        min-height: 80px;
        resize: vertical;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      .help-text {
        display: flex;
        align-items: center;
        gap: 6px;
        color: #64748b;
        font-size: 12px;
        margin-top: 6px;
      }

      .help-text svg {
        width: 12px;
        height: 12px;
      }

      .error-text {
        color: #f87171;
        font-size: 12px;
        margin-top: 6px;
        display: none;
        align-items: center;
        gap: 6px;
      }

      .error-text.show {
        display: flex;
      }

      .error-text svg {
        width: 12px;
        height: 12px;
      }

      /* Submit Button */
      .submit-btn {
        width: 100%;
        padding: 16px 24px;
        background: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%);
        color: white;
        border: none;
        border-radius: 14px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 10px 40px rgba(6, 182, 212, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        position: relative;
        overflow: hidden;
        margin-top: 28px;
      }

      .submit-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
      }

      .submit-btn:hover:not(:disabled)::before {
        left: 100%;
      }

      .submit-btn:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 15px 50px rgba(6, 182, 212, 0.4);
      }

      .submit-btn:active:not(:disabled) {
        transform: translateY(-1px);
      }

      .submit-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .submit-btn svg {
        width: 20px;
        height: 20px;
      }

      /* Alert */
      .alert {
        padding: 14px 16px;
        border-radius: 12px;
        margin-bottom: 20px;
        font-size: 13px;
        display: none;
        align-items: center;
        gap: 10px;
        animation: shake 0.5s ease-out;
      }

      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
      }

      .alert.show {
        display: flex;
      }

      .alert svg {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
      }

      .alert-error {
        background: rgba(239, 68, 68, 0.1);
        color: #fca5a5;
        border: 1px solid rgba(239, 68, 68, 0.2);
      }

      .alert-success {
        background: rgba(34, 197, 94, 0.1);
        color: #86efac;
        border: 1px solid rgba(34, 197, 94, 0.2);
        animation: none;
      }

      /* Spinner */
      .spinner {
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      /* Success State */
      .success-state {
        display: none;
        text-align: center;
        padding: 40px 32px;
        animation: scaleIn 0.5s ease-out;
      }

      @keyframes scaleIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
      }

      .success-state.show {
        display: block;
      }

      .success-icon {
        width: 90px;
        height: 90px;
        margin: 0 auto 24px;
        background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: successPulse 2s ease-in-out infinite;
      }

      @keyframes successPulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
        50% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
      }

      .success-icon svg {
        width: 45px;
        height: 45px;
        color: white;
      }

      .success-state h2 {
        font-size: 24px;
        font-weight: 700;
        color: #f1f5f9;
        margin-bottom: 12px;
      }

      .success-state p {
        color: #94a3b8;
        font-size: 14px;
        line-height: 1.6;
      }

      .success-details {
        margin-top: 24px;
        padding: 16px;
        background: rgba(15, 23, 42, 0.5);
        border-radius: 12px;
        text-align: left;
      }

      .success-details .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      }

      .success-details .detail-row:last-child {
        border-bottom: none;
      }

      .success-details .detail-label {
        color: #64748b;
        font-size: 13px;
      }

      .success-details .detail-value {
        color: #e2e8f0;
        font-weight: 600;
        font-size: 13px;
      }

      /* Footer */
      .footer {
        text-align: center;
        padding: 16px;
        color: #64748b;
        font-size: 11px;
      }

      .footer a {
        color: #06b6d4;
        text-decoration: none;
      }

      /* Responsive */
      @media (max-width: 640px) {
        body {
          padding: 0;
          align-items: flex-start;
        }

        .container {
          max-width: 100%;
        }

        .card {
          border-radius: 0;
          min-height: 100vh;
        }

        .header {
          padding: 28px 20px 24px;
        }

        .header h1 {
          font-size: 22px;
        }

        .form-container {
          padding: 0 20px 28px;
        }

        .row {
          grid-template-columns: 1fr;
        }

        .bg-decoration {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <!-- Background Decorations -->
    <div class="bg-decoration bg-decoration-1"></div>
    <div class="bg-decoration bg-decoration-2"></div>
    <div class="bg-decoration bg-decoration-3"></div>

    <div class="container">
      <div class="card">
        <!-- Header -->
        <div class="header">
          <div class="logo-container">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
          </div>
          <h1>Pendaftaran Servis</h1>
          <p>Sila lengkapkan maklumat anda dan device yang ingin dihantar untuk servis</p>
        </div>

        <!-- Success State -->
        <div id="successState" class="success-state">
          <div class="success-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
          </div>
          <h2>Pendaftaran Berjaya! üéâ</h2>
          <p>Terima kasih kerana mendaftar. Kami akan menghubungi anda melalui WhatsApp untuk makluman lanjut.</p>
          <div class="success-details" id="successDetails"></div>
        </div>

        <!-- Form -->
        <div id="formContainer" class="form-container">
          <div id="alert" class="alert"></div>

          <form id="registrationForm" novalidate>
            <!-- Customer Section -->
            <div class="section-title">
              <div class="section-icon customer">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
              </div>
              <div>
                <h2>Maklumat Peribadi</h2>
                <span>Data pelanggan</span>
              </div>
            </div>

            <div class="form-group">
              <label for="fullName">
                Nama Penuh<span class="required">*</span>
              </label>
              <input 
                type="text" 
                id="fullName" 
                name="fullName" 
                placeholder="Masukkan nama penuh anda"
                required
                autocomplete="name"
              >
              <div id="fullNameError" class="error-text">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span></span>
              </div>
            </div>

            <div class="form-group">
              <label for="phoneNumber">
                Nombor Telefon<span class="required">*</span>
              </label>
              <input 
                type="tel" 
                id="phoneNumber" 
                name="phoneNumber" 
                placeholder="Contoh: 0123456789"
                required
                autocomplete="tel"
              >
              <div class="help-text">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Format: 01X-XXXXXXX
              </div>
              <div id="phoneNumberError" class="error-text">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span></span>
              </div>
            </div>

            <div class="form-group">
              <label for="email">
                Email <span class="optional">(Pilihan)</span>
              </label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                placeholder="contoh@email.com"
                autocomplete="email"
              >
              <div id="emailError" class="error-text">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span></span>
              </div>
            </div>

            <!-- Device Section -->
            <div class="section-title">
              <div class="section-icon device">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
              </div>
              <div style="flex: 1;">
                <h2>Maklumat Device</h2>
                <span>Device yang ingin diservis</span>
              </div>
              <button type="button" id="addDeviceBtn" class="add-device-btn" title="Tambah Device">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
              </button>
            </div>

            <div id="devicesContainer">
              <!-- Device forms will be dynamically added here -->
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              Hantar Pendaftaran
            </button>
          </form>
        </div>

        <!-- Footer -->
        <div class="footer">
          Powered by <a href="#">WhatsApp Bot POS</a> ‚Ä¢ ¬© 2025
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById('registrationForm');
      const formContainer = document.getElementById('formContainer');
      const successState = document.getElementById('successState');
      const successDetails = document.getElementById('successDetails');
      const submitBtn = document.getElementById('submitBtn');
      const alertEl = document.getElementById('alert');
      const devicesContainer = document.getElementById('devicesContainer');
      const addDeviceBtn = document.getElementById('addDeviceBtn');
      
      // Device counter
      let deviceCount = 0;

      // Function to create device form HTML
      function createDeviceForm(deviceIndex) {
        return `
          <div class="device-card" data-device-index="${deviceIndex}">
            <div class="device-card-header">
              <div class="device-card-number">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
                Device ${deviceIndex + 1}
              </div>
              ${deviceCount > 0 ? `
                <button type="button" class="remove-device-btn" onclick="removeDevice(${deviceIndex})" title="Buang Device">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                </button>
              ` : ''}
            </div>

            <div class="form-group">
              <label for="deviceType_${deviceIndex}">
                Jenis Device<span class="required">*</span>
              </label>
              <select id="deviceType_${deviceIndex}" name="deviceType_${deviceIndex}" required>
                <option value="">-- Pilih Jenis Device --</option>
                <option value="laptop">üíª Laptop</option>
                <option value="desktop">üñ•Ô∏è Desktop / PC</option>
                <option value="phone">üì± Telefon</option>
                <option value="tablet">üì≤ Tablet</option>
                <option value="printer">üñ®Ô∏è Printer</option>
                <option value="monitor">üñµ Monitor</option>
                <option value="other">üì¶ Lain-lain</option>
              </select>
              <div id="deviceType_${deviceIndex}_error" class="error-text">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span></span>
              </div>
            </div>

            <div class="row">
              <div class="form-group">
                <label for="deviceBrand_${deviceIndex}">
                  Jenama<span class="required">*</span>
                </label>
                <input 
                  type="text" 
                  id="deviceBrand_${deviceIndex}" 
                  name="deviceBrand_${deviceIndex}" 
                  placeholder="Cth: HP, Dell, Asus"
                  required
                >
                <div id="deviceBrand_${deviceIndex}_error" class="error-text">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  <span></span>
                </div>
              </div>

              <div class="form-group">
                <label for="deviceModel_${deviceIndex}">
                  Model <span class="optional">(Pilihan)</span>
                </label>
                <input 
                  type="text" 
                  id="deviceModel_${deviceIndex}" 
                  name="deviceModel_${deviceIndex}" 
                  placeholder="Cth: Pavilion 14"
                >
              </div>
            </div>

            <div class="form-group">
              <label for="serialNumber_${deviceIndex}">
                Serial Number <span class="optional">(Pilihan)</span>
              </label>
              <input 
                type="text" 
                id="serialNumber_${deviceIndex}" 
                name="serialNumber_${deviceIndex}" 
                placeholder="Nombor siri device (jika ada)"
              >
              <div class="help-text">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Biasanya di bahagian bawah atau belakang device
              </div>
            </div>

            <div class="form-group">
              <label for="issueDescription_${deviceIndex}">
                Masalah / Kerosakan<span class="required">*</span>
              </label>
              <textarea 
                id="issueDescription_${deviceIndex}" 
                name="issueDescription_${deviceIndex}" 
                placeholder="Terangkan masalah atau kerosakan yang dialami..."
                required
              ></textarea>
              <div id="issueDescription_${deviceIndex}_error" class="error-text">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span></span>
              </div>
            </div>
          </div>
        `;
      }

      // Initialize with first device
      function initializeDevices() {
        devicesContainer.innerHTML = createDeviceForm(0);
        deviceCount = 1;
      }

      // Add new device
      function addDevice() {
        devicesContainer.insertAdjacentHTML('beforeend', createDeviceForm(deviceCount));
        deviceCount++;
        updateRemoveButtons();
      }

      // Remove device
      function removeDevice(index) {
        const deviceCard = document.querySelector(`[data-device-index="${index}"]`);
        if (deviceCard && deviceCount > 1) {
          deviceCard.style.animation = 'slideOut 0.3s ease-out';
          setTimeout(() => {
            deviceCard.remove();
            deviceCount--;
            renumberDevices();
            updateRemoveButtons();
          }, 300);
        }
      }

      // Renumber devices after removal
      function renumberDevices() {
        const cards = devicesContainer.querySelectorAll('.device-card');
        cards.forEach((card, index) => {
          const oldIndex = card.getAttribute('data-device-index');
          card.setAttribute('data-device-index', index);
          
          const numberEl = card.querySelector('.device-card-number');
          if (numberEl) {
            numberEl.innerHTML = `
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              Device ${index + 1}
            `;
          }
          
          // Update all IDs and names
          const inputs = card.querySelectorAll('input, select, textarea');
          inputs.forEach(input => {
            const oldId = input.id;
            const parts = oldId.split('_');
            const baseName = parts[0];
            const newId = `${baseName}_${index}`;
            input.id = newId;
            input.name = newId;
            
            // Update label for attribute
            const label = card.querySelector(`label[for="${oldId}"]`);
            if (label) label.setAttribute('for', newId);
          });
          
          // Update error div IDs
          const errorDivs = card.querySelectorAll('[id$="_error"]');
          errorDivs.forEach(errorDiv => {
            const oldErrorId = errorDiv.id;
            const parts = oldErrorId.split('_');
            if (parts.length >= 2) {
              const baseName = parts.slice(0, -1).join('_');
              const newErrorId = `${baseName}_error`;
              errorDiv.id = newErrorId;
            }
          });
          
          // Update remove button
          const removeBtn = card.querySelector('.remove-device-btn');
          if (removeBtn) {
            removeBtn.setAttribute('onclick', `removeDevice(${index})`);
          }
        });
      }

      // Update remove buttons visibility
      function updateRemoveButtons() {
        const removeButtons = devicesContainer.querySelectorAll('.remove-device-btn');
        removeButtons.forEach(btn => {
          btn.style.display = deviceCount > 1 ? 'flex' : 'none';
        });
      }

      // Add slideOut animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideOut {
          from {
            opacity: 1;
            transform: translateY(0);
          }
          to {
            opacity: 0;
            transform: translateY(-10px);
          }
        }
      `;
      document.head.appendChild(style);

      // Initialize
      initializeDevices();
      addDeviceBtn.addEventListener('click', addDevice);

      // Field validation
      const fields = {
        fullName: {
          element: document.getElementById('fullName'),
          error: document.getElementById('fullNameError'),
          validate: (value) => {
            if (!value.trim()) return 'Nama penuh diperlukan';
            if (value.trim().length < 2) return 'Nama mesti sekurang-kurangnya 2 huruf';
            return null;
          }
        },
        phoneNumber: {
          element: document.getElementById('phoneNumber'),
          error: document.getElementById('phoneNumberError'),
          validate: (value) => {
            if (!value.trim()) return 'Nombor telefon diperlukan';
            const cleaned = value.replace(/[\s-]/g, '');
            const phoneRegex = /^(\+?60|0)[1-9]\d{7,9}$/;
            if (!phoneRegex.test(cleaned)) {
              return 'Sila masukkan nombor telefon Malaysia yang sah';
            }
            return null;
          }
        },
        email: {
          element: document.getElementById('email'),
          error: document.getElementById('emailError'),
          validate: (value) => {
            if (!value.trim()) return null;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(value)) {
              return 'Sila masukkan alamat email yang sah';
            }
            return null;
          }
        }
      };

      // Real-time validation
      Object.keys(fields).forEach(fieldName => {
        const field = fields[fieldName];
        field.element.addEventListener('blur', () => validateField(fieldName));
        field.element.addEventListener('input', () => {
          const errorSpan = field.error.querySelector('span');
          if (errorSpan) errorSpan.textContent = '';
          field.error.classList.remove('show');
        });
      });

      function validateField(fieldName) {
        const field = fields[fieldName];
        const value = field.element.value;
        const error = field.validate(value);
        const errorSpan = field.error.querySelector('span');
        
        if (error) {
          if (errorSpan) errorSpan.textContent = error;
          field.error.classList.add('show');
          return false;
        } else {
          if (errorSpan) errorSpan.textContent = '';
          field.error.classList.remove('show');
          return true;
        }
      }

      // Validate device fields
      function validateDevice(deviceIndex) {
        let isValid = true;
        const deviceCard = document.querySelector(`[data-device-index="${deviceIndex}"]`);
        if (!deviceCard) return false;

        const deviceType = deviceCard.querySelector(`#deviceType_${deviceIndex}`);
        const deviceBrand = deviceCard.querySelector(`#deviceBrand_${deviceIndex}`);
        const issueDescription = deviceCard.querySelector(`#issueDescription_${deviceIndex}`);

        // Validate device type
        if (!deviceType.value) {
          const errorEl = deviceCard.querySelector(`#deviceType_${deviceIndex}_error`);
          if (errorEl) {
            errorEl.querySelector('span').textContent = 'Sila pilih jenis device';
            errorEl.classList.add('show');
          }
          isValid = false;
        } else {
          const errorEl = deviceCard.querySelector(`#deviceType_${deviceIndex}_error`);
          if (errorEl) errorEl.classList.remove('show');
        }

        // Validate device brand
        if (!deviceBrand.value.trim()) {
          const errorEl = deviceCard.querySelector(`#deviceBrand_${deviceIndex}_error`);
          if (errorEl) {
            errorEl.querySelector('span').textContent = 'Jenama device diperlukan';
            errorEl.classList.add('show');
          }
          isValid = false;
        } else {
          const errorEl = deviceCard.querySelector(`#deviceBrand_${deviceIndex}_error`);
          if (errorEl) errorEl.classList.remove('show');
        }

        // Validate issue description
        if (!issueDescription.value.trim()) {
          const errorEl = deviceCard.querySelector(`#issueDescription_${deviceIndex}_error`);
          if (errorEl) {
            errorEl.querySelector('span').textContent = 'Sila terangkan masalah device';
            errorEl.classList.add('show');
          }
          isValid = false;
        } else if (issueDescription.value.trim().length < 10) {
          const errorEl = deviceCard.querySelector(`#issueDescription_${deviceIndex}_error`);
          if (errorEl) {
            errorEl.querySelector('span').textContent = 'Penerangan mesti sekurang-kurangnya 10 huruf';
            errorEl.classList.add('show');
          }
          isValid = false;
        } else {
          const errorEl = deviceCard.querySelector(`#issueDescription_${deviceIndex}_error`);
          if (errorEl) errorEl.classList.remove('show');
        }

        return isValid;
      }

      function validateForm() {
        let isValid = true;
        
        // Validate customer fields
        Object.keys(fields).forEach(fieldName => {
          if (!validateField(fieldName)) isValid = false;
        });

        // Validate all devices
        for (let i = 0; i < deviceCount; i++) {
          if (!validateDevice(i)) isValid = false;
        }

        return isValid;
      }

      function showAlert(message, type = 'error') {
        const icon = type === 'success' 
          ? '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
          : '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
        
        alertEl.innerHTML = icon + '<span>' + message + '</span>';
        alertEl.className = `alert alert-${type} show`;
      }

      function hideAlert() {
        alertEl.classList.remove('show');
      }

      function showSuccess(data) {
        formContainer.style.display = 'none';
        
        // Build success details
        const deviceTypeLabels = {
          laptop: 'üíª Laptop',
          desktop: 'üñ•Ô∏è Desktop / PC',
          phone: 'üì± Telefon',
          tablet: 'üì≤ Tablet',
          printer: 'üñ®Ô∏è Printer',
          monitor: 'üñµ Monitor',
          other: 'üì¶ Lain-lain'
        };
        
        let detailsHTML = `
          <div class="detail-row">
            <span class="detail-label">Nama</span>
            <span class="detail-value">${data.customerName}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Telefon</span>
            <span class="detail-value">${data.phone}</span>
          </div>
        `;

        // Show all devices
        if (data.devices && data.devices.length > 0) {
          detailsHTML += `
            <div class="detail-row">
              <span class="detail-label">Bilangan Device</span>
              <span class="detail-value">${data.devices.length} device${data.devices.length > 1 ? 's' : ''}</span>
            </div>
          `;
          data.devices.forEach((device, index) => {
            detailsHTML += `
              <div class="detail-row">
                <span class="detail-label">Device ${index + 1}</span>
                <span class="detail-value">${deviceTypeLabels[device.deviceType] || device.deviceType} - ${device.deviceBrand}</span>
              </div>
            `;
          });
        }
        
        successDetails.innerHTML = detailsHTML;
        successState.classList.add('show');
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        hideAlert();

        if (!validateForm()) {
          showAlert('Sila betulkan ralat dalam borang');
          return;
        }

        // Disable button
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="spinner"></div> Menghantar...';

        // Collect all devices
        const devices = [];
        for (let i = 0; i < deviceCount; i++) {
          const deviceCard = document.querySelector(`[data-device-index="${i}"]`);
          if (deviceCard) {
            devices.push({
              deviceType: deviceCard.querySelector(`#deviceType_${i}`).value,
              deviceBrand: deviceCard.querySelector(`#deviceBrand_${i}`).value.trim(),
              deviceModel: deviceCard.querySelector(`#deviceModel_${i}`).value.trim() || undefined,
              serialNumber: deviceCard.querySelector(`#serialNumber_${i}`).value.trim() || undefined,
              issueDescription: deviceCard.querySelector(`#issueDescription_${i}`).value.trim()
            });
          }
        }

        const formData = {
          // Customer data
          name: fields.fullName.element.value.trim(),
          phone: fields.phoneNumber.element.value.trim(),
          email: fields.email.element.value.trim() || undefined,
          // Devices array
          devices: devices
        };

        try {
          const baseUrl = window.location.origin;
          const response = await fetch(`${baseUrl}/api/customers/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
          });

          const data = await response.json();

          if (response.ok) {
            showSuccess({
              customerName: formData.name,
              phone: formData.phone,
              devices: devices
            });
          } else {
            showAlert(data.error || data.message || 'Pendaftaran gagal. Sila cuba lagi.');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg> Hantar Pendaftaran';
          }
        } catch (error) {
          console.error('Registration error:', error);
          showAlert('Ralat rangkaian. Sila semak sambungan internet anda.');
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg> Hantar Pendaftaran';
        }
      });
    </script>
  </body>
</html>
